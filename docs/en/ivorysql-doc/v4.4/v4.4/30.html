<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>initdb Process :: IvorySQL Document Site</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/v4.4/v4.4/30.html">
    <link rel="prev" href="31.html">
    <link rel="next" href="14.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL Document Site</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.ivorysql.org/">Home</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="v4.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="welcome.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1.html">Release</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started with IvorySQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5.html">Maintenance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Advanced Feature</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="6.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.html">Building Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="8.html">Developer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="9.html">Operation Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10.html">Migration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Ecosystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11.html">PostGIS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12.html">pgvector</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Architecture Design</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Query Processing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="31.html">Dual Parser</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Compatibility Framework</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="30.html">initdb Process</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">List of Oracle compatible features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14.html">1、Ivorysql frame design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15.html">2、GUC Framework</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="16.html">3、Case conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="17.html">4、Dual-mode design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="18.html">5、Compatible with Oracle like</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19.html">6、Compatible with Oracle anonymous block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20.html">7、Compatible with Oracle functions and stored procedures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="21.html">8、Built-in data types and built-in functions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="22.html">9、Added Oracle compatibility mode ports and IP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="26.html">10、XML Function</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="27.html">11、Compatible with Oracle sequence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="28.html">12、Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="29.html">13、Invisible Columns</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="23.html">Community contribution</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="24.html">Tool Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="25.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">v4.4</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../v4.6/v4.6/welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../v4.6/v4.6/welcome.html">v4.6</a>
        </li>
        <li class="version">
          <a href="../../v4.5/v4.5/welcome.html">v4.5</a>
        </li>
        <li class="version is-current">
          <a href="welcome.html">v4.4</a>
        </li>
        <li class="version">
          <a href="../../v4.2/v4.2/welcome.html">v4.2</a>
        </li>
        <li class="version">
          <a href="../../v4.0/v4.0/welcome.html">v4.0</a>
        </li>
        <li class="version">
          <a href="../../v3.4/v3.4/welcome.html">v3.4</a>
        </li>
        <li class="version">
          <a href="../../v3.3/v3.3/welcome.html">v3.3</a>
        </li>
        <li class="version">
          <a href="../../v3.2/v3.2/welcome.html">v3.2</a>
        </li>
        <li class="version">
          <a href="../../v3.1/v3.1/welcome.html">v3.1</a>
        </li>
        <li class="version">
          <a href="../../v3.0/v3.0/welcome.html">v3.0</a>
        </li>
        <li class="version">
          <a href="../../v2.3/v2.3/welcome.html">v2.3</a>
        </li>
        <li class="version">
          <a href="../../v2.2/v2.2/welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../../v2.1/v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version">
          <a href="../../v1.17/v1.17/welcome.html">v1.17</a>
        </li>
        <li class="version">
          <a href="../../v1.8/v1.8/welcome.html">v1.8</a>
        </li>
        <li class="version">
          <a href="../../v1.5/v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version">
          <a href="../../v1.4/v1.4/welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../../v1.3/v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../../v1.2/v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../../v1.1/v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../v4.6/v4.6/welcome.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="welcome.html">IvorySQL</a></li>
    <li>IvorySQL Architecture Design</li>
    <li>Compatibility Framework</li>
    <li><a href="30.html">initdb Process</a></li>
  </ul>
</nav>
  <div class="page-versions">
  <button class="version-menu-toggle" title="switch to Chinese">EN</button>
  <div class="version-menu">
    <a class="version is-current" href="">EN</a>
    <a class="version" href="../../../../cn/ivorysql-doc/v4.4/v4.4/30.html">CN</a>
  </div>
  </div>
  <div class="edit-this-page"><a href="https://github.com/IvorySQL/ivorysql_docs/edit/v4.4/EN/modules/ROOT/pages/v4.4/30.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page"><strong>initdb Process</strong></h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>IvorySQL supports two database modes during the initialization process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PG Mode: Maintains compatibility with native PostgreSQL.</p>
</li>
<li>
<p>Oracle Mode (default): Provides Oracle syntax compatibility and enhanced features.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can specify the initialization mode using the initdb command parameters to meet compatibility requirements for different scenarios.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="parameter-parsing-and-processing"><a class="anchor" href="#parameter-parsing-and-processing"></a>1. Parameter Parsing and Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the initial phase, initdb parses the input command-line parameters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the database mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle/pg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the case conversion mode for Oracle compatibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interchange/normal/lowercase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interchange</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Parameter Parsing Workflow:</p>
</div>
<div class="paragraph">
<p>1.Inherits PostgreSQL&#8217;s existing parameter processing mechanism.</p>
</div>
<div class="paragraph">
<p>2.Adds parsing logic for the mode selection parameter -m.</p>
</div>
<div class="paragraph">
<p>3.Introduces a processing module for the case conversion parameter -C.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="file-path-initialization"><a class="anchor" href="#file-path-initialization"></a>2. File Path Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The setup_data_file_paths() function is executed to configure critical file paths:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">	if (DB_PG == database_mode)
		set_input(&amp;bki_file, "postgres.bki");
	else
		set_input(&amp;bki_file, "postgres_oracle.bki");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Path Verification Mechanism:</p>
</div>
<div class="paragraph">
<p>1.Verifies the existence of the BKI files (postgres_oracle.bki / postgres.bki).</p>
</div>
<div class="paragraph">
<p>2.Confirms the availability of the configuration file templates.</p>
</div>
<div class="paragraph">
<p>3.Establishes the system directory structure corresponding to the database mode.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-directory-initialization-process"><a class="anchor" href="#data-directory-initialization-process"></a>3. Data Directory Initialization Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core initialization operations are performed by the initialize_data_directory() function:</p>
</div>
<div class="sect2">
<h3 id="directory-structure-creation"><a class="anchor" href="#directory-structure-creation"></a>3.1. Directory Structure Creation</h3>
<div class="paragraph">
<p>Calls create_data_directory() to create the main data directory (PGDATA).</p>
</div>
<div class="paragraph">
<p>Uses create_xlog_or_symlink() to establish the WAL log directory.</p>
</div>
<div class="paragraph">
<p>Iteratively creates standard subdirectories such as base and global.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-file-initialization"><a class="anchor" href="#configuration-file-initialization"></a>3.2. Configuration File Initialization</h3>
<div class="paragraph">
<p>Calls set_null_conf() to create an empty postgresql.conf file.</p>
</div>
<div class="paragraph">
<p>In Oracle mode, additionally creates the ivorysql.conf configuration file.</p>
</div>
<div class="paragraph">
<p>Calls setup_config() to write configuration information to postgresql.conf. In Oracle mode, additional configuration information is written to ivorysql.conf.</p>
</div>
</div>
<div class="sect2">
<h3 id="template-database-bootstrapping"><a class="anchor" href="#template-database-bootstrapping"></a>3.3. Template Database Bootstrapping</h3>
<div class="paragraph">
<p>Executes bootstrap_template1() to load the corresponding BKI file and initialize the template1 template database.</p>
</div>
<div class="paragraph">
<p>IvorySQL additionally sets the database mode (oracle/pg) and case conversion mode for the template1 template database.</p>
</div>
<div class="paragraph">
<p>load_plisql(): Installs the PL/iSQL procedural language for Oracle PL/SQL compatibility.</p>
</div>
<div class="paragraph">
<p>load_ivorysql_ora(): Loads the core Oracle compatibility layer extension.</p>
</div>
<div class="paragraph">
<p>make_ivorysql(): Creates the default ivorysql database.</p>
</div>
</div>
<div class="sect2">
<h3 id="oracle-compatible-username-handling"><a class="anchor" href="#oracle-compatible-username-handling"></a>3.4. Oracle-Compatible Username Handling</h3>
<div class="paragraph">
<p>When the database mode is Oracle, usernames are forcibly converted to lowercase.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>In PostgreSQL, "bki" stands for "Bootstrap Kit." The Bootstrap Kit is a collection of tools and files used internally by PostgreSQL to bootstrap the database system.</p>
</div>
<div class="paragraph">
<p>The Bootstrap Kit is primarily used to initialize the foundational structure of the PostgreSQL database system, including the system catalog, system tables, and other necessary system objects. These system catalogs and tables store metadata information about the PostgreSQL database system, such as database objects, table structures, and index information.</p>
</div>
<div class="paragraph">
<p>The genbki.pl script processes system table files like pg_class.h, pg_namespace.h, and pg_proc.h, and generates postgres.bki for initdb to load. This primarily involves loading initialization data, such as creating system tables, system functions, and predefined types.</p>
</div>
<div class="paragraph">
<p>During the compilation phase before initdb, genbki.pl generates both postgres.bki and postgres_ora.bki. While postgres.bki remains unchanged from PostgreSQL, postgres_ora.bki includes additional system objects for Oracle compatibility.</p>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p20.jpg" alt="p20">
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="31.html">Dual Parser</a></span>
  <span class="next"><a href="14.html">1、Ivorysql frame design</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
