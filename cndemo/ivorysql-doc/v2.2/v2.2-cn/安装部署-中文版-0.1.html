<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装部署 :: IvorySQL Document Site</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/v2.2/v2.2-cn/安装部署-中文版-0.1.html">
    <link rel="prev" href="IvorySQL运维人员指南-中文版-0.1.html">
    <link rel="next" href="开发者指南.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL Document Site</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="docs.ivorysql.org">IvorySQL</a>
            <a class="navbar-item" href="docs.ivorysql.org">Migrations</a>
            <a class="navbar-item" href="docs.ivorysql.org">AdminUI</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Migration Services</a>
            <a class="navbar-item" href="#">Remote DBA</a>
            <a class="navbar-item" href="#">Perfornace Tuning</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="v2.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../welcome.html">欢迎</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL2.2发行说明.html">发行说明</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL关于-中文版-0.2.html">IvorySQL关于</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">入门IvorySQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="入门IvorySQL-中文版-0.1.html">入门IvorySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="管理员指南.html">管理员指南</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IvorySQL运维人员指南-中文版-0.1.html">运维人员指南</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="安装部署-中文版-0.1.html">安装部署</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="开发者指南.html">开发者指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="运维管理指南-中文版-0.2.html">运维管理指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#v2.2-cn/IvorySQL迁移指南-中午版-0.1.adoc">迁移指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL社区贡献指南-中文版-0.3.html">社区贡献指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="工具参考.html">工具参考</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">v2.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../../v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version">
          <a href="../../v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version">
          <a href="../../v1.4/welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../../v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../../v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../../v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../welcome.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../welcome.html">IvorySQL</a></li>
    <li><a href="安装部署-中文版-0.1.html">安装部署</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v2.2</button>
  <div class="version-menu">
    <a class="version is-current" href="安装部署-中文版-0.1.html">v2.2</a>
    <a class="version is-missing" href="../../v2.1/welcome.html">v2.1</a>
    <a class="version is-missing" href="../../v1.5/welcome.html">v1.5</a>
    <a class="version is-missing" href="../../v1.4/welcome.html">v1.4</a>
    <a class="version is-missing" href="../../v1.3/welcome.html">v1.3</a>
    <a class="version is-missing" href="../../v1.2/welcome.html">v1.2</a>
    <a class="version is-missing" href="../../v1.1/welcome.html">v1.1</a>
    <a class="version is-missing" href="../../v1.0/welcome.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/DutMsn/ivory-docs/edit/v2.2/modules/ROOT/pages/v2.2-cn/安装部署-中文版-0.1.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page"><strong>安装部署</strong></h1>
<div id="toc" class="toc">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#安装概述">1. 安装概述</a>
<ul class="sectlevel2">
<li><a href="#软硬件要求">1.1. 软硬件要求</a>
<ul class="sectlevel3">
<li><a href="#软件资源介绍">1.1.1. 软件资源介绍</a></li>
<li><a href="#硬件资源准备">1.1.2. 硬件资源准备</a></li>
</ul>
</li>
<li><a href="#环境和配置检查">1.2. 环境和配置检查</a>
<ul class="sectlevel3">
<li><a href="#查看资源">1.2.1. 查看资源</a></li>
<li><a href="#查看操作系统">1.2.2. 查看操作系统</a></li>
<li><a href="#查看内核参数">1.2.3. 查看内核参数</a></li>
<li><a href="#查看内存清理缓存">1.2.4. 查看内存，清理缓存</a></li>
</ul>
</li>
<li><a href="#获取安装包">1.3. 获取安装包</a>
<ul class="sectlevel3">
<li><a href="#使用源码构建ivorysql数据库">1.3.1. 使用源码构建IvorySQL数据库</a></li>
<li><a href="#使用-rpm-包安装-ivorysql-数据库">1.3.2. 使用 RPM 包安装 IvorySql 数据库</a></li>
</ul>
</li>
<li><a href="#初始化数据库服务">1.4. 初始化数据库服务</a>
<ul class="sectlevel3">
<li><a href="#初始化数据库">1.4.1. 初始化数据库</a></li>
</ul>
</li>
<li><a href="#配置服务">1.5. 配置服务</a></li>
<li><a href="#安装">1.6. 安装</a>
<ul class="sectlevel3">
<li><a href="#yum源">1.6.1. yum源</a></li>
<li><a href="#deb安装">1.6.2. deb安装</a></li>
</ul>
</li>
<li><a href="#卸载-ivorysql-数据库">1.7. 卸载 IvorySQL 数据库</a>
<ul class="sectlevel3">
<li><a href="#编译卸载">1.7.1. 编译卸载</a></li>
<li><a href="#yum卸载">1.7.2. YUM卸载</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="安装概述"><a class="anchor" href="#安装概述"></a>1. 安装概述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本文介绍 Ivorysql 在Linux平台（以CentOS 7为例）的安装过程及注意事项。本文主要演示数据库在Centos 7环境下yum源安装步骤、rpm包安装步骤、源码安装步骤。</p>
</div>
<div class="sect2">
<h3 id="软硬件要求"><a class="anchor" href="#软硬件要求"></a>1.1. 软硬件要求</h3>
<div class="sect3">
<h4 id="软件资源介绍"><a class="anchor" href="#软件资源介绍"></a>1.1.1. 软件资源介绍</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作系统</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yum源下载地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 7、CentOS 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://yum.highgo.ca/ivorysql.html" class="bare">https://yum.highgo.ca/ivorysql.html</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="硬件资源准备"><a class="anchor" href="#硬件资源准备"></a>1.1.2. 硬件资源准备</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>配置参数</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>最低配置</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>推荐配置</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4核</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16核</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>内存</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>存储</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800MB，机械硬盘</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5GB以上，SSD或NvMe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>网络</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">千兆网络</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">万兆网络</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="环境和配置检查"><a class="anchor" href="#环境和配置检查"></a>1.2. 环境和配置检查</h3>
<div class="paragraph">
<p>部署 IvorySQL 数据库前，您需要进行系统环境和配置检查</p>
</div>
<div class="sect3">
<h4 id="查看资源"><a class="anchor" href="#查看资源"></a>1.2.1. 查看资源</h4>
<div class="paragraph">
<p>IvorySQL 数据库支持CentOS 7.X，8.X操作系统。详细信息，参考<a href="#_软硬件要求">[_软硬件要求]</a></p>
</div>
</div>
<div class="sect3">
<h4 id="查看操作系统"><a class="anchor" href="#查看操作系统"></a>1.2.2. 查看操作系统</h4>
<div class="paragraph">
<p><strong>CentOS 7.X</strong></p>
</div>
<div class="paragraph">
<p>运行以下命令，查看操作系统信息：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat /etc/redhat-release</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="查看内核参数"><a class="anchor" href="#查看内核参数"></a>1.2.3. 查看内核参数</h4>
<div class="literalblock">
<div class="content">
<pre>uname -r</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="查看内存清理缓存"><a class="anchor" href="#查看内存清理缓存"></a>1.2.4. 查看内存，清理缓存</h4>
<div class="listingblock">
<div class="content">
<pre>    free -g

    echo 3 &gt; /proc/sys/vm/drop_caches</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="获取安装包"><a class="anchor" href="#获取安装包"></a>1.3. 获取安装包</h3>
<div class="paragraph">
<p>您可以通过 源码安装 IvorySQL 数据库或 RPM 包安装。</p>
</div>
<div class="sect3">
<h4 id="使用源码构建ivorysql数据库"><a class="anchor" href="#使用源码构建ivorysql数据库"></a>1.3.1. 使用源码构建IvorySQL数据库</h4>
<div class="paragraph">
<p>1.获取源代码：运行以下命令，克隆 IvorySQL 数据库源代码到您的构建机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/IvorySQL/IvorySQL.git</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：克隆代码需要先安装配置 Git。详细信息，参考 <a href="https://git-scm.com/doc">Git 文档</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.安装依赖包：要从源代码编译 IvorySQL，必须确保系统上有可用的先决条件包。 执行以下命令安装相关包：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo yum install -y bison-devel readline-devel zlib-devel openssl-devel wget
sudo yum groupinstall -y 'Development Tools'</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：“Development Tools” 包含了gcc，make，flex，bison。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.自行编译安装：前面通过获取的源码在文件夹IvorySQL里，接下来我们就进入这个文件夹进行操作。</p>
</div>
<div class="paragraph">
<p>3.1 配置：Root用户执行以下命令进行配置：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./configure --prefix=/usr/local/ivorysql/ivorysql-1.2</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明： 由于没有提供&#8212;&#8203;prefix，默认安装在/usr/local/pgsql，故需要指定路径</p>
</div>
<div class="paragraph">
<p>注意：我们要记住指定的目录，因为系统查不出已经编译安装的程序在哪。更多configure参数通过“./configure --help”查看。还可以查看PostgreSQL手册</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.2 编译安装：配置完成后，执行make进行编译：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>make</pre>
</div>
</div>
<div class="paragraph">
<p>要在安装新编译的服务之前使用回归测试测试一下，以下命令均可：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make check
make check-world</pre>
</div>
</div>
<div class="paragraph">
<p>然后安装：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>make install</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="使用-rpm-包安装-ivorysql-数据库"><a class="anchor" href="#使用-rpm-包安装-ivorysql-数据库"></a>1.3.2. 使用 RPM 包安装 IvorySql 数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行以下命令，下载 IvorySQL 安装包。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>wget  https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-1.2-1.rhel7.x86_64.rpm

wget  https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-contrib-1.2-1.rhel7.x86_64.rpm

wget  https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-libs-1.2-1.rhel7.x86_64.rpm

wget  https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-server-1.2-1.rhel7.x86_64.rpm</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：示例中的安装包可能不是最新版本，建议您下载最新的安装包。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.运行以下命令，安装 IvorySQL 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum install -y libicu libxslt python3                   --先安装依赖
rpm -ivh ivorysql1-libs-1.2-1.rhel7.x86_64.rpm
rpm -ivh ivorysql1-1.2-1.rhel7.x86_64.rpm
rpm -ivh ivorysql1-contrib-1.2-1.rhel7.x86_64.rpm --nodeps
rpm -ivh ivorysql1-server-1.2-1.rhel7.x86_64.rpm</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="初始化数据库服务"><a class="anchor" href="#初始化数据库服务"></a>1.4. 初始化数据库服务</h3>
<div class="sect3">
<h4 id="初始化数据库"><a class="anchor" href="#初始化数据库"></a>1.4.1. 初始化数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建操作系统用户：用户root会话下，新建用户 ivorysql：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/sbin/groupadd ivorysql
/usr/sbin/useradd -g ivorysql ivorysql -c "IvorySQL1.2 Server"
passwd ivorysql</pre>
</div>
</div>
<div class="paragraph">
<p>2.创建数据目录并修改权限：在root会话下执行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mkdir -p /ivorysql/1.2/data
chown -R ivorysql.ivorysql /ivorysql/1.2/</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：这里没按RPM安装将数据目录放置到“/var/lib/ivorysql/ivorysql-1/data”。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.环境变量：切换到用户ivorysql，修改文件“/home/ ivorysql /.bash_profile”，配置环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>umask 022
export LD_LIBRARY_PATH=/usr/local/pgsql/lib:$LD_LIBRARY_PATH
export PATH=/usr/local/pgsql/bin:$PATH
export PGDATA=/ivorysql/1.2/data</pre>
</div>
</div>
<div class="paragraph">
<p>使环境变量在当前ivorysql用户会话中生效：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>source .bash_profile</pre>
</div>
</div>
<div class="paragraph">
<p>也可以重新登录或开启一个新的用户ivorysql的会话。</p>
</div>
<div class="paragraph">
<p>4.设置防火墙：如果开启了防火墙，还需要将端口5333开放：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>firewall-cmd --zone=public --add-port=5333/tcp --permanent
firewall-cmd --reload</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认端口是5333，如果不开放该端口，外部客户端通过ip连接会失败。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>5.初始化：在用户ivorysql下，简单执行initdb就可以完成初始化：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>initdb</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：initdb操作与PostgreSQL一样，可以按照PG的习惯去初始化。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>6.启动数据库：使用pg_ctl启动数据库服务：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl start</pre>
</div>
</div>
<div class="paragraph">
<p>查看状态，启动成功：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl status</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="配置服务"><a class="anchor" href="#配置服务"></a>1.5. 配置服务</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>客户端验证：修改 /ivorysql/1.2/data/pg_hba.conf，追加以下内容：</p>
<div class="literalblock">
<div class="content">
<pre>host    all             all             0.0.0.0/0               trust</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：这里是trust，就是说可以免密登录。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>执行以下命令加载配置：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl reload</pre>
</div>
</div>
<div class="paragraph">
<p>2.基本参数</p>
</div>
<div class="paragraph">
<p>通过psql连接数据库：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>psql</pre>
</div>
</div>
<div class="paragraph">
<p>修改监听地址</p>
</div>
<div class="literalblock">
<div class="content">
<pre>alter system set listen_address = '*';</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认是监听在127.0.0.1，主机外是连不上服务的。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.守护服务</p>
</div>
<div class="paragraph">
<p>创建service文件：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>touch /usr/lib/systemd/system/ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>编辑内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Unit]
Description=IvorySQL 1.2 database server
Documentation=https://www.ivorysql.org
Requires=network.target local-fs.target
After=network.target local-fs.target

[Service]
Type=forking

User=ivorysql
Group=ivorysql

Environment=PGDATA=/ivorysql/1.2/data/

OOMScoreAdjust=-1000

ExecStart=/usr/local/pgsql/bin/pg_ctl start -D ${PGDATA}
ExecStop=/usr/local/pgsql/bin/pg_ctl stop -D ${PGDATA}
ExecReload=/usr/local/pgsql/bin/pg_ctl reload -D ${PGDATA}

TimeoutSec=0

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：service的写法有很多，在生产环境使用时需谨慎，请多次重复测试。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>停止pg_ctl启动的数据库服务，启用systemd服务并启动：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable --now ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>IvorSQL数据库服务操作命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>systemctl start ivorysql.service            --启动数据库服务
systemctl stop ivorysql.service             --停止数据库服务
systemctl restart ivorysql.service          --重启数据库
systemctl status ivorysql.service           --查看数据库状态
systemctl reload ivorysql.service           --可以满足部分数据库配置修改完后生效</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="安装"><a class="anchor" href="#安装"></a>1.6. 安装</h3>
<div class="sect3">
<h4 id="yum源"><a class="anchor" href="#yum源"></a>1.6.1. yum源</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载YUM源:在Centos7上使用wget下载</p>
<div class="literalblock">
<div class="content">
<pre>wget https://yum.highgo.ca/dists/ivorysql-rpms/repo/ivorysql-release-1.0-1.noarch.rpm</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>安装ivorysql-release-1.0-1.noarch.rpm：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>rpm -ivh ivorysql-release-1.0-1.noarch.rpm</pre>
</div>
</div>
<div class="paragraph">
<p>安装后，将创建YUM源配置文件：/etc/yum.repos.d/ivorysql.repo。</p>
</div>
<div class="paragraph">
<p>搜索查看相关安装包：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum search ivorysql</pre>
</div>
</div>
<div class="paragraph">
<p>搜索结果说明见表1：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">YUN源说明</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>序号</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>包名</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>描述</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-1.2-1.rhel7.x86_64.rpm">ivorysql1.x86_64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IvorySQL客户端程序和库文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-contrib-1.2-1.rhel7.x86_64.rpm">ivorysql1-contrib.x86_64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">随IvorySQL发布的已贡献的源代码和二进制文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-devel.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IvorySQL开发头文件和库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-docs.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IvorySQL的额外文档</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-libs-1.2-1.rhel7.x86_64.rpm">ivorysql1-libs.x86_64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有IvorySQL客户端所需的共享库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-llvmjit.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对IvorySQL的即时编译支持</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-plperl.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于IvorySQL的过程语言Perl</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-plpython3.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于IvorySQL的过程语言Python3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-pltcl.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于IvorySQL的过程语言Tcl</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://yum.highgo.ca/dists/ivorysql-rpms/1/redhat/rhel-7-x86_64/ivorysql1-server-1.2-1.rhel7.x86_64.rpm">ivorysql1-server.x86_64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建和运行IvorySQL服务器所需的程序</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql1-test.x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">随IvorySQL发布的测试套件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ivorysql-release.noarch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">瀚高基础软件股份有限公司的Yum源配置RPM包</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>2.安装IvorySQL</p>
</div>
<div class="paragraph">
<p>要安装数据库服务，需要安装ivorysql1-server。 在用户root会话下执行以下命令：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum install -y ivorysql1-server</pre>
</div>
</div>
<div class="paragraph">
<p><strong>安装清单：</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>ivorysql1-server.x86_64 0:1.2-1.rhel7</pre>
</div>
</div>
<div class="paragraph">
<p><strong>依赖安装：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>ivorysql1.x86_64 0:1.2-1.rhel7 ivorysql1-contrib.x86_64 0:1.2-1.rhel7
ivorysql1-libs.x86_64 0:1.2-1.rhel7 libicu.x86_64 0:50.2-4.el7_7
libtirpc.x86_64 0:0.2.4-0.16.el7 libxslt.x86_64 0:1.1.28-6.el7
python3.x86_64 0:3.6.8-18.el7 python3-libs.x86_64 0:3.6.8-18.el7
python3-pip.noarch 0:9.0.3-8.el7 python3-setuptools.noarch 0:39.2.0-10.el7</pre>
</div>
</div>
<div class="paragraph">
<p>3.已安装目录</p>
</div>
<div class="paragraph">
<p>表2 对YUM安装过程产生的文件目录进行说明。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">安装目录文件说明</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>序号</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>文件路径</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>描述</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/ivorysql/ivorysql-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">软件安装目录</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/ivorysql/ivorysql-1/data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据目录（默认）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/bin/ivorysql-1-setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">帮助管理员进行基本的数据库集群管理</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/lib/systemd/system/ivorysql-1.service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">守护服务</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="deb安装"><a class="anchor" href="#deb安装"></a>1.6.2. deb安装</h4>
<div class="paragraph">
<p>验证环境：Linux 20.04.1-Ubuntu</p>
</div>
<div class="paragraph">
<p>1、从官网获取deb包</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：目前还未提供。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2、安装deb包</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">dpkg -i ivorysql.deb</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：ivorysql.deb 为待安装包名。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3、配置环境变量</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">vi ~/.bashrc
    export PATH=/xxx/ivorysql/bin:$PATH
    export LD_LIBRARY_PATH=/xxx/ivorysql/lib

source .bashrc</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：根据实际情况添加，有的可以不用添加。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>4、卸载deb包</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">dpkg -r ivorysql</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="卸载-ivorysql-数据库"><a class="anchor" href="#卸载-ivorysql-数据库"></a>1.7. 卸载 IvorySQL 数据库</h3>
<div class="sect3">
<h4 id="编译卸载"><a class="anchor" href="#编译卸载"></a>1.7.1. 编译卸载</h4>
<div class="paragraph">
<p>1.备份数据：数据目录在“/ivorysql/1.2/data”下，所以我们将该目录保护好就可以，最好停止数据库服务后做备份。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl stop ivorysql-1.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.编译卸载：oot会话下切到源码目录下，分别执行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">make uninstall
make clean</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.删除残余目录和文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl disable ivorysql.servicemake                  --禁用服务
mv /usr/lib/systemd/system/ivorysql.service /tmp/       --服务文件移到/tmp，删除也可以
rm -fr /usr/local/pgsql                                 --删除残留安装目录</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：还有用户ivorysql以及对应的环境变量，可以根据情况是否清理。剩下的就是数据目录“/ivorysql/1.2/data”了，请务必做好备份再做处理。还有安装的依赖包，可根据情况决定是否卸载。</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="yum卸载"><a class="anchor" href="#yum卸载"></a>1.7.2. YUM卸载</h4>
<div class="paragraph">
<p>1.停止数据库服务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl stop ivorysql-1.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>先使用“yum history list”确定yum安装的事务ID：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">[root@Node02 ~]# yum history list
Loaded plugins: fastestmirror
ID     | Login user               | Date and time    | Action(s)      | Altered
-------------------------------------------------------------------------------
     5 | root &lt;root&gt;              | 2022-04-27 12:38 | Install        |   11  &lt;
     4 | root &lt;root&gt;              | 2022-03-26 16:08 | Install        |   35 &gt;
     3 | root &lt;root&gt;              | 2022-03-26 16:07 | I, U           |   19
     2 | root &lt;root&gt;              | 2022-03-26 16:07 | I, U           |   73
     1 | System &lt;unset&gt;           | 2022-03-26 15:59 | Install        |  299
history list</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到ID为5的是执行安装的事务。执行命令卸载（需将XX替换为“5”）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">yum history undo XX</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.卸载：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">yum remove ivorysql-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>但该命令卸载并不彻底，只卸载了2个依赖，还有8个依赖未能卸载。可以根据是否保留这些依赖而决定是否使用这种方式卸载。</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="IvorySQL运维人员指南-中文版-0.1.html">运维人员指南</a></span>
  <span class="next"><a href="开发者指南.html">开发者指南</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
