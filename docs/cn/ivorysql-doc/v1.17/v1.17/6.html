<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装部署 :: IvorySQL文档中心</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/v1.17/v1.17/6.html">
    <link rel="prev" href="5.html">
    <link rel="next" href="7.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL文档中心</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.ivorysql.org/">官方网站</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="v1.17">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="welcome.html">欢迎</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1.html">发行说明</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2.html">关于IvorySQL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL入门</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.html">用户使用手册</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.html">管理员指南</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5.html">运维人员指南</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="6.html">安装部署</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="7.html">社区贡献指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="8.html">工具参考</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="9.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">功能列表</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10.html">1、Ivorysql框架设计</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11.html">2、GUC框架</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12.html">3、适配插件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13.html">4、双模式设计</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14.html">5、新增Oracle兼容模式的端口与Ip</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">v1.17</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../v4.4/v4.4/welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../v4.4/v4.4/welcome.html">v4.4</a>
        </li>
        <li class="version">
          <a href="../../v4.2/v4.2/welcome.html">v4.2</a>
        </li>
        <li class="version">
          <a href="../../v4.0/v4.0/welcome.html">v4.0</a>
        </li>
        <li class="version">
          <a href="../../v3.4/v3.4/welcome.html">v3.4</a>
        </li>
        <li class="version">
          <a href="../../v3.3/v3.3/welcome.html">v3.3</a>
        </li>
        <li class="version">
          <a href="../../v3.2/v3.2/welcome.html">v3.2</a>
        </li>
        <li class="version">
          <a href="../../v3.1/v3.1/welcome.html">v3.1</a>
        </li>
        <li class="version">
          <a href="../../v3.0/v3.0/welcome.html">v3.0</a>
        </li>
        <li class="version">
          <a href="../../v2.3/v2.3/welcome.html">v2.3</a>
        </li>
        <li class="version">
          <a href="../../v2.2/v2.2/welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../../v2.1/v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version is-current">
          <a href="welcome.html">v1.17</a>
        </li>
        <li class="version">
          <a href="../../v1.8/v1.8/welcome.html">v1.8</a>
        </li>
        <li class="version">
          <a href="../../v1.5/v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version">
          <a href="../../v1.4/v1.4/welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../../v1.3/v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../../v1.2/v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../../v1.1/v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../v4.4/v4.4/welcome.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="welcome.html">IvorySQL</a></li>
    <li><a href="6.html">安装部署</a></li>
  </ul>
</nav>
  <div class="page-versions">
  <button class="version-menu-toggle" title="switch to English">CN</button>
  <div class="version-menu">
    <a class="version is-current" href="">CN</a>
    <a class="version" href="../../../../en/ivorysql-doc/v1.17/v1.17/6.html">EN</a>
  </div>
  </div>
  <div class="edit-this-page"><a href="https://github.com/IvorySQL/ivorysql_docs/edit/v1.17/CN/modules/ROOT/pages/v1.17/6.adoc">编辑此页面</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="目录" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page"><strong>安装部署</strong></h1>
<div class="sect1">
<h2 id="centos安装概述"><a class="anchor" href="#centos安装概述"></a>1. CentOS安装概述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本文介绍 IvorySQL 在Linux平台（以CentOS 7为例）的安装过程及注意事项。本文主要演示数据库在Centos 7环境下rpm包安装步骤、源码安装步骤。</p>
</div>
<div class="sect2">
<h3 id="软硬件要求"><a class="anchor" href="#软硬件要求"></a>1.1. 软硬件要求</h3>
<div class="sect3">
<h4 id="软件资源介绍"><a class="anchor" href="#软件资源介绍"></a>1.1.1. 软件资源介绍</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作系统</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPM包下载地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/IvorySQL/IvorySQL/releases" class="bare">https://github.com/IvorySQL/IvorySQL/releases</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="硬件资源准备"><a class="anchor" href="#硬件资源准备"></a>1.1.2. 硬件资源准备</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>配置参数</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>最低配置</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>推荐配置</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4核</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16核</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>内存</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>存储</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800MB，机械硬盘</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5GB以上，SSD或NvMe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>网络</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">千兆网络</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">万兆网络</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="环境和配置检查"><a class="anchor" href="#环境和配置检查"></a>1.2. 环境和配置检查</h3>
<div class="paragraph">
<p>部署 IvorySQL 数据库前，您需要进行系统环境和配置检查</p>
</div>
<div class="sect3">
<h4 id="查看资源"><a class="anchor" href="#查看资源"></a>1.2.1. 查看资源</h4>
<div class="paragraph">
<p>IvorySQL 数据库支持CentOS 7.X操作系统。详细信息，参考<a href="#_软硬件要求">[_软硬件要求]</a></p>
</div>
</div>
<div class="sect3">
<h4 id="查看操作系统"><a class="anchor" href="#查看操作系统"></a>1.2.2. 查看操作系统</h4>
<div class="paragraph">
<p><strong>CentOS 7.X</strong></p>
</div>
<div class="paragraph">
<p>运行以下命令，查看操作系统信息：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat /etc/redhat-release</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="查看内核参数"><a class="anchor" href="#查看内核参数"></a>1.2.3. 查看内核参数</h4>
<div class="literalblock">
<div class="content">
<pre>uname -r</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="查看内存清理缓存"><a class="anchor" href="#查看内存清理缓存"></a>1.2.4. 查看内存，清理缓存</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">    free -g

    echo 3 &gt; /proc/sys/vm/drop_caches</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="获取安装包"><a class="anchor" href="#获取安装包"></a>1.3. 获取安装包</h3>
<div class="paragraph">
<p>您可以通过 源码安装 IvorySQL 数据库或 RPM 包安装。</p>
</div>
<div class="sect3">
<h4 id="使用源码构建ivorysql数据库"><a class="anchor" href="#使用源码构建ivorysql数据库"></a>1.3.1. 使用源码构建IvorySQL数据库</h4>
<div class="paragraph">
<p>1.获取源代码：运行以下命令，克隆 IvorySQL 数据库源代码到您的构建机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">git clone https://github.com/IvorySQL/IvorySQL.git</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：克隆代码需要先安装配置 Git。详细信息，参考 <a href="https://git-scm.com/doc">Git 文档</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.安装依赖包：要从源代码编译 IvorySQL，必须确保系统上有可用的先决条件包。 执行以下命令安装相关包：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">sudo yum install -y bison-devel readline-devel zlib-devel openssl-devel wget
sudo yum groupinstall -y 'Development Tools'</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：“Development Tools” 包含了gcc，make，flex，bison。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.自行编译安装：前面通过获取的源码在文件夹IvorySQL里，接下来我们就进入这个文件夹进行操作。</p>
</div>
<div class="paragraph">
<p>3.1 配置：Root用户执行以下命令进行配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">git checkout tags/Ivory_REL_1_17
./configure --prefix=/usr/local/ivorysql/ivorysql-1.17</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明： 如果没有提供 <code>--prefix</code>，默认将安装在 <code>/usr/local/ivorysql</code>。</p>
</div>
<div class="paragraph">
<p>注意：我们要记住指定的目录，因为系统查不出已经编译安装的程序在哪。更多 configure 参数通过 <code>./configure --help</code> 查看。还可以查看 PostgreSQL 手册。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.2 编译安装：配置完成后，执行 make 进行编译：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>make</pre>
</div>
</div>
<div class="paragraph">
<p>要在安装新编译的服务之前使用回归测试测试一下，以下命令均可：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">make check
make all-check-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后安装：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo make install</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="使用-rpm-包安装-ivorysql-数据库"><a class="anchor" href="#使用-rpm-包安装-ivorysql-数据库"></a>1.3.2. 使用 RPM 包安装 IvorySql 数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行以下命令，下载 IvorySQL 安装包。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">wget https://github.com/IvorySQL/IvorySQL/releases/download/Ivory_REL_1_17/IvorySQL-1.17-fde5539-20250326.x86_64.rpm</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：示例中的安装包可能不是最新版本，建议您下载最新的安装包。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.运行以下命令，安装 IvorySQL 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">-- 先安装依赖
yum install -y libicu libxslt python3
rpm -ivh IvorySQL-1.17-fde5539-20250326.x86_64.rpm</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="初始化数据库服务"><a class="anchor" href="#初始化数据库服务"></a>1.4. 初始化数据库服务</h3>
<div class="sect3">
<h4 id="初始化数据库"><a class="anchor" href="#初始化数据库"></a>1.4.1. 初始化数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建操作系统用户：用户root会话下，新建用户 ivorysql：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">/usr/sbin/groupadd ivorysql
/usr/sbin/useradd -g ivorysql ivorysql -c "IvorySQL1.17"
passwd ivorysql</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.环境变量：切换到用户ivorysql，修改文件 <code>/home/ivorysql/.bash_profile</code>，配置环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">umask 022
export LD_LIBRARY_PATH=/opt/IvorySQL-1.17/lib:$LD_LIBRARY_PATH
export PATH=/opt/IvorySQL-1.17/bin:$PATH
export PGDATA=/home/ivorysql/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>使环境变量在当前ivorysql用户会话中生效：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>source .bash_profile</pre>
</div>
</div>
<div class="paragraph">
<p>也可以重新登录或开启一个新的用户ivorysql的会话。</p>
</div>
<div class="paragraph">
<p>3.设置防火墙：如果开启了防火墙，还需要将端口1521或者5432开放：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">firewall-cmd --zone=public --add-port=1521/tcp --permanent
firewall-cmd --reload</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认端口是1521，如果不开放该端口，外部客户端通过ip连接会失败。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>4.初始化：在用户ivorysql下，简单执行initdb就可以完成初始化：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>initdb</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：initdb操作与PostgreSQL一样，可以按照PG的习惯去初始化。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>5.启动数据库：使用pg_ctl启动数据库服务：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl start</pre>
</div>
</div>
<div class="paragraph">
<p>查看状态，启动成功：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl status</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="配置服务"><a class="anchor" href="#配置服务"></a>1.5. 配置服务</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>客户端验证：修改 /home/ivorysql/data/pg_hba.conf，追加以下内容：</p>
<div class="literalblock">
<div class="content">
<pre>host    all             all             0.0.0.0/0               trust</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：trust，设置免密登录。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>执行以下命令加载配置：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl reload</pre>
</div>
</div>
<div class="paragraph">
<p>2.基本参数</p>
</div>
<div class="paragraph">
<p>通过psql连接数据库：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>psql</pre>
</div>
</div>
<div class="paragraph">
<p>修改监听地址</p>
</div>
<div class="literalblock">
<div class="content">
<pre>alter system set listen_address = '*';</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认是监听在127.0.0.1，主机外是连不上服务的。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.守护服务</p>
</div>
<div class="paragraph">
<p>创建service文件：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>touch /usr/lib/systemd/system/ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>编辑内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">[Unit]
Description=IvorySQL 1.17 database server
Documentation=https://www.ivorysql.org
Requires=network.target local-fs.target
After=network.target local-fs.target

[Service]
Type=forking

User=ivorysql
Group=ivorysql

Environment=PGDATA=/home/ivorysql/data

OOMScoreAdjust=-1000

ExecStart=/opt/IvorySQL-1.17/bin/pg_ctl start -D ${PGDATA}
ExecStop=/opt/IvorySQL-1.17/bin/pg_ctl stop -D ${PGDATA}
ExecReload=/opt/IvorySQL-1.17/bin/pg_ctl reload -D ${PGDATA}

TimeoutSec=0

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：service的写法有很多，在生产环境使用时需谨慎，请多次重复测试。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>停止pg_ctl启动的数据库服务，启用systemd服务并启动：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable --now ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>IvorSQL数据库服务操作命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl start ivorysql.service            --启动数据库服务
systemctl stop ivorysql.service             --停止数据库服务
systemctl restart ivorysql.service          --重启数据库
systemctl status ivorysql.service           --查看数据库状态
systemctl reload ivorysql.service           --可以满足部分数据库配置修改完后生效</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="卸载-ivorysql-数据库"><a class="anchor" href="#卸载-ivorysql-数据库"></a>1.6. 卸载 IvorySQL 数据库</h3>
<div class="sect3">
<h4 id="编译卸载"><a class="anchor" href="#编译卸载"></a>1.6.1. 编译卸载</h4>
<div class="paragraph">
<p>1.备份数据：我们需要将数据目录保护好，最好停止数据库服务后做备份。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl stop ivorysql.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.编译卸载：root会话下切到源码目录下，分别执行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">make uninstall
make clean</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.删除残余目录和文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl disable ivorysql.servicemake                  --禁用服务
mv /usr/lib/systemd/system/ivorysql.service /tmp/       --服务文件移到/tmp，删除也可以
rm -fr /opt/IvorySQL-1.17                                --删除残留安装目录</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：还有用户ivorysql以及对应的环境变量，可以根据情况是否清理。剩下的就是数据目录了，请务必做好备份再做处理。还有安装的依赖包，可根据情况决定是否卸载。</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ubuntu安装概述"><a class="anchor" href="#ubuntu安装概述"></a>2. Ubuntu安装概述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本文介绍 IvorySQL 在Linux平台Ubuntu（以Ubuntu2404为例）的安装过程及注意事项。演示数据库在Ubuntu 2404环境下deb包安装步骤、源码安装步骤。</p>
</div>
<div class="sect2">
<h3 id="软硬件要求-2"><a class="anchor" href="#软硬件要求-2"></a>2.1. 软硬件要求</h3>
<div class="sect3">
<h4 id="软件资源介绍-2"><a class="anchor" href="#软件资源介绍-2"></a>2.1.1. 软件资源介绍</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作系统</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEB包下载地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu 2404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/IvorySQL/IvorySQL/releases" class="bare">https://github.com/IvorySQL/IvorySQL/releases</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="硬件资源准备-2"><a class="anchor" href="#硬件资源准备-2"></a>2.1.2. 硬件资源准备</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>配置参数</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>最低配置</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>推荐配置</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4核</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16核</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>内存</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>存储</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800MB，机械硬盘</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5GB以上，SSD或NvMe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>网络</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">千兆网络</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">万兆网络</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="环境和配置检查-2"><a class="anchor" href="#环境和配置检查-2"></a>2.2. 环境和配置检查</h3>
<div class="paragraph">
<p>部署 IvorySQL 数据库前，您需要进行系统环境和配置检查</p>
</div>
<div class="sect3">
<h4 id="查看资源-2"><a class="anchor" href="#查看资源-2"></a>2.2.1. 查看资源</h4>
<div class="paragraph">
<p>IvorySQL 数据库支持Ubuntu24.x操作系统。详细信息，参考<a href="#_软硬件要求">[_软硬件要求]</a></p>
</div>
</div>
<div class="sect3">
<h4 id="查看操作系统-2"><a class="anchor" href="#查看操作系统-2"></a>2.2.2. 查看操作系统</h4>
<div class="paragraph">
<p><strong>Ubuntu 24/22.0x</strong></p>
</div>
<div class="paragraph">
<p>运行以下命令，查看操作系统信息：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat /etc/os-release</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="查看内核参数-2"><a class="anchor" href="#查看内核参数-2"></a>2.2.3. 查看内核参数</h4>
<div class="literalblock">
<div class="content">
<pre>uname -r</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="获取安装包-2"><a class="anchor" href="#获取安装包-2"></a>2.3. 获取安装包</h3>
<div class="paragraph">
<p>您可以通过源码安装IvorySQL数据库或DEB包安装。</p>
</div>
<div class="sect3">
<h4 id="使用源码构建ivorysql数据库-2"><a class="anchor" href="#使用源码构建ivorysql数据库-2"></a>2.3.1. 使用源码构建IvorySQL数据库</h4>
<div class="paragraph">
<p>1.获取源代码：运行以下命令，克隆 IvorySQL 数据库源代码到您的构建机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">git clone https://github.com/IvorySQL/IvorySQL.git</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：克隆代码需要先安装配置 Git。详细信息，参考 <a href="https://git-scm.com/doc">Git 文档</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.安装依赖包：要从源代码编译 IvorySQL，必须确保系统上有可用的先决条件包。 执行以下命令安装相关包：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">sudo apt install -y bison-devel readline-devel zlib-devel openssl-devel wget
sudo apt install -y gcc make flex bison</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.自行编译安装：前面通过获取的源码在文件夹IvorySQL里，接下来我们就进入这个文件夹进行操作。</p>
</div>
<div class="paragraph">
<p>3.1 配置：Root用户执行以下命令进行配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">git checkout tags/Ivory_REL_1_17
./configure --prefix=/usr/local/ivorysql/ivorysql-1.17</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明： 如果没有提供 <code>--prefix</code>，默认将安装在 <code>/usr/local/ivorysql</code>。</p>
</div>
<div class="paragraph">
<p>注意：我们要记住指定的目录，因为系统查不出已经编译安装的程序在哪。更多 configure 参数通过 <code>./configure --help</code> 查看。还可以查看 PostgreSQL 手册。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>3.2 编译安装：配置完成后，执行 make 进行编译：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>make</pre>
</div>
</div>
<div class="paragraph">
<p>在安装新编译的服务之前，建议先进行回归测试以确保稳定性，可以使用以下任意命令执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">make check
make all-check-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后安装：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo make install</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="使用-deb-包安装-ivorysql-数据库"><a class="anchor" href="#使用-deb-包安装-ivorysql-数据库"></a>2.3.2. 使用 DEB 包安装 IvorySQL 数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行以下命令，下载 IvorySQL 安装包。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">wget https://github.com/IvorySQL/IvorySQL/releases/download/IvorySQL_1.17/IvorySQL-1.17-fde5539-20250326.amd64.deb</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：示例中的安装包可能不是最新版本，建议您下载最新的安装包。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>2.运行以下命令，安装 IvorySQL 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">sudo apt install ./IvorySQL-1.17-fde5539-20250326.amd64.deb</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="初始化数据库服务-2"><a class="anchor" href="#初始化数据库服务-2"></a>2.4. 初始化数据库服务</h3>
<div class="sect3">
<h4 id="初始化数据库-2"><a class="anchor" href="#初始化数据库-2"></a>2.4.1. 初始化数据库</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建操作系统用户：用户root会话下，新建用户 ivorysql：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">/usr/sbin/groupadd ivorysql
/usr/sbin/useradd -m -g ivorysql -s /bin/bash  -c "IvorySQL1.17" ivorysql
usermod -a -G sudo ivorysql
passwd ivorysql

mkdir /home/ivorysql
chown -R ivorysql:ivorysql /home/ivorysql
chmod 755 /home/ivorysql</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.环境变量：切换到用户ivorysql，修改文件 <code>/home/ivorysql/.bashrc</code>，配置环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">umask 022
export LD_LIBRARY_PATH=/opt/IvorySQL-1.17/lib:$LD_LIBRARY_PATH
export PATH=/opt/IvorySQL-1.17/bin:/usr/local/ivorysql/ivorysql-1.17/bin:$PATH #取决于安装路径
export PGDATA=/home/ivorysql/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>使环境变量在当前ivorysql用户会话中生效：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>source .bashrc</pre>
</div>
</div>
<div class="paragraph">
<p>也可以重新登录或开启一个新的用户ivorysql的会话。</p>
</div>
<div class="paragraph">
<p>3.设置防火墙：如果开启了防火墙，还需要将端口1521或者5432开放：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">firewall-cmd --zone=public --add-port=1521/tcp --permanent
firewall-cmd --reload</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认端口是1521，外部客户端若想通过此端口连接需开放该端口。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>4.初始化：在用户ivorysql下，简单执行initdb就可以完成初始化：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>initdb -D $PGDATA</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：initdb操作与PostgreSQL一样，可以按照PG的习惯去初始化。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>5.启动数据库：使用pg_ctl启动数据库服务：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl -D $PGDATA -l logfile start</pre>
</div>
</div>
<div class="paragraph">
<p>查看状态：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl -D $PGDATA status</pre>
</div>
</div>
<div class="paragraph">
<p>启动成功会有如下输出：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl: server is running (PID: 2273)</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="配置服务-2"><a class="anchor" href="#配置服务-2"></a>2.5. 配置服务</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>客户端验证：修改 $PGDATA/pg_hba.conf，追加以下内容：</p>
<div class="literalblock">
<div class="content">
<pre>host    all             all             0.0.0.0/0               trust</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>注意：trust，设置免密登录。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>监听地址：修改$PGDATA/postgresql.conf ，追加以下内容：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>listen_addresses = '*'</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：默认是监听在127.0.0.1，主机外是连不上服务的。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>执行以下命令加载配置：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pg_ctl reload</pre>
</div>
</div>
<div class="paragraph">
<p>2.连接数据库</p>
</div>
<div class="paragraph">
<p>通过psql连接数据库：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>psql</pre>
</div>
</div>
<div class="paragraph">
<p>3.守护服务</p>
</div>
<div class="paragraph">
<p>创建service文件：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo vi /etc/systemd/system/ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>编辑内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">[Unit]
Description=IvorySQL 1.17 database server
Documentation=https://www.ivorysql.org
Requires=network.target local-fs.target
After=network.target local-fs.target

[Service]
Type=forking

User=ivorysql
Group=ivorysql

Environment=PGDATA=/home/ivorysql/data

OOMScoreAdjust=-1000

ExecStart=/usr/local/ivorysql/ivorysql-1.17/bin/pg_ctl start -D ${PGDATA}
ExecStop=/usr/local/ivorysql/ivorysql-1.17/bin/pg_ctl stop -D ${PGDATA}
ExecReload=/usr/local/ivorysql/ivorysql-1.17/bin/pg_ctl reload -D ${PGDATA}

TimeoutSec=0

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：service的写法有很多，在生产环境使用时需谨慎，请多次重复测试。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>停止pg_ctl启动的数据库服务，启用systemd服务并启动：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable --now ivorysql.service</pre>
</div>
</div>
<div class="paragraph">
<p>IvorSQL数据库服务操作命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl start ivorysql.service            --启动数据库服务
systemctl stop ivorysql.service             --停止数据库服务
systemctl restart ivorysql.service          --重启数据库
systemctl status ivorysql.service           --查看数据库状态
systemctl reload ivorysql.service           --可以满足部分数据库配置修改完后生效</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="卸载-ivorysql-数据库-2"><a class="anchor" href="#卸载-ivorysql-数据库-2"></a>2.6. 卸载 IvorySQL 数据库</h3>
<div class="sect3">
<h4 id="编译卸载-2"><a class="anchor" href="#编译卸载-2"></a>2.6.1. 编译卸载</h4>
<div class="paragraph">
<p>1.备份数据：我们需要将数据目录保护好，最好停止数据库服务后做备份。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl stop ivorysql.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.编译卸载：root会话下切到源码目录下，分别执行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">make uninstall
make clean</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.删除残余目录和文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">systemctl disable ivorysql.service                      --禁用服务
mv /usr/lib/systemd/system/ivorysql.service /tmp/       --服务文件移到/tmp
rm -fr /usr/local/ivorysql/ivorysql-1.17                --删除残留安装目录</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>说明：还有用户ivorysql以及对应的环境变量，可以根据情况是否清理。剩下的就是数据目录了，请务必做好备份再做处理。还有安装的依赖包，可根据情况决定是否卸载。</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="5.html">运维人员指南</a></span>
  <span class="next"><a href="7.html">社区贡献指南</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
