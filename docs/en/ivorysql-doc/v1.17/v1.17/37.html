<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pg_cron :: IvorySQL Document Site</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/v1.17/v1.17/37.html">
    <link rel="prev" href="36.html">
    <link rel="next" href="38.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL Document Site</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.ivorysql.org/">Home</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="v1.17">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="welcome.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1.html">Release</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started with IvorySQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5.html">Maintenance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Advanced Feature</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="6.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.html">Developer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="8.html">Operation Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Ecosystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="33.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="9.html">PostGIS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10.html">pgvector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="34.html">PGroonga</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="35.html">pgddl (DDL Extractor)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="36.html">pgRouting</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="37.html">pg_cron</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="38.html">pgsql-http</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="40.html">pgvectorscale</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">List of Oracle compatible features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11.html">1、Ivorysql frame design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12.html">2、GUC Framework</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13.html">3、Case conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="14.html">4、Dual-mode design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="15.html">5、Compatible with Oracle like</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="16.html">6、Compatible with Oracle anonymous block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="17.html">7、Compatible with Oracle functions and stored procedures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="18.html">8、Built-in data types and built-in functions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="19.html">9、Added Oracle compatibility mode ports and IP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="20.html">Community contribution</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="21.html">Tool Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="22.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">v1.17</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../master/welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../master/welcome.html">master</a>
        </li>
        <li class="version">
          <a href="../../v4.6/v4.6/welcome.html">v4.6</a>
        </li>
        <li class="version">
          <a href="../../v4.5/v4.5/welcome.html">v4.5</a>
        </li>
        <li class="version">
          <a href="../../v4.4/v4.4/welcome.html">v4.4</a>
        </li>
        <li class="version">
          <a href="../../v4.2/v4.2/welcome.html">v4.2</a>
        </li>
        <li class="version">
          <a href="../../v4.0/v4.0/welcome.html">v4.0</a>
        </li>
        <li class="version">
          <a href="../../v3.4/v3.4/welcome.html">v3.4</a>
        </li>
        <li class="version">
          <a href="../../v3.3/v3.3/welcome.html">v3.3</a>
        </li>
        <li class="version">
          <a href="../../v3.2/v3.2/welcome.html">v3.2</a>
        </li>
        <li class="version">
          <a href="../../v3.1/v3.1/welcome.html">v3.1</a>
        </li>
        <li class="version">
          <a href="../../v3.0/v3.0/welcome.html">v3.0</a>
        </li>
        <li class="version">
          <a href="../../v2.3/v2.3/welcome.html">v2.3</a>
        </li>
        <li class="version">
          <a href="../../v2.2/v2.2/welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../../v2.1/v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version is-current">
          <a href="welcome.html">v1.17</a>
        </li>
        <li class="version">
          <a href="../../v1.8/v1.8/welcome.html">v1.8</a>
        </li>
        <li class="version">
          <a href="../../v1.5/v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version">
          <a href="../../v1.4/v1.4/welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../../v1.3/v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../../v1.2/v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../../v1.1/v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="welcome.html">IvorySQL</a></li>
    <li>IvorySQL Ecosystem</li>
    <li><a href="37.html">pg_cron</a></li>
  </ul>
</nav>
  <div class="page-versions">
  <button class="version-menu-toggle" title="switch to Chinese">EN</button>
  <div class="version-menu">
    <a class="version is-current" href="">EN</a>
    <a class="version" href="../../../../cn/ivorysql-doc/v1.17/v1.17/37.html">CN</a>
  </div>
  </div>
  <div class="edit-this-page"><a href="https://github.com/IvorySQL/ivorysql_docs/edit/v1.17/EN/modules/ROOT/pages/v1.17/37.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">pg_cron</h1>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Running periodic tasks in PostgreSQL, such as executing VACUUM or deleting old data, is a common requirement. A simple way to achieve this is to configure cron or other external daemons to periodically connect to the database and run commands. However, as databases increasingly run as managed services or standalone containers, configuring and running a separate daemon often becomes impractical. Additionally, it&#8217;s difficult to make your cron jobs aware of failover or schedule tasks across cluster nodes.</p>
</div>
<div class="paragraph">
<p>pg_cron is an open-source scheduled task extension for PostgreSQL that allows setting up cron-style task scheduling directly within the database for automating data maintenance tasks (cleanup, aggregation), database health checks, executing stored procedures and custom functions, and other operations. It stores cron jobs in tables, and periodic tasks automatically fail over with the PostgreSQL server. For more details, see <a href="https://github.com/citusdata/pg_cron">pg_cron documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation-and-configuration"><a class="anchor" href="#installation-and-configuration"></a>2. Installation and Configuration</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The source installation environment is Ubuntu 24.04 (x86_64). IvorySQL 1.17 and above is already installed in the environment, with the installation path at /usr/local/ivorysql/ivorysql-1
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="source-installation"><a class="anchor" href="#source-installation"></a>2.1. Source Installation</h3>
<div class="literalblock">
<div class="content">
<pre># Clone pg_cron source code
git clone https://github.com/citusdata/pg_cron.git
cd pg_cron
# Set pg_config path to PATH environment variable, e.g.:
export PATH=/usr/local/ivorysql/ivorysql-1/bin/:$PATH
make
make install</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-file-ivorysql-conf"><a class="anchor" href="#configuration-file-ivorysql-conf"></a>2.2. Configuration File (ivorysql.conf)</h3>
<div class="literalblock">
<div class="content">
<pre># Shared preload extensions
shared_preload_libraries = 'pg_cron'

# Specify task metadata storage database (default current database)
cron.database_name = 'ivorysql'

# Maximum number of concurrent tasks allowed
cron.max_running_jobs = 5</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restart-service"><a class="anchor" href="#restart-service"></a>2.3. Restart Service</h3>
<div class="literalblock">
<div class="content">
<pre>pg_ctl restart -D ./data -l logfile</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-extension-and-confirm-pg_cron-version"><a class="anchor" href="#create-extension-and-confirm-pg_cron-version"></a>2.4. Create Extension and Confirm pg_cron Version</h3>
<div class="paragraph">
<p>Connect to the database with psql and execute the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ivorysql=# CREATE extension pg_cron;
CREATE EXTENSION

ivorysql=# SELECT * FROM pg_available_extensions WHERE name = 'pg_cron';
   name  | default_version | installed_version |         comment
---------+-----------------+-------------------+---------------------------
 pg_cron | 1.6             |                   |Job scheduler for PostgreSQL
(1 row)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core-functionality-usage"><a class="anchor" href="#core-functionality-usage"></a>3. Core Functionality Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="creating-scheduled-tasks"><a class="anchor" href="#creating-scheduled-tasks"></a>3.1. Creating Scheduled Tasks</h3>
<div class="literalblock">
<div class="content">
<pre>SELECT cron.schedule(
    'nightly-data-cleanup',        -- Task name (unique identifier)
    '0 3 * * *',                   -- Cron expression (daily at UTC 3:00)
    $$DELETE FROM logs
      WHERE created_at &lt; now() - interval '30 days'$$  -- SQL to execute
);</pre>
</div>
</div>
<div class="paragraph">
<p>Cron expression quick reference:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Example</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meaning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'0 * * * *'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute every hour on the hour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'*/15 * * * *'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute every 15 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'0 9 * * 1-5'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute at 9 AM on weekdays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'0 1 1 * *'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute at 1 AM on the 1st of every month</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>pg_cron also allows using '$' to represent the last day of the month.</p>
</div>
</div>
<div class="sect2">
<h3 id="task-management"><a class="anchor" href="#task-management"></a>3.2. Task Management</h3>
<div class="literalblock">
<div class="content">
<pre># View all tasks
SELECT * FROM cron.job;</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p31.png" alt="p31">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># View task execution history
SELECT * FROM cron.job_run_details ORDER BY start_time DESC LIMIT 10;</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p32.png" alt="p32">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># Delete task
SELECT cron.unschedule('nightly-data-cleanup');

# Pause task (update status)
UPDATE cron.job SET active = false WHERE jobname = 'delete-job-run-details';</pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="36.html">pgRouting</a></span>
  <span class="next"><a href="38.html">pgsql-http</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
