<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>out parameter :: IvorySQL Document Site</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/master/7.15.html">
    <link rel="prev" href="7.14.html">
    <link rel="next" href="7.16.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL Document Site</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.ivorysql.org/">Home</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="welcome.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1.html">Release</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started with IvorySQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.1.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.2.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3.3.html">Maintenance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Advanced Feature</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.1.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.2.html">Building Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.3.html">Developer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.4.html">Operation Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4.5.html">Migration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Ecosystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5.1.html">PostGIS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5.2.html">pgvector</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IvorySQL Architecture Design</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Query Processing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.1.1.html">Dual Parser</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Compatibility Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.2.1.html">initdb Process</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Compatibility Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.3.1.html">like</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.3.3.html">RowID</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.3.2.html">OUT Parameter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.3.4.html">%Type &amp; %Rowtype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="6.3.5.html">NLS Parameters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="6.4.html">GB18030 Character Set</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">List of Oracle compatible features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.1.html">1、Ivorysql frame design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.2.html">2、GUC Framework</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.3.html">3、Case conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.4.html">4、Dual-mode design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.5.html">5、Compatible with Oracle like</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.6.html">6、Compatible with Oracle anonymous block</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.7.html">7、Compatible with Oracle functions and stored procedures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.8.html">8、Built-in data types and built-in functions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.9.html">9、Added Oracle compatibility mode ports and IP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.10.html">10、XML Function</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.11.html">11、Compatible with Oracle sequence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.12.html">12、Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.13.html">13、Invisible Columns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.14.html">14、RowID Column</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="7.15.html">15、OUT Parameter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.16.html">16、%Type &amp; %Rowtype</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="7.17.html">17、NLS Parameters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="8.html">Community contribution</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="9.html">Tool Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="welcome.html">master</a>
        </li>
        <li class="version">
          <a href="../v4.6/v4.6/welcome.html">v4.6</a>
        </li>
        <li class="version">
          <a href="../v4.5/v4.5/welcome.html">v4.5</a>
        </li>
        <li class="version">
          <a href="../v4.4/v4.4/welcome.html">v4.4</a>
        </li>
        <li class="version">
          <a href="../v4.2/v4.2/welcome.html">v4.2</a>
        </li>
        <li class="version">
          <a href="../v4.0/v4.0/welcome.html">v4.0</a>
        </li>
        <li class="version">
          <a href="../v3.4/v3.4/welcome.html">v3.4</a>
        </li>
        <li class="version">
          <a href="../v3.3/v3.3/welcome.html">v3.3</a>
        </li>
        <li class="version">
          <a href="../v3.2/v3.2/welcome.html">v3.2</a>
        </li>
        <li class="version">
          <a href="../v3.1/v3.1/welcome.html">v3.1</a>
        </li>
        <li class="version">
          <a href="../v3.0/v3.0/welcome.html">v3.0</a>
        </li>
        <li class="version">
          <a href="../v2.3/v2.3/welcome.html">v2.3</a>
        </li>
        <li class="version">
          <a href="../v2.2/v2.2/welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../v2.1/v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version">
          <a href="../v1.17/v1.17/welcome.html">v1.17</a>
        </li>
        <li class="version">
          <a href="../v1.8/v1.8/welcome.html">v1.8</a>
        </li>
        <li class="version">
          <a href="../v1.5/v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version">
          <a href="../v1.4/v1.4/welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../v1.3/v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../v1.2/v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../v1.1/v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../v1.0/v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="welcome.html">IvorySQL</a></li>
    <li>List of Oracle compatible features</li>
    <li><a href="7.15.html">15、OUT Parameter</a></li>
  </ul>
</nav>
  <div class="page-versions">
  <button class="version-menu-toggle" title="switch to Chinese">EN</button>
  <div class="version-menu">
    <a class="version is-current" href="">EN</a>
    <a class="version" href="../../../../cn/ivorysql-doc/master/7.15.html">CN</a>
  </div>
  </div>
  <div class="edit-this-page"><a href="https://github.com/IvorySQL/ivorysql_docs/edit/master/EN/modules/ROOT/pages/master/7.15.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">out parameter</h1>
<div class="sect1">
<h2 id="objective"><a class="anchor" href="#objective"></a>1. Objective</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IvorySQL provides Oracle-compatible OUT parameter functionality, including functions and procedures with OUT parameters, support for OUT parameters in anonymous blocks, and libpq support for OUT parameters.</p>
</div>
<div class="paragraph">
<p>This document aims to introduce the functionality of OUT parameters to users.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="function-descriptions"><a class="anchor" href="#function-descriptions"></a>2. Function descriptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IvorySQL provides Oracle-compatible OUT parameter functionality, including the following features.</p>
</div>
<div class="sect2">
<h3 id="functions-with-out-parameters"><a class="anchor" href="#functions-with-out-parameters"></a>2.1. functions with OUT parameters</h3>
<div class="paragraph">
<p>Syntax：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE [ OR REPLACE ] FUNCTION
    name ( [ [ argmode ] [ argname ] argtype [ { DEFAULT | = } default_expr ] [, ...] ] )
    [ RETURNS rettype
      | RETURNS TABLE ( column_name column_type [, ...] ) ]
  { LANGUAGE lang_name
    | TRANSFORM { FOR TYPE type_name } [, ... ]
    | WINDOW
    | { IMMUTABLE | STABLE | VOLATILE }
    | [ NOT ] LEAKPROOF
    | { CALLED ON NULL INPUT | RETURNS NULL ON NULL INPUT | STRICT }
    | { [ EXTERNAL ] SECURITY INVOKER | [ EXTERNAL ] SECURITY DEFINER }
    | PARALLEL { UNSAFE | RESTRICTED | SAFE }
    | COST execution_cost
    | ROWS result_rows
    | SUPPORT support_function
    | SET configuration_parameter { TO value | = value | FROM CURRENT }
    | AS 'definition'
    | AS 'obj_file', 'link_symbol'
    | sql_body
  } ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argmode can be IN, OUT, INOUT (IN OUT), or VARIADIC. If not specified, the default is IN. The argmode can also be written after the argname.</p>
</div>
<div class="paragraph">
<p>Unlike native PostgreSQL, Oracle-compatible OUT parameters are not associated with the return value data type. Neither IN OUT nor OUT modes can have default values. If there are OUT parameters and the function&#8217;s return type is not void, the function body must include a RETURN statement.</p>
</div>
</div>
<div class="sect2">
<h3 id="support-for-out-parameters-in-anonymous-blocks"><a class="anchor" href="#support-for-out-parameters-in-anonymous-blocks"></a>2.2. support for OUT parameters in anonymous blocks</h3>
<div class="paragraph">
<p>Supports binding variables in the form of colon placeholders, such as :1, :name.</p>
</div>
<div class="paragraph">
<p>Added new DO+USING syntax： DO [ LANGUAGE lang_name ] code [USING IN | OUT | IN OUT, &#8230;&#8203;]</p>
</div>
<div class="paragraph">
<p>Supports binding variables in libpq by position and by parameter name, providing the system function get_parameter_description, which returns the relationship between variable names and their positions based on the SQL statement.</p>
</div>
</div>
<div class="sect2">
<h3 id="calling-functions-with-out-parameters-in-libpq"><a class="anchor" href="#calling-functions-with-out-parameters-in-libpq"></a>2.3. calling functions with OUT parameters in libpq</h3>
<div class="paragraph">
<p>The libpq interface provides functions for preparing, binding, and executing statements, which are similar to the corresponding OCI functions.
The usage process is as follows:</p>
</div>
<div class="paragraph">
<p>Use IvyHandleAlloc to allocate statement and error handles.
Call IvyStmtPrepare to prepare the statement.
Call IvyBindByPos or IvyBindByName to bind parameters.
Call IvyStmtExecute to execute, which can be repeated.
Call IvyFreeHandle to release the statement and error handles.</p>
</div>
<div class="paragraph">
<p>Additionally, a series of interface functions have been implemented, including Ivyconnectdb, Ivystatus, Ivyexec, IvyresultStatus, IvyCreatePreparedStatement, IvybindOutParameterByPos, IvyexecPreparedStatement, IvyexecPreparedStatement2, Ivynfields, Ivyntuples, and Ivyclear.</p>
</div>
<div class="paragraph">
<p>Example programs can be found in the src/interfaces/libpq/ivytest directory of the source code.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-examples"><a class="anchor" href="#test-examples"></a>3. test examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="functions-with-out-parameters-2"><a class="anchor" href="#functions-with-out-parameters-2"></a>3.1. functions with OUT parameters</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>OUT parameters are not associated with the return value data type</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ivorysql=# create or replace function test_return_out(id integer,price out integer,name out varchar) return varchar
ivorysql-# as
ivorysql-# begin
ivorysql-#   price := 20000;
ivorysql-#   name := 'test a char out';
ivorysql-#   return 'welcome to QingDao';
ivorysql-# end;
ivorysql-# /
CREATE FUNCTION</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Neither IN OUT nor OUT modes can have default values</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ivorysql=# create or replace function test_return_inout(id integer,price in out integer default 100,name out varchar) return varchar
ivorysql-# as
ivorysql-# begin
ivorysql-#   price := 20000 + price;
ivorysql-#   name := 'this is a test';
ivorysql-# return 'welcome to QingDao';
ivorysql-# end;
ivorysql-# /
ERROR:  IN OUT formal parameters may have no default expressions</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If there are OUT parameters and the function&#8217;s return type is not void, the function body must include a RETURN statement.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">--if function's return type is non-void, the function body must has RETURN statement
--if there is no RETURN statement, the function can be created, but when it is called,
--an error is raised
ivorysql=# create or replace function f2(id integer,price out integer) return varchar
ivorysql-# as
ivorysql-# begin
ivorysql-#   price := 2;
ivorysql-# end;
ivorysql-# /
CREATE FUNCTION
ivorysql=# declare
ivorysql-#   a varchar(20);
ivorysql-#   b int;
ivorysql-# begin
ivorysql-#   a := f2(1, b);
ivorysql-# end;
ivorysql-# /
ERROR:  Function returned without value
CONTEXT:  PL/iSQL function f2(pg_catalog.int4,pg_catalog.int4) line 0 at RETURN
PL/iSQL function inline_code_block line 5 at assignment</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="support-out-parameters-in-anonymous-block"><a class="anchor" href="#support-out-parameters-in-anonymous-block"></a>3.2. support OUT parameters in anonymous block</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Supports binding variables in the form of colon placeholders and new DO+USING syntax</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ivorysql=# do $$
ivorysql$# declare
ivorysql$#   a int;
ivorysql$# begin
ivorysql$#   :x := 1;
ivorysql$#   :y := 2;
ivorysql$# end; $$ using out, out;
 $1 | $2
----+----
  1 |  2
(1 row)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>system function get_parameter_descr()</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ivorysql=# select * from get_parameter_description('insert into t values(:x,:y)');
 name  | position
-------+----------
 false |        0
 :x    |        1
 :y    |        2
(3 rows)</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="7.14.html">14、RowID Column</a></span>
  <span class="next"><a href="7.16.html">16、%Type &amp; %Rowtype</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
