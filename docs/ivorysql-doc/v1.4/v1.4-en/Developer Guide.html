<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developer Guide :: IvorySQL Document Site</title>
    <link rel="canonical" href="https://docs.ivorysql.org/ivorysql-doc/v1.4/v1.4-en/Developer%20Guide.html">
    <link rel="prev" href="安装部署-英文版-0.1.html">
    <link rel="next" href="运维管理指南-英文版-0.2.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ivorysql.org">IvorySQL Document Site</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable" style="display:none">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="docs.ivorysql.org">IvorySQL</a>
            <a class="navbar-item" href="docs.ivorysql.org">Migrations</a>
            <a class="navbar-item" href="docs.ivorysql.org">AdminUI</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable" style="display:none">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Migration Services</a>
            <a class="navbar-item" href="#">Remote DBA</a>
            <a class="navbar-item" href="#">Perfornace Tuning</a>
          </div>
        </div>
        <div class="navbar-item" style="display:none">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ivorysql-doc" data-version="v1.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../welcome.html">IvorySQL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../welcome.html">Welcome to IvorySQL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL1.4发行说明.html">Release</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL关于-英文版-0.2.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started with IvorySQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IvorySQL入门-英文版-0.1.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Administrator%20Guide.html">Administrator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IvorySQL运维人员指南-英文版-0.1.html">Operating personnel</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="安装部署-英文版-0.1.html">Installation Deployment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Developer%20Guide.html">Developer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="运维管理指南-英文版-0.2.html">Operation Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL迁移指南-英文版-0.1.html">Migration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="IvorySQL社区贡献指南-英文版-0.3.html">Community contribution</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tool%20Reference.html">Tool Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ-en.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IvorySQL</span>
    <span class="version">v1.4</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../v2.2/welcome.html">IvorySQL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../v2.2/welcome.html">v2.2</a>
        </li>
        <li class="version">
          <a href="../../v2.1/welcome.html">v2.1</a>
        </li>
        <li class="version">
          <a href="../../v1.5/welcome.html">v1.5</a>
        </li>
        <li class="version is-current">
          <a href="../welcome.html">v1.4</a>
        </li>
        <li class="version">
          <a href="../../v1.3/welcome.html">v1.3</a>
        </li>
        <li class="version">
          <a href="../../v1.2/welcome.html">v1.2</a>
        </li>
        <li class="version">
          <a href="../../v1.1/welcome.html">v1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/welcome.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../ivorysql-doc-cn/v2.2/welcome.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../welcome.html">IvorySQL</a></li>
    <li><a href="Developer%20Guide.html">Developer</a></li>
  </ul>
</nav>
<div class="page-versions">
<button class="version-menu-toggle" title="">EN</button>
<div class="version-menu">
    <a class="version is-current" href="Developer Guide.html">EN</a>
    <a class="version" href="../../../ivorysql-doc-cn/v1.4/v1.4-cn/开发者指南.html">CN</a>
</div>
</div>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.4</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../v2.2/welcome.html">v2.2</a>
    <a class="version is-missing" href="../../v2.1/welcome.html">v2.1</a>
    <a class="version is-missing" href="../../v1.5/welcome.html">v1.5</a>
    <a class="version is-current" href="Developer%20Guide.html">v1.4</a>
    <a class="version is-missing" href="../../v1.3/welcome.html">v1.3</a>
    <a class="version is-missing" href="../../v1.2/welcome.html">v1.2</a>
    <a class="version is-missing" href="../../v1.1/welcome.html">v1.1</a>
    <a class="version is-missing" href="../../v1.0/welcome.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/IvorySQL/ivorysql_docs/edit/v1.4/EN/modules/ROOT/pages/v1.4-en/Developer%20Guide.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Developer Guide</h1>
<div id="toc" class="toc" style="display:none">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#architecture-overview">1.1. Architecture Overview</a></li>
<li><a href="#catalog-changes">1.2. Catalog changes</a></li>
</ul>
</li>
<li><a href="#database-modeling">2. Database Modeling</a>
<ul class="sectlevel2">
<li><a href="#creating-a-database">2.1. Creating a Database</a></li>
<li><a href="#creating-a-new-table">2.2. Creating a New Table</a></li>
</ul>
</li>
<li><a href="#write-to-data">3. Write to data</a></li>
<li><a href="#query-data">4. Query Data</a>
<ul class="sectlevel2">
<li><a href="#combining-queries-union-intersect-except">4.1. Combining Queries (<code>UNION</code>, <code>INTERSECT</code>, <code>EXCEPT</code>)</a></li>
<li><a href="#parallel-query">4.2. Parallel Query</a>
<ul class="sectlevel3">
<li><a href="#how-parallel-query-works">4.2.1. How Parallel Query Works</a></li>
<li><a href="#when-can-parallel-query-be-used">4.2.2. When Can Parallel Query Be Used?</a></li>
<li><a href="#parallel-plans">4.2.3. Parallel Plans</a>
<ul class="sectlevel4">
<li><a href="#parallel-scans">4.2.3.1. Parallel Scans</a></li>
<li><a href="#parallel-joins">4.2.3.2. Parallel Joins</a></li>
<li><a href="#parallel-aggregation">4.2.3.3. Parallel Aggregation</a></li>
<li><a href="#parallel-append">4.2.3.4. Parallel Append</a></li>
<li><a href="#parallel-plan-tips">4.2.3.5. Parallel Plan Tips</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#transaction">5. Transaction</a>
<ul class="sectlevel2">
<li><a href="#abort-abort-the-current-transaction">5.1. ABORT — abort the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis">5.1.1. Synopsis</a></li>
<li><a href="#description">5.1.2. Description</a></li>
<li><a href="#parameters">5.1.3. Parameters</a></li>
<li><a href="#notes">5.1.4. Notes</a></li>
<li><a href="#examples">5.1.5. Examples</a></li>
<li><a href="#compatibility">5.1.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#begin-start-a-transaction-block">5.2. BEGIN — start a transaction block</a>
<ul class="sectlevel3">
<li><a href="#synopsis-2">5.2.1. Synopsis</a></li>
<li><a href="#description-2">5.2.2. Description</a></li>
<li><a href="#parameters-2">5.2.3. Parameters</a></li>
<li><a href="#notes-2">5.2.4. Notes</a></li>
<li><a href="#examples-2">5.2.5. Examples</a></li>
<li><a href="#compatibility-2">5.2.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#commit-commit-the-current-transaction">5.3. COMMIT — commit the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-3">5.3.1. Synopsis</a></li>
<li><a href="#description-3">5.3.2. Description</a></li>
<li><a href="#parameters-3">5.3.3. Parameters</a></li>
<li><a href="#notes-3">5.3.4. Notes</a></li>
<li><a href="#examples-3">5.3.5. Examples</a></li>
<li><a href="#compatibility-3">5.3.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#commit-prepared-commit-a-transaction-that-was-earlier-prepared-for-two-phase-commit">5.4. COMMIT PREPARED — commit a transaction that was earlier prepared for two-phase commit</a>
<ul class="sectlevel3">
<li><a href="#synopsis-4">5.4.1. Synopsis</a></li>
<li><a href="#description-4">5.4.2. Description</a></li>
<li><a href="#parameters-4">5.4.3. Parameters</a></li>
<li><a href="#notes-4">5.4.4. Notes</a></li>
<li><a href="#examples-4">5.4.5. Examples</a></li>
<li><a href="#compatibility-4">5.4.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#end-commit-the-current-transaction">5.5. END — commit the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-5">5.5.1. Synopsis</a></li>
<li><a href="#description-5">5.5.2. Description</a></li>
<li><a href="#parameters-5">5.5.3. Parameters</a></li>
<li><a href="#notes-5">5.5.4. Notes</a></li>
<li><a href="#examples-5">5.5.5. Examples</a></li>
<li><a href="#compatibility-5">5.5.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#prepare-transaction-prepare-the-current-transaction-for-two-phase-commit">5.6. PREPARE TRANSACTION — prepare the current transaction for two-phase commit</a>
<ul class="sectlevel3">
<li><a href="#synopsis-6">5.6.1. Synopsis</a></li>
<li><a href="#description-6">5.6.2. Description</a></li>
<li><a href="#parameters-6">5.6.3. Parameters</a></li>
<li><a href="#notes-6">5.6.4. Notes</a></li>
<li><a href="#caution">5.6.5. Caution</a></li>
<li><a href="#examples-6">5.6.6. Examples</a></li>
<li><a href="#compatibility-6">5.6.7. Compatibility</a></li>
</ul>
</li>
<li><a href="#rollback-abort-the-current-transaction">5.7. ROLLBACK — abort the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-7">5.7.1. Synopsis</a></li>
<li><a href="#description-7">5.7.2. Description</a></li>
<li><a href="#parameters-7">5.7.3. Parameters</a></li>
<li><a href="#notes-7">5.7.4. Notes</a></li>
<li><a href="#examples-7">5.7.5. Examples</a></li>
<li><a href="#compatibility-7">5.7.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#rollback-prepared-cancel-a-transaction-that-was-earlier-prepared-for-two-phase-commit">5.8. ROLLBACK PREPARED — cancel a transaction that was earlier prepared for two-phase commit</a>
<ul class="sectlevel3">
<li><a href="#synopsis-8">5.8.1. Synopsis</a></li>
<li><a href="#description-8">5.8.2. Description</a></li>
<li><a href="#parameters-8">5.8.3. Parameters</a></li>
<li><a href="#notes-8">5.8.4. Notes</a></li>
<li><a href="#examples-8">5.8.5. Examples</a></li>
<li><a href="#compatibility-8">5.8.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#savepoint-define-a-new-savepoint-within-the-current-transaction">5.9. SAVEPOINT — define a new savepoint within the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-9">5.9.1. Synopsis</a></li>
<li><a href="#description-9">5.9.2. Description</a></li>
<li><a href="#parameters-9">5.9.3. Parameters</a></li>
<li><a href="#notes-9">5.9.4. Notes</a></li>
<li><a href="#examples-9">5.9.5. Examples</a></li>
<li><a href="#compatibility-9">5.9.6. Compatibility</a></li>
</ul>
</li>
<li><a href="#set-constraints-set-constraint-check-timing-for-the-current-transaction">5.10. SET CONSTRAINTS — set constraint check timing for the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-10">5.10.1. Synopsis</a></li>
<li><a href="#description-10">5.10.2. Description</a></li>
<li><a href="#notes-10">5.10.3. Notes</a></li>
<li><a href="#compatibility-10">5.10.4. Compatibility</a></li>
</ul>
</li>
<li><a href="#set-transaction-set-the-characteristics-of-the-current-transaction">5.11. SET TRANSACTION — set the characteristics of the current transaction</a>
<ul class="sectlevel3">
<li><a href="#synopsis-11">5.11.1. Synopsis</a></li>
<li><a href="#description-11">5.11.2. Description</a></li>
<li><a href="#notes-11">5.11.3. Notes</a></li>
<li><a href="#examples-10">5.11.4. Examples</a></li>
<li><a href="#compatibility-11">5.11.5. Compatibility</a></li>
</ul>
</li>
<li><a href="#start-transaction-start-a-transaction-block">5.12. START TRANSACTION — start a transaction block</a>
<ul class="sectlevel3">
<li><a href="#synopsis-12">5.12.1. Synopsis</a></li>
<li><a href="#description-12">5.12.2. Description</a></li>
<li><a href="#parameters-10">5.12.3. Parameters</a></li>
<li><a href="#compatibility-12">5.12.4. Compatibility</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sql-reference">6. Sql Reference</a>
<ul class="sectlevel2">
<li><a href="#lexical-structure">6.1. Lexical Structure</a>
<ul class="sectlevel3">
<li><a href="#identifiers-and-key-words">6.1.1. Identifiers and Key Words</a></li>
<li><a href="#constants">6.1.2. Constants</a>
<ul class="sectlevel4">
<li><a href="#string-constants">6.1.2.1. String Constants</a></li>
<li><a href="#string-constants-with-c-style-escapes">6.1.2.2. String Constants With C-Style Escapes</a></li>
<li><a href="#string-constants-with-unicode-escapes">6.1.2.3. String Constants With Unicode Escapes</a></li>
<li><a href="#dollar-quoted-string-constants">6.1.2.4. Dollar-Quoted String Constants</a></li>
<li><a href="#bit-string-constants">6.1.2.5. Bit-String Constants</a></li>
<li><a href="#numeric-constants">6.1.2.6. Numeric Constants</a></li>
<li><a href="#constants-of-other-types">6.1.2.7. Constants Of Other Types</a></li>
</ul>
</li>
<li><a href="#operators">6.1.3. Operators</a></li>
<li><a href="#special-characters">6.1.4. Special Characters</a></li>
<li><a href="#comments">6.1.5. Comments</a></li>
<li><a href="#operator-precedence">6.1.6. Operator Precedence</a></li>
</ul>
</li>
<li><a href="#value-expressions">6.2. Value Expressions</a>
<ul class="sectlevel3">
<li><a href="#column-references">6.2.1. Column References</a></li>
<li><a href="#positional-parameters">6.2.2. Positional Parameters</a></li>
<li><a href="#subscripts">6.2.3. Subscripts</a></li>
<li><a href="#field-selection">6.2.4. Field Selection</a></li>
<li><a href="#operator-invocations">6.2.5. Operator Invocations</a></li>
<li><a href="#function-calls">6.2.6. Function Calls</a></li>
<li><a href="#aggregate-expressions">6.2.7. Aggregate Expressions</a></li>
<li><a href="#window-function-calls">6.2.8. Window Function Calls</a></li>
<li><a href="#type-casts">6.2.9. Type Casts</a></li>
<li><a href="#collation-expressions">6.2.10. Collation Expressions</a></li>
<li><a href="#scalar-subqueries">6.2.11. Scalar Subqueries</a></li>
<li><a href="#array-constructors">6.2.12. Array Constructors</a></li>
<li><a href="#row-constructors">6.2.13. Row Constructors</a></li>
<li><a href="#expression-evaluation-rules">6.2.14. Expression Evaluation Rules</a></li>
</ul>
</li>
<li><a href="#calling-functions">6.3. Calling Functions</a>
<ul class="sectlevel3">
<li><a href="#using-positional-notation">6.3.1. Using Positional Notation</a></li>
<li><a href="#using-named-notation">6.3.2. Using Named Notation</a></li>
<li><a href="#using-mixed-notation">6.3.3. Using Mixed Notation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#oracle-compatible-features">7. Oracle Compatible Features</a>
<ul class="sectlevel2">
<li><a href="#configuration-parameters">7.1. Configuration parameters</a>
<ul class="sectlevel3">
<li><a href="#compatible_mode-enum">7.1.1. <code>compatible_mode (enum)</code></a></li>
</ul>
</li>
<li><a href="#packages">7.2. Packages</a>
<ul class="sectlevel3">
<li><a href="#requirements-for-packages">7.2.1. Requirements for packages</a></li>
<li><a href="#package-components">7.2.2. Package Components</a></li>
<li><a href="#package-syntax">7.2.3. Package Syntax</a>
<ul class="sectlevel4">
<li><a href="#package-specification-syntax">7.2.3.1. Package Specification Syntax</a></li>
<li><a href="#package-body-syntax">7.2.3.2. Package Body Syntax</a></li>
<li><a href="#description-13">7.2.3.3. <strong>Description</strong></a></li>
<li><a href="#parameters-11">7.2.3.4. <strong>parameters</strong></a></li>
</ul>
</li>
<li><a href="#creating-and-accessing-packages">7.2.4. Creating and Accessing Packages</a>
<ul class="sectlevel4">
<li><a href="#creating-packages">7.2.4.1. Creating Packages</a></li>
<li><a href="#accessing-package-elements">7.2.4.2. Accessing Package Elements</a></li>
</ul>
</li>
<li><a href="#understanding-the-scope-of-visibility">7.2.5. Understanding the Scope of Visibility</a></li>
<li><a href="#example-visibility-and-qualified-variable-names">7.2.6. <strong>Example: Visibility and Qualified Variable Names</strong></a></li>
<li><a href="#package-example">7.2.7. Package Example</a>
<ul class="sectlevel4">
<li><a href="#package-specifications">7.2.7.1. Package Specifications</a></li>
<li><a href="#package-body">7.2.7.2. Package body</a></li>
</ul>
</li>
<li><a href="#limitations">7.2.8. Limitations</a></li>
</ul>
</li>
<li><a href="#changing-tables">7.3. Changing tables</a>
<ul class="sectlevel3">
<li><a href="#syntax">7.3.1. syntax</a></li>
<li><a href="#parameters-12">7.3.2. <strong>parameters</strong></a></li>
<li><a href="#example">7.3.3. Example</a></li>
</ul>
</li>
<li><a href="#delete-table">7.4. Delete table</a>
<ul class="sectlevel3">
<li><a href="#syntax-2">7.4.1. Syntax</a></li>
<li><a href="#parameters-13">7.4.2. Parameters</a></li>
<li><a href="#uses">7.4.3. uses</a></li>
</ul>
</li>
<li><a href="#update-table">7.5. Update table</a>
<ul class="sectlevel3">
<li><a href="#syntax-3">7.5.1. Syntax</a></li>
<li><a href="#parameters-14">7.5.2. <strong>parameters</strong></a></li>
<li><a href="#example-2">7.5.3. Example</a></li>
</ul>
</li>
<li><a href="#group-by">7.6. GROUP BY</a>
<ul class="sectlevel3">
<li><a href="#example-3">7.6.1. Example</a></li>
</ul>
</li>
<li><a href="#union">7.7. UNION</a>
<ul class="sectlevel3">
<li><a href="#example-4">7.7.1. Example</a></li>
</ul>
</li>
<li><a href="#minus-operator">7.8. Minus Operator</a>
<ul class="sectlevel3">
<li><a href="#syntax-4">7.8.1. Syntax</a></li>
<li><a href="#parameters-15">7.8.2. Parameters</a></li>
<li><a href="#example-5">7.8.3. Example</a></li>
</ul>
</li>
<li><a href="#escape-characters">7.9. Escape characters</a>
<ul class="sectlevel3">
<li><a href="#overview-2">7.9.1. Overview</a></li>
<li><a href="#example-of">7.9.2. Example of</a></li>
</ul>
</li>
<li><a href="#sequence">7.10. Sequence</a>
<ul class="sectlevel3">
<li><a href="#syntax-5">7.10.1. Syntax</a></li>
<li><a href="#parameters-16">7.10.2. Parameters</a></li>
<li><a href="#example-6">7.10.3. Example</a></li>
</ul>
</li>
<li><a href="#compatible-with-time-and-date-functions">7.11. Compatible with time and date functions</a>
<ul class="sectlevel3">
<li><a href="#from_tz">7.11.1. from_tz</a>
<ul class="sectlevel4">
<li><a href="#purpose">7.11.1.1. Purpose</a></li>
<li><a href="#parameters-17">7.11.1.2. Parameters</a></li>
<li><a href="#example-7">7.11.1.3. Example</a></li>
</ul>
</li>
<li><a href="#numtodsinterval">7.11.2. numtodsinterval</a>
<ul class="sectlevel4">
<li><a href="#purpose-2">7.11.2.1. Purpose</a></li>
<li><a href="#parameters-description">7.11.2.2. Parameters Description</a></li>
<li><a href="#example-8">7.11.2.3. Example</a></li>
</ul>
</li>
<li><a href="#numtoyminterval">7.11.3. numtoyminterval</a>
<ul class="sectlevel4">
<li><a href="#purpose-3">7.11.3.1. Purpose</a></li>
<li><a href="#parametersdescription">7.11.3.2. ParametersDescription</a></li>
<li><a href="#example-9">7.11.3.3. Example</a></li>
</ul>
</li>
<li><a href="#systimestamp">7.11.4. systimestamp</a>
<ul class="sectlevel4">
<li><a href="#purpose-4">7.11.4.1. Purpose</a></li>
<li><a href="#example-10">7.11.4.2. Example</a></li>
</ul>
</li>
<li><a href="#sys_extract_utc">7.11.5. sys_extract_utc</a>
<ul class="sectlevel4">
<li><a href="#purpose-5">7.11.5.1. Purpose</a></li>
<li><a href="#parameters-description-2">7.11.5.2. Parameters Description</a></li>
<li><a href="#example-11">7.11.5.3. Example</a></li>
</ul>
</li>
<li><a href="#sessiontimezone">7.11.6. sessiontimezone</a>
<ul class="sectlevel4">
<li><a href="#purpose-6">7.11.6.1. Purpose</a></li>
<li><a href="#example-12">7.11.6.2. Example</a></li>
</ul>
</li>
<li><a href="#dbtimezone">7.11.7. dbtimezone</a>
<ul class="sectlevel4">
<li><a href="#purpose-7">7.11.7.1. Purpose</a></li>
<li><a href="#example-13">7.11.7.2. Example</a></li>
</ul>
</li>
<li><a href="#days_between">7.11.8. days_between</a>
<ul class="sectlevel4">
<li><a href="#purpose-8">7.11.8.1. Purpose</a></li>
<li><a href="#parametersdescription-2">7.11.8.2. ParametersDescription</a></li>
<li><a href="#example-14">7.11.8.3. Example</a></li>
</ul>
</li>
<li><a href="#days_between_tmtz">7.11.9. days_between_tmtz</a>
<ul class="sectlevel4">
<li><a href="#purpose-9">7.11.9.1. Purpose</a></li>
<li><a href="#parametersdescription-3">7.11.9.2. ParametersDescription</a></li>
<li><a href="#example-15">7.11.9.3. Example</a></li>
</ul>
</li>
<li><a href="#add_days_to_timestamp">7.11.10. add_days_to_timestamp</a>
<ul class="sectlevel4">
<li><a href="#purpose-10">7.11.10.1. Purpose</a></li>
<li><a href="#parametersdescription-4">7.11.10.2. ParametersDescription</a></li>
<li><a href="#example-16">7.11.10.3. Example</a></li>
</ul>
</li>
<li><a href="#subtract">7.11.11. subtract</a>
<ul class="sectlevel4">
<li><a href="#purpose-11">7.11.11.1. Purpose</a></li>
<li><a href="#parametersdescription-5">7.11.11.2. ParametersDescription</a></li>
<li><a href="#example-17">7.11.11.3. Example</a></li>
</ul>
</li>
<li><a href="#next_day">7.11.12. next_day</a>
<ul class="sectlevel4">
<li><a href="#purpose-12">7.11.12.1. Purpose</a></li>
<li><a href="#parametersdescription-6">7.11.12.2. ParametersDescription</a></li>
<li><a href="#example-18">7.11.12.3. Example</a></li>
</ul>
</li>
<li><a href="#last_day">7.11.13. last_day</a>
<ul class="sectlevel4">
<li><a href="#purpose-13">7.11.13.1. Purpose</a></li>
<li><a href="#parametersdescription-7">7.11.13.2. ParametersDescription</a></li>
<li><a href="#example-19">7.11.13.3. Example</a></li>
</ul>
</li>
<li><a href="#add_months">7.11.14. add_months</a>
<ul class="sectlevel4">
<li><a href="#purpose-14">7.11.14.1. Purpose</a></li>
<li><a href="#parametersdescription-8">7.11.14.2. ParametersDescription</a></li>
<li><a href="#example-20">7.11.14.3. Example</a></li>
</ul>
</li>
<li><a href="#months_between">7.11.15. months_between</a>
<ul class="sectlevel4">
<li><a href="#purpose-15">7.11.15.1. Purpose</a></li>
<li><a href="#parametersdescription-9">7.11.15.2. ParametersDescription</a></li>
<li><a href="#example-21">7.11.15.3. Example</a></li>
</ul>
</li>
<li><a href="#sysdate">7.11.16. sysdate</a>
<ul class="sectlevel4">
<li><a href="#purpose-16">7.11.16.1. Purpose</a></li>
<li><a href="#example-22">7.11.16.2. Example</a></li>
</ul>
</li>
<li><a href="#new_time">7.11.17. new_time</a>
<ul class="sectlevel4">
<li><a href="#purpose-17">7.11.17.1. Purpose</a></li>
<li><a href="#parametersdescription-10">7.11.17.2. ParametersDescription</a></li>
<li><a href="#example-23">7.11.17.3. Example</a></li>
</ul>
</li>
<li><a href="#trunc">7.11.18. trunc</a>
<ul class="sectlevel4">
<li><a href="#purpose-18">7.11.18.1. Purpose</a></li>
<li><a href="#parametersdescription-11">7.11.18.2. ParametersDescription</a></li>
<li><a href="#example-24">7.11.18.3. Example</a></li>
</ul>
</li>
<li><a href="#round">7.11.19. round</a>
<ul class="sectlevel4">
<li><a href="#purpose-19">7.11.19.1. Purpose</a></li>
<li><a href="#parametersdescription-12">7.11.19.2. ParametersDescription</a></li>
<li><a href="#example-25">7.11.19.3. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compatible-conversion-and-comparison-and-null-related-functions">7.12. Compatible conversion and comparison and NULL-related functions</a>
<ul class="sectlevel3">
<li><a href="#to_char">7.12.1. TO_CHAR</a>
<ul class="sectlevel4">
<li><a href="#purpose-20">7.12.1.1. Purpose</a></li>
<li><a href="#parameters-18">7.12.1.2. <strong>Parameters</strong></a></li>
<li><a href="#example-26">7.12.1.3. Example</a></li>
</ul>
</li>
<li><a href="#to_number">7.12.2. TO_NUMBER</a>
<ul class="sectlevel4">
<li><a href="#purpose-21">7.12.2.1. Purpose</a></li>
<li><a href="#parameters-19">7.12.2.2. <strong>Parameters</strong></a></li>
<li><a href="#example-27">7.12.2.3. Example</a></li>
</ul>
</li>
<li><a href="#hex_to_decimal">7.12.3. HEX_TO_DECIMAL</a>
<ul class="sectlevel4">
<li><a href="#purpose-22">7.12.3.1. Purpose</a></li>
<li><a href="#parameters-20">7.12.3.2. <strong>Parameters</strong></a></li>
<li><a href="#example-28">7.12.3.3. Example</a></li>
</ul>
</li>
<li><a href="#to_binary_double">7.12.4. TO_BINARY_DOUBLE</a>
<ul class="sectlevel4">
<li><a href="#purpose-23">7.12.4.1. Purpose</a></li>
<li><a href="#parameters-21">7.12.4.2. <strong>Parameters</strong></a></li>
<li><a href="#example-29">7.12.4.3. Example</a></li>
</ul>
</li>
<li><a href="#to_binray_float">7.12.5. TO_BINRAY_FLOAT</a>
<ul class="sectlevel4">
<li><a href="#purpose-24">7.12.5.1. Purpose</a></li>
<li><a href="#parameters-22">7.12.5.2. <strong>Parameters</strong></a></li>
<li><a href="#example-30">7.12.5.3. Example</a></li>
</ul>
</li>
<li><a href="#bin_to_num">7.12.6. BIN_TO_NUM</a>
<ul class="sectlevel4">
<li><a href="#purpose-25">7.12.6.1. Purpose</a></li>
<li><a href="#parameters-23">7.12.6.2. <strong>Parameters</strong></a></li>
<li><a href="#example-31">7.12.6.3. Example</a></li>
</ul>
</li>
<li><a href="#to_multi_byte">7.12.7. TO_MULTI_BYTE</a>
<ul class="sectlevel4">
<li><a href="#purpose-26">7.12.7.1. Purpose</a></li>
<li><a href="#parameters-24">7.12.7.2. <strong>Parameters</strong></a></li>
</ul>
</li>
<li><a href="#to_single_byte">7.12.8. TO_SINGLE_BYTE</a>
<ul class="sectlevel4">
<li><a href="#purpose-27">7.12.8.1. Purpose</a></li>
<li><a href="#parameters-25">7.12.8.2. <strong>Parameters</strong></a></li>
<li><a href="#example-32">7.12.8.3. Example</a></li>
</ul>
</li>
<li><a href="#to_date">7.12.9. TO_DATE</a>
<ul class="sectlevel4">
<li><a href="#purpose-28">7.12.9.1. Purpose</a></li>
<li><a href="#parameters-26">7.12.9.2. <strong>Parameters</strong></a></li>
<li><a href="#example-33">7.12.9.3. Example</a></li>
</ul>
</li>
<li><a href="#to_timestamp">7.12.10. TO_TIMESTAMP</a>
<ul class="sectlevel4">
<li><a href="#purpose-29">7.12.10.1. Purpose</a></li>
<li><a href="#parameters-27">7.12.10.2. <strong>Parameters</strong></a></li>
<li><a href="#example-34">7.12.10.3. Example</a></li>
</ul>
</li>
<li><a href="#interval_to_seconds">7.12.11. INTERVAL_TO_SECONDS</a>
<ul class="sectlevel4">
<li><a href="#purpose-30">7.12.11.1. Purpose</a></li>
<li><a href="#parameters-28">7.12.11.2. <strong>Parameters</strong></a></li>
<li><a href="#example-35">7.12.11.3. Example</a></li>
</ul>
</li>
<li><a href="#to_yminterval">7.12.12. TO_YMINTERVAL</a>
<ul class="sectlevel4">
<li><a href="#purpose-31">7.12.12.1. Purpose</a></li>
<li><a href="#parameters-29">7.12.12.2. <strong>Parameters</strong></a></li>
<li><a href="#example-36">7.12.12.3. Example</a></li>
</ul>
</li>
<li><a href="#to_dsinterval">7.12.13. TO_DSINTERVAL</a>
<ul class="sectlevel4">
<li><a href="#purpose-32">7.12.13.1. Purpose</a></li>
<li><a href="#parameters-30">7.12.13.2. <strong>Parameters</strong></a></li>
<li><a href="#example-37">7.12.13.3. Example</a></li>
</ul>
</li>
<li><a href="#to_timestamp_tz">7.12.14. TO_TIMESTAMP_TZ</a>
<ul class="sectlevel4">
<li><a href="#purpose-33">7.12.14.1. Purpose</a></li>
<li><a href="#parameters-31">7.12.14.2. <strong>Parameters</strong></a></li>
<li><a href="#example-38">7.12.14.3. Example</a></li>
</ul>
</li>
<li><a href="#greatest">7.12.15. GREATEST</a>
<ul class="sectlevel4">
<li><a href="#purpose-34">7.12.15.1. Purpose</a></li>
<li><a href="#parameters-32">7.12.15.2. <strong>Parameters</strong></a></li>
<li><a href="#example-39">7.12.15.3. Example</a></li>
</ul>
</li>
<li><a href="#least">7.12.16. LEAST</a>
<ul class="sectlevel4">
<li><a href="#purpose-35">7.12.16.1. Purpose</a></li>
<li><a href="#parameters-33">7.12.16.2. <strong>Parameters</strong></a></li>
<li><a href="#example-40">7.12.16.3. Example</a></li>
</ul>
</li>
<li><a href="#nanvl">7.12.17. NANVL</a>
<ul class="sectlevel4">
<li><a href="#purpose-36">7.12.17.1. Purpose</a></li>
<li><a href="#parameters-34">7.12.17.2. <strong>Parameters</strong></a></li>
<li><a href="#example-41">7.12.17.3. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nls_length_semanticsparameters">7.13. NLS_LENGTH_SEMANTICSParameters</a>
<ul class="sectlevel3">
<li><a href="#overview-3">7.13.1. Overview</a></li>
<li><a href="#syntax-6">7.13.2. Syntax</a>
<ul class="sectlevel4">
<li><a href="#note-on-the-range-of-values">7.13.2.1. <strong>Note on the range of values</strong></a></li>
</ul>
</li>
<li><a href="#example-42">7.13.3. Example</a>
<ul class="sectlevel4">
<li><a href="#test-char">7.13.3.1. --Test “CHAR”</a></li>
<li><a href="#test-byte">7.13.3.2. --Test “BYTE”</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nvarchar2size">7.14. NVARCHAR2(size)</a>
<ul class="sectlevel3">
<li><a href="#overview-4">7.14.1. Overview</a></li>
<li><a href="#syntax-7">7.14.2. Syntax</a></li>
<li><a href="#example-43">7.14.3. Example</a></li>
</ul>
</li>
<li><a href="#varchar2size">7.15. VARCHAR2(size)</a>
<ul class="sectlevel3">
<li><a href="#overview-5">7.15.1. Overview</a></li>
<li><a href="#syntax-8">7.15.2. Syntax</a></li>
<li><a href="#example-44">7.15.3. Example</a></li>
</ul>
</li>
<li><a href="#plisql">7.16. PL/iSQL</a>
<ul class="sectlevel3">
<li><a href="#structure-of-plisql-programs">7.16.1. Structure of PL/iSQL Programs</a></li>
<li><a href="#psql-support-for-plisql-programs">7.16.2. <strong>psql</strong> support for PL/iSQL programs</a></li>
<li><a href="#plisql-program-syntax">7.16.3. PL/iSQL Program Syntax</a>
<ul class="sectlevel4">
<li><a href="#procedures">7.16.3.1. PROCEDURES</a></li>
<li><a href="#functions">7.16.3.2. FUNCTIONS</a></li>
<li><a href="#packages-2">7.16.3.3. PACKAGES</a>
<ul class="sectlevel5">
<li><a href="#package-header">7.16.3.3.1. PACKAGE HEADER</a></li>
<li><a href="#package-body-2">7.16.3.3.2. PACKAGE BODY</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#hierarchy-search">7.17. Hierarchy Search</a>
<ul class="sectlevel3">
<li><a href="#syntax-9">7.17.1. Syntax</a></li>
<li><a href="#additional-column">7.17.2. <strong>ADDITIONAL COLUMN</strong></a></li>
<li><a href="#limitations-2">7.17.3. <strong>Limitations</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#global-unique-index">8. Global Unique Index</a>
<ul class="sectlevel2">
<li><a href="#create-global-unique-index">8.1. Create global unique index</a>
<ul class="sectlevel3">
<li><a href="#syntax-10">8.1.1. Syntax</a></li>
<li><a href="#example-45">8.1.2. Example</a></li>
<li><a href="#global-uniqueness-assurance">8.1.3. Global uniqueness assurance</a></li>
</ul>
</li>
<li><a href="#insertions-and-updates">8.2. Insertions and updates</a>
<ul class="sectlevel3">
<li><a href="#global-uniqueness-guarantee-for-insertions-and-updates">8.2.1. Global uniqueness guarantee for insertions and updates</a></li>
<li><a href="#example-46">8.2.2. Example</a></li>
</ul>
</li>
<li><a href="#append-and-detach">8.3. Append and detach</a>
<ul class="sectlevel3">
<li><a href="#global-uniqueness-guarantee-for-append-statements">8.3.1. Global uniqueness guarantee for append statements</a></li>
<li><a href="#example-47">8.3.2. Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>lvorySQL provides unique additional functionality on top of the open source PostgreSQL database.</p>
</div>
<div class="paragraph">
<p>IvorySQL is committed to delivering value to its end-users through innovation and building on top of open source based database solutions.</p>
</div>
<div class="paragraph">
<p>Our goal is to deliver a solution with high performance，scalability，reliability，and ease of use for small medium and large-scale enterprises.</p>
</div>
<div class="paragraph">
<p>The extended functionality provided by IvorySQL will enable users to build highly performant and scalable PostgreSQL database clusters with better database compatibility and administration.This simplifies the process of migration to PostgreSQLfrom other DBMS with enhanced database administration experiences.</p>
</div>
<div class="sect2">
<h3 id="architecture-overview"><a class="anchor" href="#architecture-overview"></a>1.1. Architecture Overview</h3>
<div class="paragraph">
<p>The IvorySQL follows the same general architecture of PostgreSQL with some additions,but it does not deviate from its core philosophy.Thediagram below depicts essentially how IvorySQL operates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p4.png" alt="p4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p5.png" alt="p5">
</div>
</div>
<div class="paragraph">
<p>The yellow color in the diagram shows the new modules added by IvorySQL on top of existing PostgreSQL while IvorySQL has also made changes to existing modules and logical structures as well.</p>
</div>
<div class="paragraph">
<p>The most noteworthy of those modules that received updates for supporting oracle compatibility are backend parser and system catalogs.</p>
</div>
</div>
<div class="sect2">
<h3 id="catalog-changes"><a class="anchor" href="#catalog-changes"></a>1.2. Catalog changes</h3>
<div class="paragraph">
<p>The following diagram depicts the changes made to PostgreSQL&#8217;s existing directories and the additions that have been made.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/p6.png" alt="p6">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database-modeling"><a class="anchor" href="#database-modeling"></a>2. Database Modeling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="creating-a-database"><a class="anchor" href="#creating-a-database"></a>2.1. Creating a Database</h3>
<div class="paragraph">
<p>The first test to see whether you can access the database server is to try to create a database. A running IvorySQL server can manage many databases. Typically, a separate database is used for each project or for each user.</p>
</div>
<div class="paragraph">
<p>Possibly, your site administrator has already created a database for your use. In that case you can omit this step and skip ahead to the next section.</p>
</div>
<div class="paragraph">
<p>To create a new database, in this example named <code>mydb</code>, you use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$ createdb mydb</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this produces no response then this step was successful and you can skip over the remainder of this section.</p>
</div>
<div class="paragraph">
<p>If you see a message similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">createdb: command not found</code></pre>
</div>
</div>
<div class="paragraph">
<p>then IvorySQL was not installed properly. Either it was not installed at all or your shell&#8217;s search path was not set to include it. Try calling the command with an absolute path instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$ /usr/local/pgsql/bin/createdb mydb</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path at your site might be different. Contact your site administrator or check the installation instructions to correct the situation.</p>
</div>
<div class="paragraph">
<p>Another response could be this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">createdb: error: connection to server on socket "/tmp/.s.PGSQL.5432" failed: No such file or directory
        Is the server running locally and accepting connections on that socket?</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that the server was not started, or it is not listening where <code>createdb</code> expects to contact it. Again, check the installation instructions or consult the administrator.</p>
</div>
<div class="paragraph">
<p>Another response could be this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">createdb: error: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  role "joe" does not exist</code></pre>
</div>
</div>
<div class="paragraph">
<p>where your own login name is mentioned. This will happen if the administrator has not created a IvorySQL user account for you. (IvorySQL user accounts are distinct from operating system user accounts.) If you are the administrator,  You will need to become the operating system user under which IvorySQL was installed (usually <code>postgres</code>) to create the first user account. It could also be that you were assigned a IvorySQL user name that is different from your operating system user name; in that case you need to use the <code>-U</code> switch or set the <code>PGUSER</code> environment variable to specify your IvorySQL user name.</p>
</div>
<div class="paragraph">
<p>If you have a user account but it does not have the privileges required to create a database, you will see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">createdb: error: database creation failed: ERROR:  permission denied to create database</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not every user has authorization to create new databases. If IvorySQL refuses to create databases for you then the site administrator needs to grant you permission to create databases. Consult your site administrator if this occurs. If you installed IvorySQL yourself then you should log in for the purposes of this tutorial under the user account that you started the server as. <a href="https://www.postgresql.org/docs/current/tutorial-createdb.html#ftn.id-1.4.3.4.10.4">[1]</a></p>
</div>
<div class="paragraph">
<p>You can also create databases with other names. IvorySQL allows you to create any number of databases at a given site. Database names must have an alphabetic first character and are limited to 63 bytes in length. A convenient choice is to create a database with the same name as your current user name. Many tools assume that database name as the default, so it can save you some typing. To create that database, simply type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$ createdb</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not want to use your database anymore you can remove it. For example, if you are the owner (creator) of the database <code>mydb</code>, you can destroy it using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$ dropdb mydb</code></pre>
</div>
</div>
<div class="paragraph">
<p>(For this command, the database name does not default to the user account name. You always need to specify it.) This action physically removes all files associated with the database and cannot be undone, so this should only be done with a great deal of forethought.</p>
</div>
<div class="paragraph">
<p>More about <code>createdb</code> and <code>dropdb</code> can be found in <a href="https://www.postgresql.org/docs/current/app-createdb.html">createdb</a> and <a href="https://www.postgresql.org/docs/current/app-dropdb.html">dropdb</a> respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-new-table"><a class="anchor" href="#creating-a-new-table"></a>2.2. Creating a New Table</h3>
<div class="paragraph">
<p>You can create a new table by specifying the table name, along with all column names and their types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE TABLE weather (
    city            varchar(80),
    temp_lo         int,           -- low temperature
    temp_hi         int,           -- high temperature
    prcp            real,          -- precipitation
    date            date
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can enter this into <code>psql</code> with the line breaks. <code>psql</code> will recognize that the command is not terminated until the semicolon.</p>
</div>
<div class="paragraph">
<p>White space (i.e., spaces, tabs, and newlines) can be used freely in SQL commands. That means you can type the command aligned differently than above, or even all on one line. Two dashes (“<code>--</code>”) introduce comments. Whatever follows them is ignored up to the end of the line. SQL is case insensitive about key words and identifiers, except when identifiers are double-quoted to preserve the case (not done above).</p>
</div>
<div class="paragraph">
<p><code>varchar(80)</code> specifies a data type that can store arbitrary character strings up to 80 characters in length. <code>int</code> is the normal integer type. <code>real</code> is a type for storing single precision floating-point numbers. <code>date</code> should be self-explanatory. (Yes, the column of type <code>date</code> is also named <code>date</code>. This might be convenient or confusing — you choose.)</p>
</div>
<div class="paragraph">
<p>IvorySQL supports the standard SQL types <code>int</code>, <code>smallint</code>, <code>real</code>, <code>double precision</code>, <code>char(<strong>`N</code></strong>)<code>, `varchar(<strong>`N</code></strong>)<code>, `date</code>, <code>time</code>, <code>timestamp</code>, and <code>interval</code>, as well as other types of general utility and a rich set of geometric types. IvorySQL can be customized with an arbitrary number of user-defined data types. Consequently, type names are not key words in the syntax, except where required to support special cases in the SQL standard.</p>
</div>
<div class="paragraph">
<p>The second example will store cities and their associated geographical location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE TABLE cities (
    name            varchar(80),
    location        point
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>point</code> type is an example of a IvorySQL-specific data type.</p>
</div>
<div class="paragraph">
<p>Finally, it should be mentioned that if you don&#8217;t need a table any longer or want to recreate it differently you can remove it using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">DROP TABLE tablename;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="write-to-data"><a class="anchor" href="#write-to-data"></a>3. Write to data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a table is created, it contains no data. The first thing to do before a database can be of much use is to insert data. Data is inserted one row at a time. You can also insert more than one row in a single command, but it is not possible to insert something that is not a complete row. Even if you know only some column values, a complete row must be created.</p>
</div>
<div class="paragraph">
<p>To create a new row, use the <a href="https://www.postgresql.org/docs/current/sql-insert.html">INSERT</a> command. The command requires the table name and column values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE TABLE products (
    product_no integer,
    name text,
    price numeric
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example command to insert a row would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products VALUES (1, 'Cheese', 9.99);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data values are listed in the order in which the columns appear in the table, separated by commas. Usually, the data values will be literals (constants), but scalar expressions are also allowed.</p>
</div>
<div class="paragraph">
<p>The above syntax has the drawback that you need to know the order of the columns in the table. To avoid this you can also list the columns explicitly. For example, both of the following commands have the same effect as the one above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products (product_no, name, price) VALUES (1, 'Cheese', 9.99);
INSERT INTO products (name, price, product_no) VALUES ('Cheese', 9.99, 1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many users consider it good practice to always list the column names.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have values for all the columns, you can omit some of them. In that case, the columns will be filled with their default values. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products (product_no, name) VALUES (1, 'Cheese');
INSERT INTO products VALUES (1, 'Cheese');</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second form is a IvorySQL extension. It fills the columns from the left with as many values as are given, and the rest will be defaulted.</p>
</div>
<div class="paragraph">
<p>For clarity, you can also request default values explicitly, for individual columns or for the entire row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products (product_no, name, price) VALUES (1, 'Cheese', DEFAULT);
INSERT INTO products DEFAULT VALUES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can insert multiple rows in a single command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products (product_no, name, price) VALUES
    (1, 'Cheese', 9.99),
    (2, 'Bread', 1.99),
    (3, 'Milk', 2.99);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to insert the result of a query (which might be no rows, one row, or many rows):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INSERT INTO products (product_no, name, price)
  SELECT product_no, name, price FROM new_products
    WHERE release_date = 'today';</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides the full power of the SQL query mechanism for computing the rows to be inserted.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Tip</div>
<div class="paragraph">
<p>When inserting a lot of data at the same time, consider using the <a href="https://www.postgresql.org/docs/current/sql-copy.html">COPY</a> command. It is not as flexible as the <a href="https://www.postgresql.org/docs/current/sql-insert.html">INSERT</a> command, but is more efficient.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-data"><a class="anchor" href="#query-data"></a>4. Query Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="combining-queries-union-intersect-except"><a class="anchor" href="#combining-queries-union-intersect-except"></a>4.1. Combining Queries (<code>UNION</code>, <code>INTERSECT</code>, <code>EXCEPT</code>)</h3>
<div class="paragraph">
<p>The results of two queries can be combined using the set operations union, intersection, and difference. The syntax is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">query1 UNION [ALL] query2
query1 INTERSECT [ALL] query2
query1 EXCEPT [ALL] query2</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>query1</code></strong> and <strong><code>query2</code></strong> are queries that can use any of the features discussed up to this point.</p>
</div>
<div class="paragraph">
<p><code>UNION</code> effectively appends the result of <strong><code>query2</code></strong> to the result of <strong><code>query1</code></strong> (although there is no guarantee that this is the order in which the rows are actually returned). Furthermore, it eliminates duplicate rows from its result, in the same way as <code>DISTINCT</code>, unless <code>UNION ALL</code> is used.</p>
</div>
<div class="paragraph">
<p><code>INTERSECT</code> returns all rows that are both in the result of <strong><code>query1</code></strong> and in the result of <strong><code>query2</code></strong>. Duplicate rows are eliminated unless <code>INTERSECT ALL</code> is used.</p>
</div>
<div class="paragraph">
<p><code>EXCEPT</code> returns all rows that are in the result of <strong><code>query1</code></strong> but not in the result of <strong><code>query2</code></strong>. (This is sometimes called the <strong>difference</strong> between two queries.) Again, duplicates are eliminated unless <code>EXCEPT ALL</code> is used.</p>
</div>
<div class="paragraph">
<p>In order to calculate the union, intersection, or difference of two queries, the two queries must be “union compatible”, which means that they return the same number of columns and the corresponding columns have compatible data types.</p>
</div>
<div class="paragraph">
<p>Set operations can be combined, for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">query1 UNION query2 EXCEPT query3</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">(query1 UNION query2) EXCEPT query3</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown here, you can use parentheses to control the order of evaluation. Without parentheses, <code>UNION</code> and <code>EXCEPT</code> associate left-to-right, but <code>INTERSECT</code> binds more tightly than those two operators. Thus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">query1 UNION query2 INTERSECT query3</code></pre>
</div>
</div>
<div class="paragraph">
<p>means</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">query1 UNION (query2 INTERSECT query3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also surround an individual <strong><code>query</code></strong> with parentheses. This is important if the <strong><code>query</code></strong> needs to use any of the clauses discussed in following sections, such as <code>LIMIT</code>. Without parentheses, you&#8217;ll get a syntax error, or else the clause will be understood as applying to the output of the set operation rather than one of its inputs. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT a FROM b UNION SELECT x FROM y LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>is accepted, but it means</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">(SELECT a FROM b UNION SELECT x FROM y) LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>not</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT a FROM b UNION (SELECT x FROM y LIMIT 10)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="parallel-query"><a class="anchor" href="#parallel-query"></a>4.2. Parallel Query</h3>
<div class="sect3">
<h4 id="how-parallel-query-works"><a class="anchor" href="#how-parallel-query-works"></a>4.2.1. How Parallel Query Works</h4>
<div class="paragraph">
<p>When the optimizer determines that parallel query is the fastest execution strategy for a particular query, it will create a query plan that includes a <strong>Gather</strong> or <strong>Gather Merge</strong> node. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">EXPLAIN SELECT * FROM pgbench_accounts WHERE filler LIKE '%x%';
                                     QUERY PLAN
-------------------------------------------------------------------------------------
 Gather  (cost=1000.00..217018.43 rows=1 width=97)
   Workers Planned: 2
   -&gt;  Parallel Seq Scan on pgbench_accounts  (cost=0.00..216018.33 rows=1 width=97)
         Filter: (filler ~~ '%x%'::text)
(4 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In all cases, the <code>Gather</code> or <code>Gather Merge</code> node will have exactly one child plan, which is the portion of the plan that will be executed in parallel. If the <code>Gather</code> or <code>Gather Merge</code> node is at the very top of the plan tree, then the entire query will execute in parallel. If it is somewhere else in the plan tree, then only the portion of the plan below it will run in parallel. In the example above, the query accesses only one table, so there is only one plan node other than the <code>Gather</code> node itself; since that plan node is a child of the <code>Gather</code> node, it will run in parallel.</p>
</div>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/using-explain.html">Using EXPLAIN</a>, you can see the number of workers chosen by the planner. When the <code>Gather</code> node is reached during query execution, the process that is implementing the user&#8217;s session will request a number of <a href="https://www.postgresql.org/docs/current/bgworker.html">background worker processes</a> equal to the number of workers chosen by the planner. The number of background workers that the planner will consider using is limited to at most <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER">max_parallel_workers_per_gather</a>. The total number of background workers that can exist at any one time is limited by both <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-WORKER-PROCESSES">max_worker_processes</a> and <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS">max_parallel_workers</a>. Therefore, it is possible for a parallel query to run with fewer workers than planned, or even with no workers at all. The optimal plan may depend on the number of workers that are available, so this can result in poor query performance. If this occurrence is frequent, consider increasing <code>max_worker_processes</code> and <code>max_parallel_workers</code> so that more workers can be run simultaneously or alternatively reducing <code>max_parallel_workers_per_gather</code> so that the planner requests fewer workers.</p>
</div>
<div class="paragraph">
<p>Every background worker process that is successfully started for a given parallel query will execute the parallel portion of the plan. The leader will also execute that portion of the plan, but it has an additional responsibility: it must also read all of the tuples generated by the workers. When the parallel portion of the plan generates only a small number of tuples, the leader will often behave very much like an additional worker, speeding up query execution. Conversely, when the parallel portion of the plan generates a large number of tuples, the leader may be almost entirely occupied with reading the tuples generated by the workers and performing any further processing steps that are required by plan nodes above the level of the <code>Gather</code> node or <code>Gather Merge</code> node. In such cases, the leader will do very little of the work of executing the parallel portion of the plan.</p>
</div>
<div class="paragraph">
<p>When the node at the top of the parallel portion of the plan is <code>Gather Merge</code> rather than <code>Gather</code>, it indicates that each process executing the parallel portion of the plan is producing tuples in sorted order, and that the leader is performing an order-preserving merge. In contrast, <code>Gather</code> reads tuples from the workers in whatever order is convenient, destroying any sort order that may have existed.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-can-parallel-query-be-used"><a class="anchor" href="#when-can-parallel-query-be-used"></a>4.2.2. When Can Parallel Query Be Used?</h4>
<div class="paragraph">
<p>There are several settings that can cause the query planner not to generate a parallel query plan under any circumstances. In order for any parallel query plans whatsoever to be generated, the following settings must be configured as indicated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER">max_parallel_workers_per_gather</a> must be set to a value that is greater than zero. This is a special case of the more general principle that no more workers should be used than the number configured via <code>max_parallel_workers_per_gather</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the system must not be running in single-user mode. Since the entire database system is running as a single process in this situation, no background workers will be available.</p>
</div>
<div class="paragraph">
<p>Even when it is in general possible for parallel query plans to be generated, the planner will not generate them for a given query if any of the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The query writes any data or locks any database rows. If a query contains a data-modifying operation either at the top level or within a CTE, no parallel plans for that query will be generated. As an exception, the following commands, which create a new table and populate it, can use a parallel plan for the underlying <code>SELECT</code> part of the query:</p>
</li>
<li>
<p><code>CREATE TABLE &#8230;&#8203; AS</code></p>
</li>
<li>
<p><code>SELECT INTO</code></p>
</li>
<li>
<p><code>CREATE MATERIALIZED VIEW</code></p>
</li>
<li>
<p><code>REFRESH MATERIALIZED VIEW</code></p>
</li>
<li>
<p>The query might be suspended during execution. In any situation in which the system thinks that partial or incremental execution might occur, no parallel plan is generated. For example, a cursor created using <a href="https://www.postgresql.org/docs/current/sql-declare.html">DECLARE CURSOR</a> will never use a parallel plan. Similarly, a PL/pgSQL loop of the form <code>FOR x IN query LOOP .. END LOOP</code> will never use a parallel plan, because the parallel query system is unable to verify that the code in the loop is safe to execute while parallel query is active.</p>
</li>
<li>
<p>The query uses any function marked <code>PARALLEL UNSAFE</code>. Most system-defined functions are <code>PARALLEL SAFE</code>, but user-defined functions are marked <code>PARALLEL UNSAFE</code> by default.</p>
</li>
<li>
<p>The query is running inside of another query that is already parallel. For example, if a function called by a parallel query issues an SQL query itself, that query will never use a parallel plan. This is a limitation of the current implementation, but it may not be desirable to remove this limitation, since it could result in a single query using a very large number of processes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even when parallel query plan is generated for a particular query, there are several circumstances under which it will be impossible to execute that plan in parallel at execution time. If this occurs, the leader will execute the portion of the plan below the <code>Gather</code> node entirely by itself, almost as if the <code>Gather</code> node were not present. This will happen if any of the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No background workers can be obtained because of the limitation that the total number of background workers cannot exceed <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-WORKER-PROCESSES">max_worker_processes</a>.</p>
</li>
<li>
<p>No background workers can be obtained because of the limitation that the total number of background workers launched for purposes of parallel query cannot exceed <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS">max_parallel_workers</a>.</p>
</li>
<li>
<p>The client sends an Execute message with a non-zero fetch count. See the discussion of the <a href="https://www.postgresql.org/docs/current/protocol-flow.html#PROTOCOL-FLOW-EXT-QUERY">extended query protocol</a>. Since <a href="https://www.postgresql.org/docs/current/libpq.html">libpq</a> currently provides no way to send such a message, this can only occur when using a client that does not rely on libpq. If this is a frequent occurrence, it may be a good idea to set <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER">max_parallel_workers_per_gather</a> to zero in sessions where it is likely, so as to avoid generating query plans that may be suboptimal when run serially.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parallel-plans"><a class="anchor" href="#parallel-plans"></a>4.2.3. Parallel Plans</h4>
<div class="paragraph">
<p>Because each worker executes the parallel portion of the plan to completion, it is not possible to simply take an ordinary query plan and run it using multiple workers. Each worker would produce a full copy of the output result set, so the query would not run any faster than normal but would produce incorrect results. Instead, the parallel portion of the plan must be what is known internally to the query optimizer as a <strong>partial plan</strong>; that is, it must be constructed so that each process that executes the plan will generate only a subset of the output rows in such a way that each required output row is guaranteed to be generated by exactly one of the cooperating processes. Generally, this means that the scan on the driving table of the query must be a parallel-aware scan.</p>
</div>
<div class="sect4">
<h5 id="parallel-scans"><a class="anchor" href="#parallel-scans"></a>4.2.3.1. Parallel Scans</h5>
<div class="paragraph">
<p>The following types of parallel-aware table scans are currently supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a <strong>parallel sequential scan</strong>, the table&#8217;s blocks will be divided into ranges and shared among the cooperating processes. Each worker process will complete the scanning of its given range of blocks before requesting an additional range of blocks.</p>
</li>
<li>
<p>In a <strong>parallel bitmap heap scan</strong>, one process is chosen as the leader. That process performs a scan of one or more indexes and builds a bitmap indicating which table blocks need to be visited. These blocks are then divided among the cooperating processes as in a parallel sequential scan. In other words, the heap scan is performed in parallel, but the underlying index scan is not.</p>
</li>
<li>
<p>In a <strong>parallel index scan</strong> or <strong>parallel index-only scan</strong>, the cooperating processes take turns reading data from the index. Currently, parallel index scans are supported only for btree indexes. Each process will claim a single index block and will scan and return all tuples referenced by that block; other processes can at the same time be returning tuples from a different index block. The results of a parallel btree scan are returned in sorted order within each worker process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other scan types, such as scans of non-btree indexes, may support parallel scans in the future.</p>
</div>
</div>
<div class="sect4">
<h5 id="parallel-joins"><a class="anchor" href="#parallel-joins"></a>4.2.3.2. Parallel Joins</h5>
<div class="paragraph">
<p>Just as in a non-parallel plan, the driving table may be joined to one or more other tables using a nested loop, hash join, or merge join. The inner side of the join may be any kind of non-parallel plan that is otherwise supported by the planner provided that it is safe to run within a parallel worker. Depending on the join type, the inner side may also be a parallel plan.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a <strong>nested loop join</strong>, the inner side is always non-parallel. Although it is executed in full, this is efficient if the inner side is an index scan, because the outer tuples and thus the loops that look up values in the index are divided over the cooperating processes.</p>
</li>
<li>
<p>In a <strong>merge join</strong>, the inner side is always a non-parallel plan and therefore executed in full. This may be inefficient, especially if a sort must be performed, because the work and resulting data are duplicated in every cooperating process.</p>
</li>
<li>
<p>In a <strong>hash join</strong> (without the "parallel" prefix), the inner side is executed in full by every cooperating process to build identical copies of the hash table. This may be inefficient if the hash table is large or the plan is expensive. In a <strong>parallel hash join</strong>, the inner side is a <strong>parallel hash</strong> that divides the work of building a shared hash table over the cooperating processes.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="parallel-aggregation"><a class="anchor" href="#parallel-aggregation"></a>4.2.3.3. Parallel Aggregation</h5>
<div class="paragraph">
<p>IvorySQL supports parallel aggregation by aggregating in two stages. First, each process participating in the parallel portion of the query performs an aggregation step, producing a partial result for each group of which that process is aware. This is reflected in the plan as a <code>Partial Aggregate</code> node. Second, the partial results are transferred to the leader via <code>Gather</code> or <code>Gather Merge</code>. Finally, the leader re-aggregates the results across all workers in order to produce the final result. This is reflected in the plan as a <code>Finalize Aggregate</code> node.</p>
</div>
<div class="paragraph">
<p>Because the <code>Finalize Aggregate</code> node runs on the leader process, queries that produce a relatively large number of groups in comparison to the number of input rows will appear less favorable to the query planner. For example, in the worst-case scenario the number of groups seen by the <code>Finalize Aggregate</code> node could be as many as the number of input rows that were seen by all worker processes in the <code>Partial Aggregate</code> stage. For such cases, there is clearly going to be no performance benefit to using parallel aggregation. The query planner takes this into account during the planning process and is unlikely to choose parallel aggregate in this scenario.</p>
</div>
<div class="paragraph">
<p>Parallel aggregation is not supported in all situations. Each aggregate must be <a href="https://www.postgresql.org/docs/current/parallel-safety.html">safe</a> for parallelism and must have a combine function. If the aggregate has a transition state of type <code>internal</code>, it must have serialization and deserialization functions. See <a href="https://www.postgresql.org/docs/current/sql-createaggregate.html">CREATE AGGREGATE</a> for more details. Parallel aggregation is not supported if any aggregate function call contains <code>DISTINCT</code> or <code>ORDER BY</code> clause and is also not supported for ordered set aggregates or when the query involves <code>GROUPING SETS</code>. It can only be used when all joins involved in the query are also part of the parallel portion of the plan.</p>
</div>
</div>
<div class="sect4">
<h5 id="parallel-append"><a class="anchor" href="#parallel-append"></a>4.2.3.4. Parallel Append</h5>
<div class="paragraph">
<p>Whenever IvorySQL needs to combine rows from multiple sources into a single result set, it uses an <code>Append</code> or <code>MergeAppend</code> plan node. This commonly happens when implementing <code>UNION ALL</code> or when scanning a partitioned table. Such nodes can be used in parallel plans just as they can in any other plan. However, in a parallel plan, the planner may instead use a <code>Parallel Append</code> node.</p>
</div>
<div class="paragraph">
<p>When an <code>Append</code> node is used in a parallel plan, each process will execute the child plans in the order in which they appear, so that all participating processes cooperate to execute the first child plan until it is complete and then move to the second plan at around the same time. When a <code>Parallel Append</code> is used instead, the executor will instead spread out the participating processes as evenly as possible across its child plans, so that multiple child plans are executed simultaneously. This avoids contention, and also avoids paying the startup cost of a child plan in those processes that never execute it.</p>
</div>
<div class="paragraph">
<p>Also, unlike a regular <code>Append</code> node, which can only have partial children when used within a parallel plan, a <code>Parallel Append</code> node can have both partial and non-partial child plans. Non-partial children will be scanned by only a single process, since scanning them more than once would produce duplicate results. Plans that involve appending multiple results sets can therefore achieve coarse-grained parallelism even when efficient partial plans are not available. For example, consider a query against a partitioned table that can only be implemented efficiently by using an index that does not support parallel scans. The planner might choose a <code>Parallel Append</code> of regular <code>Index Scan</code> plans; each individual index scan would have to be executed to completion by a single process, but different scans could be performed at the same time by different processes.</p>
</div>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/runtime-config-query.html#GUC-ENABLE-PARALLEL-APPEND">enable_parallel_append</a> can be used to disable this feature.</p>
</div>
</div>
<div class="sect4">
<h5 id="parallel-plan-tips"><a class="anchor" href="#parallel-plan-tips"></a>4.2.3.5. Parallel Plan Tips</h5>
<div class="paragraph">
<p>If a query that is expected to do so does not produce a parallel plan, you can try reducing <a href="https://www.postgresql.org/docs/current/runtime-config-query.html#GUC-PARALLEL-SETUP-COST">parallel_setup_cost</a> or <a href="https://www.postgresql.org/docs/current/runtime-config-query.html#GUC-PARALLEL-TUPLE-COST">parallel_tuple_cost</a>. Of course, this plan may turn out to be slower than the serial plan that the planner preferred, but this will not always be the case. If you don&#8217;t get a parallel plan even with very small values of these settings (e.g., after setting them both to zero), there may be some reason why the query planner is unable to generate a parallel plan for your query.</p>
</div>
<div class="paragraph">
<p>When executing a parallel plan, you can use <code>EXPLAIN (ANALYZE, VERBOSE)</code> to display per-worker statistics for each plan node. This may be useful in determining whether the work is being evenly distributed between all plan nodes and more generally in understanding the performance characteristics of the plan.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transaction"><a class="anchor" href="#transaction"></a>5. Transaction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="abort-abort-the-current-transaction"><a class="anchor" href="#abort-abort-the-current-transaction"></a>5.1. ABORT — abort the current transaction</h3>
<div class="sect3">
<h4 id="synopsis"><a class="anchor" href="#synopsis"></a>5.1.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ABORT [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description"><a class="anchor" href="#description"></a>5.1.2. Description</h4>
<div class="paragraph">
<p><code>ABORT</code> rolls back the current transaction and causes all the updates made by the transaction to be discarded. This command is identical in behavior to the standard SQL command <a href="https://www.postgresql.org/docs/current/sql-rollback.html"><code>ROLLBACK</code></a>, and is present only for historical reasons.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters"><a class="anchor" href="#parameters"></a>5.1.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>WORK</code> <code>TRANSACTION</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional key words. They have no effect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AND CHAIN</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>AND CHAIN</code> is specified, a new transaction is immediately started with the same transaction characteristics (see <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html"><code>SET TRANSACTION</code></a>) as the just finished one. Otherwise, no new transaction is started.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes"><a class="anchor" href="#notes"></a>5.1.4. Notes</h4>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a> to successfully terminate a transaction.</p>
</div>
<div class="paragraph">
<p>Issuing <code>ABORT</code> outside of a transaction block emits a warning and otherwise has no effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples"><a class="anchor" href="#examples"></a>5.1.5. Examples</h4>
<div class="paragraph">
<p>To abort all changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ABORT;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility"><a class="anchor" href="#compatibility"></a>5.1.6. Compatibility</h4>
<div class="paragraph">
<p>This command is a IvorySQL extension present for historical reasons. <code>ROLLBACK</code> is the equivalent standard SQL command.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="begin-start-a-transaction-block"><a class="anchor" href="#begin-start-a-transaction-block"></a>5.2. BEGIN — start a transaction block</h3>
<div class="sect3">
<h4 id="synopsis-2"><a class="anchor" href="#synopsis-2"></a>5.2.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN [ WORK | TRANSACTION ] [ transaction_mode [, ...] ]

where transaction_mode is one of:

    ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED }
    READ WRITE | READ ONLY
    [ NOT ] DEFERRABLE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-2"><a class="anchor" href="#description-2"></a>5.2.2. Description</h4>
<div class="paragraph">
<p><code>BEGIN</code> initiates a transaction block, that is, all statements after a <code>BEGIN</code> command will be executed in a single transaction until an explicit <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a> or <a href="https://www.postgresql.org/docs/current/sql-rollback.html"><code>ROLLBACK</code></a> is given. By default (without <code>BEGIN</code>), IvorySQL executes transactions in “autocommit” mode, that is, each statement is executed in its own transaction and a commit is implicitly performed at the end of the statement (if execution was successful, otherwise a rollback is done).</p>
</div>
<div class="paragraph">
<p>Statements are executed more quickly in a transaction block, because transaction start/commit requires significant CPU and disk activity. Execution of multiple statements inside a transaction is also useful to ensure consistency when making several related changes: other sessions will be unable to see the intermediate states wherein not all the related updates have been done.</p>
</div>
<div class="paragraph">
<p>If the isolation level, read/write mode, or deferrable mode is specified, the new transaction has those characteristics, as if <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html"><code>SET TRANSACTION</code></a> was executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-2"><a class="anchor" href="#parameters-2"></a>5.2.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>WORK</code> <code>TRANSACTION</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional key words. They have no effect.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a> for information on the meaning of the other parameters to this statement.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-2"><a class="anchor" href="#notes-2"></a>5.2.4. Notes</h4>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/sql-start-transaction.html"><code>START TRANSACTION</code></a> has the same functionality as <code>BEGIN</code>.</p>
</div>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a> or <a href="https://www.postgresql.org/docs/current/sql-rollback.html"><code>ROLLBACK</code></a> to terminate a transaction block.</p>
</div>
<div class="paragraph">
<p>Issuing <code>BEGIN</code> when already inside a transaction block will provoke a warning message. The state of the transaction is not affected. To nest transactions within a transaction block, use savepoints (see <a href="https://www.postgresql.org/docs/current/sql-savepoint.html">SAVEPOINT</a>).</p>
</div>
<div class="paragraph">
<p>For reasons of backwards compatibility, the commas between successive <strong><code>transaction_modes</code></strong> can be omitted.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-2"><a class="anchor" href="#examples-2"></a>5.2.5. Examples</h4>
<div class="paragraph">
<p>To begin a transaction block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-2"><a class="anchor" href="#compatibility-2"></a>5.2.6. Compatibility</h4>
<div class="paragraph">
<p><code>BEGIN</code> is a IvorySQL language extension. It is equivalent to the SQL-standard command <a href="https://www.postgresql.org/docs/current/sql-start-transaction.html"><code>START TRANSACTION</code></a>, whose reference page contains additional compatibility information.</p>
</div>
<div class="paragraph">
<p>The <code>DEFERRABLE</code> <strong><code>transaction_mode</code></strong> is a IvorySQL language extension.</p>
</div>
<div class="paragraph">
<p>Incidentally, the <code>BEGIN</code> key word is used for a different purpose in embedded SQL. You are advised to be careful about the transaction semantics when porting database applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="commit-commit-the-current-transaction"><a class="anchor" href="#commit-commit-the-current-transaction"></a>5.3. COMMIT — commit the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-3"><a class="anchor" href="#synopsis-3"></a>5.3.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">COMMIT [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-3"><a class="anchor" href="#description-3"></a>5.3.2. Description</h4>
<div class="paragraph">
<p><code>COMMIT</code> commits the current transaction. All changes made by the transaction become visible to others and are guaranteed to be durable if a crash occurs.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-3"><a class="anchor" href="#parameters-3"></a>5.3.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>WORK</code> <code>TRANSACTION</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional key words. They have no effect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AND CHAIN</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>AND CHAIN</code> is specified, a new transaction is immediately started with the same transaction characteristics (see <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a>) as the just finished one. Otherwise, no new transaction is started.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-3"><a class="anchor" href="#notes-3"></a>5.3.4. Notes</h4>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-rollback.html">ROLLBACK</a> to abort a transaction.</p>
</div>
<div class="paragraph">
<p>Issuing <code>COMMIT</code> when not inside a transaction does no harm, but it will provoke a warning message. <code>COMMIT AND CHAIN</code> when not inside a transaction is an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-3"><a class="anchor" href="#examples-3"></a>5.3.5. Examples</h4>
<div class="paragraph">
<p>To commit the current transaction and make all changes permanent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">COMMIT;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-3"><a class="anchor" href="#compatibility-3"></a>5.3.6. Compatibility</h4>
<div class="paragraph">
<p>The command <code>COMMIT</code> conforms to the SQL standard. The form <code>COMMIT TRANSACTION</code> is a IvorySQL extension.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="commit-prepared-commit-a-transaction-that-was-earlier-prepared-for-two-phase-commit"><a class="anchor" href="#commit-prepared-commit-a-transaction-that-was-earlier-prepared-for-two-phase-commit"></a>5.4. COMMIT PREPARED — commit a transaction that was earlier prepared for two-phase commit</h3>
<div class="sect3">
<h4 id="synopsis-4"><a class="anchor" href="#synopsis-4"></a>5.4.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">COMMIT PREPARED transaction_id</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-4"><a class="anchor" href="#description-4"></a>5.4.2. Description</h4>
<div class="paragraph">
<p><code>COMMIT PREPARED</code> commits a transaction that is in prepared state.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-4"><a class="anchor" href="#parameters-4"></a>5.4.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><strong><code>transaction_id</code></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The transaction identifier of the transaction that is to be committed.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-4"><a class="anchor" href="#notes-4"></a>5.4.4. Notes</h4>
<div class="paragraph">
<p>To commit a prepared transaction, you must be either the same user that executed the transaction originally, or a superuser. But you do not have to be in the same session that executed the transaction.</p>
</div>
<div class="paragraph">
<p>This command cannot be executed inside a transaction block. The prepared transaction is committed immediately.</p>
</div>
<div class="paragraph">
<p>All currently available prepared transactions are listed in the <a href="https://www.postgresql.org/docs/current/view-pg-prepared-xacts.html"><code>pg_prepared_xacts</code></a> system view.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-4"><a class="anchor" href="#examples-4"></a>5.4.5. Examples</h4>
<div class="paragraph">
<p>Commit the transaction identified by the transaction identifier <code>foobar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">COMMIT PREPARED 'foobar';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-4"><a class="anchor" href="#compatibility-4"></a>5.4.6. Compatibility</h4>
<div class="paragraph">
<p><code>COMMIT PREPARED</code> is a IvorySQL extension. It is intended for use by external transaction management systems, some of which are covered by standards (such as X/Open XA), but the SQL side of those systems is not standardized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="end-commit-the-current-transaction"><a class="anchor" href="#end-commit-the-current-transaction"></a>5.5. END — commit the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-5"><a class="anchor" href="#synopsis-5"></a>5.5.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">END [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-5"><a class="anchor" href="#description-5"></a>5.5.2. Description</h4>
<div class="paragraph">
<p><code>END</code> commits the current transaction. All changes made by the transaction become visible to others and are guaranteed to be durable if a crash occurs. This command is a IvorySQL extension that is equivalent to <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-5"><a class="anchor" href="#parameters-5"></a>5.5.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>WORK</code> <code>TRANSACTION</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional key words. They have no effect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AND CHAIN</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>AND CHAIN</code> is specified, a new transaction is immediately started with the same transaction characteristics (see <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a>) as the just finished one. Otherwise, no new transaction is started.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-5"><a class="anchor" href="#notes-5"></a>5.5.4. Notes</h4>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-rollback.html"><code>ROLLBACK</code></a> to abort a transaction.</p>
</div>
<div class="paragraph">
<p>Issuing <code>END</code> when not inside a transaction does no harm, but it will provoke a warning message.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-5"><a class="anchor" href="#examples-5"></a>5.5.5. Examples</h4>
<div class="paragraph">
<p>To commit the current transaction and make all changes permanent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">END;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-5"><a class="anchor" href="#compatibility-5"></a>5.5.6. Compatibility</h4>
<div class="paragraph">
<p><code>END</code> is a IvorySQL extension that provides functionality equivalent to <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a>, which is specified in the SQL standard.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prepare-transaction-prepare-the-current-transaction-for-two-phase-commit"><a class="anchor" href="#prepare-transaction-prepare-the-current-transaction-for-two-phase-commit"></a>5.6. PREPARE TRANSACTION — prepare the current transaction for two-phase commit</h3>
<div class="sect3">
<h4 id="synopsis-6"><a class="anchor" href="#synopsis-6"></a>5.6.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">PREPARE TRANSACTION transaction_id</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-6"><a class="anchor" href="#description-6"></a>5.6.2. Description</h4>
<div class="paragraph">
<p><code>PREPARE TRANSACTION</code> prepares the current transaction for two-phase commit. After this command, the transaction is no longer associated with the current session; instead, its state is fully stored on disk, and there is a very high probability that it can be committed successfully, even if a database crash occurs before the commit is requested.</p>
</div>
<div class="paragraph">
<p>Once prepared, a transaction can later be committed or rolled back with <a href="https://www.postgresql.org/docs/current/sql-commit-prepared.html"><code>COMMIT PREPARED</code></a> or <a href="https://www.postgresql.org/docs/current/sql-rollback-prepared.html"><code>ROLLBACK PREPARED</code></a>, respectively. Those commands can be issued from any session, not only the one that executed the original transaction.</p>
</div>
<div class="paragraph">
<p>From the point of view of the issuing session, <code>PREPARE TRANSACTION</code> is not unlike a <code>ROLLBACK</code> command: after executing it, there is no active current transaction, and the effects of the prepared transaction are no longer visible. (The effects will become visible again if the transaction is committed.)</p>
</div>
<div class="paragraph">
<p>If the <code>PREPARE TRANSACTION</code> command fails for any reason, it becomes a <code>ROLLBACK</code>: the current transaction is canceled.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-6"><a class="anchor" href="#parameters-6"></a>5.6.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><strong><code>transaction_id</code></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An arbitrary identifier that later identifies this transaction for <code>COMMIT PREPARED</code> or <code>ROLLBACK PREPARED</code>. The identifier must be written as a string literal, and must be less than 200 bytes long. It must not be the same as the identifier used for any currently prepared transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-6"><a class="anchor" href="#notes-6"></a>5.6.4. Notes</h4>
<div class="paragraph">
<p><code>PREPARE TRANSACTION</code> is not intended for use in applications or interactive sessions. Its purpose is to allow an external transaction manager to perform atomic global transactions across multiple databases or other transactional resources. Unless you&#8217;re writing a transaction manager, you probably shouldn&#8217;t be using <code>PREPARE TRANSACTION</code>.</p>
</div>
<div class="paragraph">
<p>This command must be used inside a transaction block. Use <a href="https://www.postgresql.org/docs/current/sql-begin.html"><code>BEGIN</code></a> to start one.</p>
</div>
<div class="paragraph">
<p>It is not currently allowed to <code>PREPARE</code> a transaction that has executed any operations involving temporary tables or the session&#8217;s temporary namespace, created any cursors <code>WITH HOLD</code>, or executed <code>LISTEN</code>, <code>UNLISTEN</code>, or <code>NOTIFY</code>. Those features are too tightly tied to the current session to be useful in a transaction to be prepared.</p>
</div>
<div class="paragraph">
<p>If the transaction modified any run-time parameters with <code>SET</code> (without the <code>LOCAL</code> option), those effects persist after <code>PREPARE TRANSACTION</code>, and will not be affected by any later <code>COMMIT PREPARED</code> or <code>ROLLBACK PREPARED</code>. Thus, in this one respect <code>PREPARE TRANSACTION</code> acts more like <code>COMMIT</code> than <code>ROLLBACK</code>.</p>
</div>
<div class="paragraph">
<p>All currently available prepared transactions are listed in the <a href="https://www.postgresql.org/docs/current/view-pg-prepared-xacts.html"><code>pg_prepared_xacts</code></a> system view.</p>
</div>
</div>
<div class="sect3">
<h4 id="caution"><a class="anchor" href="#caution"></a>5.6.5. Caution</h4>
<div class="paragraph">
<p>It is unwise to leave transactions in the prepared state for a long time. This will interfere with the ability of <code>VACUUM</code> to reclaim storage, and in extreme cases could cause the database to shut down to prevent transaction ID wraparound (see <a href="https://www.postgresql.org/docs/current/routine-vacuuming.html#VACUUM-FOR-WRAPAROUND">Section 25.1.5</a>). Keep in mind also that the transaction continues to hold whatever locks it held. The intended usage of the feature is that a prepared transaction will normally be committed or rolled back as soon as an external transaction manager has verified that other databases are also prepared to commit.</p>
</div>
<div class="paragraph">
<p>If you have not set up an external transaction manager to track prepared transactions and ensure they get closed out promptly, it is best to keep the prepared-transaction feature disabled by setting <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</a> to zero. This will prevent accidental creation of prepared transactions that might then be forgotten and eventually cause problems.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-6"><a class="anchor" href="#examples-6"></a>5.6.6. Examples</h4>
<div class="paragraph">
<p>Prepare the current transaction for two-phase commit, using <code>foobar</code> as the transaction identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">PREPARE TRANSACTION 'foobar';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-6"><a class="anchor" href="#compatibility-6"></a>5.6.7. Compatibility</h4>
<div class="paragraph">
<p><code>PREPARE TRANSACTION</code> is a IvorySQL extension. It is intended for use by external transaction management systems, some of which are covered by standards (such as X/Open XA), but the SQL side of those systems is not standardized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rollback-abort-the-current-transaction"><a class="anchor" href="#rollback-abort-the-current-transaction"></a>5.7. ROLLBACK — abort the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-7"><a class="anchor" href="#synopsis-7"></a>5.7.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ROLLBACK [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-7"><a class="anchor" href="#description-7"></a>5.7.2. Description</h4>
<div class="paragraph">
<p><code>ROLLBACK</code> rolls back the current transaction and causes all the updates made by the transaction to be discarded.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-7"><a class="anchor" href="#parameters-7"></a>5.7.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>WORK</code> <code>TRANSACTION</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional key words. They have no effect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AND CHAIN</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>AND CHAIN</code> is specified, a new transaction is immediately started with the same transaction characteristics (see <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a>) as the just finished one. Otherwise, no new transaction is started.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-7"><a class="anchor" href="#notes-7"></a>5.7.4. Notes</h4>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-commit.html"><code>COMMIT</code></a> to successfully terminate a transaction.</p>
</div>
<div class="paragraph">
<p>Issuing <code>ROLLBACK</code> outside of a transaction block emits a warning and otherwise has no effect. <code>ROLLBACK AND CHAIN</code> outside of a transaction block is an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-7"><a class="anchor" href="#examples-7"></a>5.7.5. Examples</h4>
<div class="paragraph">
<p>To abort all changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ROLLBACK;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-7"><a class="anchor" href="#compatibility-7"></a>5.7.6. Compatibility</h4>
<div class="paragraph">
<p>The command <code>ROLLBACK</code> conforms to the SQL standard. The form <code>ROLLBACK TRANSACTION</code> is a IvorySQL extension.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rollback-prepared-cancel-a-transaction-that-was-earlier-prepared-for-two-phase-commit"><a class="anchor" href="#rollback-prepared-cancel-a-transaction-that-was-earlier-prepared-for-two-phase-commit"></a>5.8. ROLLBACK PREPARED — cancel a transaction that was earlier prepared for two-phase commit</h3>
<div class="sect3">
<h4 id="synopsis-8"><a class="anchor" href="#synopsis-8"></a>5.8.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ROLLBACK PREPARED transaction_id</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-8"><a class="anchor" href="#description-8"></a>5.8.2. Description</h4>
<div class="paragraph">
<p><code>ROLLBACK PREPARED</code> rolls back a transaction that is in prepared state.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-8"><a class="anchor" href="#parameters-8"></a>5.8.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><strong><code>transaction_id</code></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The transaction identifier of the transaction that is to be rolled back.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-8"><a class="anchor" href="#notes-8"></a>5.8.4. Notes</h4>
<div class="paragraph">
<p>To roll back a prepared transaction, you must be either the same user that executed the transaction originally, or a superuser. But you do not have to be in the same session that executed the transaction.</p>
</div>
<div class="paragraph">
<p>This command cannot be executed inside a transaction block. The prepared transaction is rolled back immediately.</p>
</div>
<div class="paragraph">
<p>All currently available prepared transactions are listed in the <a href="https://www.postgresql.org/docs/current/view-pg-prepared-xacts.html"><code>pg_prepared_xacts</code></a> system view.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-8"><a class="anchor" href="#examples-8"></a>5.8.5. Examples</h4>
<div class="paragraph">
<p>Roll back the transaction identified by the transaction identifier <code>foobar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ROLLBACK PREPARED 'foobar';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-8"><a class="anchor" href="#compatibility-8"></a>5.8.6. Compatibility</h4>
<div class="paragraph">
<p><code>ROLLBACK PREPARED</code> is a IvorySQL extension. It is intended for use by external transaction management systems, some of which are covered by standards (such as X/Open XA), but the SQL side of those systems is not standardized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="savepoint-define-a-new-savepoint-within-the-current-transaction"><a class="anchor" href="#savepoint-define-a-new-savepoint-within-the-current-transaction"></a>5.9. SAVEPOINT — define a new savepoint within the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-9"><a class="anchor" href="#synopsis-9"></a>5.9.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SAVEPOINT savepoint_name</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-9"><a class="anchor" href="#description-9"></a>5.9.2. Description</h4>
<div class="paragraph">
<p><code>SAVEPOINT</code> establishes a new savepoint within the current transaction.</p>
</div>
<div class="paragraph">
<p>A savepoint is a special mark inside a transaction that allows all commands that are executed after it was established to be rolled back, restoring the transaction state to what it was at the time of the savepoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-9"><a class="anchor" href="#parameters-9"></a>5.9.3. Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><strong><code>savepoint_name</code></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name to give to the new savepoint. If savepoints with the same name already exist, they will be inaccessible until newer identically-named savepoints are released.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-9"><a class="anchor" href="#notes-9"></a>5.9.4. Notes</h4>
<div class="paragraph">
<p>Use <a href="https://www.postgresql.org/docs/current/sql-rollback-to.html"><code>ROLLBACK TO</code></a> to rollback to a savepoint. Use <a href="https://www.postgresql.org/docs/current/sql-release-savepoint.html"><code>RELEASE SAVEPOINT</code></a> to destroy a savepoint, keeping the effects of commands executed after it was established.</p>
</div>
<div class="paragraph">
<p>Savepoints can only be established when inside a transaction block. There can be multiple savepoints defined within a transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-9"><a class="anchor" href="#examples-9"></a>5.9.5. Examples</h4>
<div class="paragraph">
<p>To establish a savepoint and later undo the effects of all commands executed after it was established:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN;
    INSERT INTO table1 VALUES (1);
    SAVEPOINT my_savepoint;
    INSERT INTO table1 VALUES (2);
    ROLLBACK TO SAVEPOINT my_savepoint;
    INSERT INTO table1 VALUES (3);
COMMIT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above transaction will insert the values 1 and 3, but not 2.</p>
</div>
<div class="paragraph">
<p>To establish and later destroy a savepoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN;
    INSERT INTO table1 VALUES (3);
    SAVEPOINT my_savepoint;
    INSERT INTO table1 VALUES (4);
    RELEASE SAVEPOINT my_savepoint;
COMMIT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above transaction will insert both 3 and 4.</p>
</div>
<div class="paragraph">
<p>To use a single savepoint name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN;
    INSERT INTO table1 VALUES (1);
    SAVEPOINT my_savepoint;
    INSERT INTO table1 VALUES (2);
    SAVEPOINT my_savepoint;
    INSERT INTO table1 VALUES (3);

    -- rollback to the second savepoint
    ROLLBACK TO SAVEPOINT my_savepoint;
    SELECT * FROM table1;               -- shows rows 1 and 2

    -- release the second savepoint
    RELEASE SAVEPOINT my_savepoint;

    -- rollback to the first savepoint
    ROLLBACK TO SAVEPOINT my_savepoint;
    SELECT * FROM table1;               -- shows only row 1
COMMIT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above transaction shows row 3 being rolled back first, then row 2.</p>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-9"><a class="anchor" href="#compatibility-9"></a>5.9.6. Compatibility</h4>
<div class="paragraph">
<p>SQL requires a savepoint to be destroyed automatically when another savepoint with the same name is established. In IvorySQL, the old savepoint is kept, though only the more recent one will be used when rolling back or releasing. (Releasing the newer savepoint with <code>RELEASE SAVEPOINT</code> will cause the older one to again become accessible to <code>ROLLBACK TO SAVEPOINT</code> and <code>RELEASE SAVEPOINT</code>.) Otherwise, <code>SAVEPOINT</code> is fully SQL conforming.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-constraints-set-constraint-check-timing-for-the-current-transaction"><a class="anchor" href="#set-constraints-set-constraint-check-timing-for-the-current-transaction"></a>5.10. SET CONSTRAINTS — set constraint check timing for the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-10"><a class="anchor" href="#synopsis-10"></a>5.10.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SET CONSTRAINTS { ALL | name [, ...] } { DEFERRED | IMMEDIATE }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-10"><a class="anchor" href="#description-10"></a>5.10.2. Description</h4>
<div class="paragraph">
<p><code>SET CONSTRAINTS</code> sets the behavior of constraint checking within the current transaction. <code>IMMEDIATE</code> constraints are checked at the end of each statement. <code>DEFERRED</code> constraints are not checked until transaction commit. Each constraint has its own <code>IMMEDIATE</code> or <code>DEFERRED</code> mode.</p>
</div>
<div class="paragraph">
<p>Upon creation, a constraint is given one of three characteristics: <code>DEFERRABLE INITIALLY DEFERRED</code>, <code>DEFERRABLE INITIALLY IMMEDIATE</code>, or <code>NOT DEFERRABLE</code>. The third class is always <code>IMMEDIATE</code> and is not affected by the <code>SET CONSTRAINTS</code> command. The first two classes start every transaction in the indicated mode, but their behavior can be changed within a transaction by <code>SET CONSTRAINTS</code>.</p>
</div>
<div class="paragraph">
<p><code>SET CONSTRAINTS</code> with a list of constraint names changes the mode of just those constraints (which must all be deferrable). Each constraint name can be schema-qualified. The current schema search path is used to find the first matching name if no schema name is specified. <code>SET CONSTRAINTS ALL</code> changes the mode of all deferrable constraints.</p>
</div>
<div class="paragraph">
<p>When <code>SET CONSTRAINTS</code> changes the mode of a constraint from <code>DEFERRED</code> to <code>IMMEDIATE</code>, the new mode takes effect retroactively: any outstanding data modifications that would have been checked at the end of the transaction are instead checked during the execution of the <code>SET CONSTRAINTS</code> command. If any such constraint is violated, the <code>SET CONSTRAINTS</code> fails (and does not change the constraint mode). Thus, <code>SET CONSTRAINTS</code> can be used to force checking of constraints to occur at a specific point in a transaction.</p>
</div>
<div class="paragraph">
<p>Currently, only <code>UNIQUE</code>, <code>PRIMARY KEY</code>, <code>REFERENCES</code> (foreign key), and <code>EXCLUDE</code> constraints are affected by this setting. <code>NOT NULL</code> and <code>CHECK</code> constraints are always checked immediately when a row is inserted or modified (<strong>not</strong> at the end of the statement). Uniqueness and exclusion constraints that have not been declared <code>DEFERRABLE</code> are also checked immediately.</p>
</div>
<div class="paragraph">
<p>The firing of triggers that are declared as “constraint triggers” is also controlled by this setting — they fire at the same time that the associated constraint should be checked.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-10"><a class="anchor" href="#notes-10"></a>5.10.3. Notes</h4>
<div class="paragraph">
<p>Because IvorySQL does not require constraint names to be unique within a schema (but only per-table), it is possible that there is more than one match for a specified constraint name. In this case <code>SET CONSTRAINTS</code> will act on all matches. For a non-schema-qualified name, once a match or matches have been found in some schema in the search path, schemas appearing later in the path are not searched.</p>
</div>
<div class="paragraph">
<p>This command only alters the behavior of constraints within the current transaction. Issuing this outside of a transaction block emits a warning and otherwise has no effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-10"><a class="anchor" href="#compatibility-10"></a>5.10.4. Compatibility</h4>
<div class="paragraph">
<p>This command complies with the behavior defined in the SQL standard, except for the limitation that, in IvorySQL, it does not apply to <code>NOT NULL</code> and <code>CHECK</code> constraints. Also, IvorySQL checks non-deferrable uniqueness constraints immediately, not at end of statement as the standard would suggest.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-transaction-set-the-characteristics-of-the-current-transaction"><a class="anchor" href="#set-transaction-set-the-characteristics-of-the-current-transaction"></a>5.11. SET TRANSACTION — set the characteristics of the current transaction</h3>
<div class="sect3">
<h4 id="synopsis-11"><a class="anchor" href="#synopsis-11"></a>5.11.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SET TRANSACTION transaction_mode [, ...]
SET TRANSACTION SNAPSHOT snapshot_id
SET SESSION CHARACTERISTICS AS TRANSACTION transaction_mode [, ...]

where transaction_mode is one of:

    ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED }
    READ WRITE | READ ONLY
    [ NOT ] DEFERRABLE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-11"><a class="anchor" href="#description-11"></a>5.11.2. Description</h4>
<div class="paragraph">
<p>The <code>SET TRANSACTION</code> command sets the characteristics of the current transaction. It has no effect on any subsequent transactions. <code>SET SESSION CHARACTERISTICS</code> sets the default transaction characteristics for subsequent transactions of a session. These defaults can be overridden by <code>SET TRANSACTION</code> for an individual transaction.</p>
</div>
<div class="paragraph">
<p>The available transaction characteristics are the transaction isolation level, the transaction access mode (read/write or read-only), and the deferrable mode. In addition, a snapshot can be selected, though only for the current transaction, not as a session default.</p>
</div>
<div class="paragraph">
<p>The isolation level of a transaction determines what data the transaction can see when other transactions are running concurrently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ COMMITTED</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A statement can only see rows committed before it began. This is the default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>REPEATABLE READ</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All statements of the current transaction can only see rows committed before the first query or data-modification statement was executed in this transaction.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SERIALIZABLE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All statements of the current transaction can only see rows committed before the first query or data-modification statement was executed in this transaction. If a pattern of reads and writes among concurrent serializable transactions would create a situation which could not have occurred for any serial (one-at-a-time) execution of those transactions, one of them will be rolled back with a <code>serialization_failure</code> error.</p>
</div>
<div class="paragraph">
<p>The SQL standard defines one additional level, <code>READ UNCOMMITTED</code>. In IvorySQL <code>READ UNCOMMITTED</code> is treated as <code>READ COMMITTED</code>.</p>
</div>
<div class="paragraph">
<p>The transaction isolation level cannot be changed after the first query or data-modification statement (<code>SELECT</code>, <code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code>, <code>FETCH</code>, or <code>COPY</code>) of a transaction has been executed. See <a href="https://www.postgresql.org/docs/current/mvcc.html">Chapter 13</a> for more information about transaction isolation and concurrency control.</p>
</div>
<div class="paragraph">
<p>The transaction access mode determines whether the transaction is read/write or read-only. Read/write is the default. When a transaction is read-only, the following SQL commands are disallowed: <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, and <code>COPY FROM</code> if the table they would write to is not a temporary table; all <code>CREATE</code>, <code>ALTER</code>, and <code>DROP</code> commands; <code>COMMENT</code>, <code>GRANT</code>, <code>REVOKE</code>, <code>TRUNCATE</code>; and <code>EXPLAIN ANALYZE</code> and <code>EXECUTE</code> if the command they would execute is among those listed. This is a high-level notion of read-only that does not prevent all writes to disk.</p>
</div>
<div class="paragraph">
<p>The <code>DEFERRABLE</code> transaction property has no effect unless the transaction is also <code>SERIALIZABLE</code> and <code>READ ONLY</code>. When all three of these properties are selected for a transaction, the transaction may block when first acquiring its snapshot, after which it is able to run without the normal overhead of a <code>SERIALIZABLE</code> transaction and without any risk of contributing to or being canceled by a serialization failure. This mode is well suited for long-running reports or backups.</p>
</div>
<div class="paragraph">
<p>The <code>SET TRANSACTION SNAPSHOT</code> command allows a new transaction to run with the same <strong>snapshot</strong> as an existing transaction. The pre-existing transaction must have exported its snapshot with the <code>pg_export_snapshot</code> function. That function returns a snapshot identifier, which must be given to <code>SET TRANSACTION SNAPSHOT</code> to specify which snapshot is to be imported. The identifier must be written as a string literal in this command, for example <code>'00000003-0000001B-1'</code>. <code>SET TRANSACTION SNAPSHOT</code> can only be executed at the start of a transaction, before the first query or data-modification statement (<code>SELECT</code>, <code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code>, <code>FETCH</code>, or <code>COPY</code>) of the transaction. Furthermore, the transaction must already be set to <code>SERIALIZABLE</code> or <code>REPEATABLE READ</code> isolation level (otherwise, the snapshot would be discarded immediately, since <code>READ COMMITTED</code> mode takes a new snapshot for each command). If the importing transaction uses <code>SERIALIZABLE</code> isolation level, then the transaction that exported the snapshot must also use that isolation level. Also, a non-read-only serializable transaction cannot import a snapshot from a read-only transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-11"><a class="anchor" href="#notes-11"></a>5.11.3. Notes</h4>
<div class="paragraph">
<p>If <code>SET TRANSACTION</code> is executed without a prior <code>START TRANSACTION</code> or <code>BEGIN</code>, it emits a warning and otherwise has no effect.</p>
</div>
<div class="paragraph">
<p>It is possible to dispense with <code>SET TRANSACTION</code> by instead specifying the desired <strong><code>transaction_modes</code></strong> in <code>BEGIN</code> or <code>START TRANSACTION</code>. But that option is not available for <code>SET TRANSACTION SNAPSHOT</code>.</p>
</div>
<div class="paragraph">
<p>The session default transaction modes can also be set or examined via the configuration parameters <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-DEFAULT-TRANSACTION-ISOLATION">default_transaction_isolation</a>, <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-DEFAULT-TRANSACTION-READ-ONLY">default_transaction_read_only</a>, and <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-DEFAULT-TRANSACTION-DEFERRABLE">default_transaction_deferrable</a>. (In fact <code>SET SESSION CHARACTERISTICS</code> is just a verbose equivalent for setting these variables with <code>SET</code>.) This means the defaults can be set in the configuration file, via <code>ALTER DATABASE</code>, etc. Consult <a href="https://www.postgresql.org/docs/current/runtime-config.html">Chapter 20</a> for more information.</p>
</div>
<div class="paragraph">
<p>The current transaction&#8217;s modes can similarly be set or examined via the configuration parameters <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-TRANSACTION-ISOLATION">transaction_isolation</a>, <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-TRANSACTION-READ-ONLY">transaction_read_only</a>, and <a href="https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-TRANSACTION-DEFERRABLE">transaction_deferrable</a>. Setting one of these parameters acts the same as the corresponding <code>SET TRANSACTION</code> option, with the same restrictions on when it can be done. However, these parameters cannot be set in the configuration file, or from any source other than live SQL.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples-10"><a class="anchor" href="#examples-10"></a>5.11.4. Examples</h4>
<div class="paragraph">
<p>To begin a new transaction with the same snapshot as an already existing transaction, first export the snapshot from the existing transaction. That will return the snapshot identifier, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SELECT pg_export_snapshot();
 pg_export_snapshot
---------------------
 00000003-0000001B-1
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then give the snapshot identifier in a <code>SET TRANSACTION SNAPSHOT</code> command at the beginning of the newly opened transaction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SET TRANSACTION SNAPSHOT '00000003-0000001B-1';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-11"><a class="anchor" href="#compatibility-11"></a>5.11.5. Compatibility</h4>
<div class="paragraph">
<p>These commands are defined in the SQL standard, except for the <code>DEFERRABLE</code> transaction mode and the <code>SET TRANSACTION SNAPSHOT</code> form, which are IvorySQL extensions.</p>
</div>
<div class="paragraph">
<p><code>SERIALIZABLE</code> is the default transaction isolation level in the standard. In IvorySQL the default is ordinarily <code>READ COMMITTED</code>, but you can change it as mentioned above.</p>
</div>
<div class="paragraph">
<p>In the SQL standard, there is one other transaction characteristic that can be set with these commands: the size of the diagnostics area. This concept is specific to embedded SQL, and therefore is not implemented in the IvorySQL server.</p>
</div>
<div class="paragraph">
<p>The SQL standard requires commas between successive <strong><code>transaction_modes</code></strong>, but for historical reasons IvorySQL allows the commas to be omitted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="start-transaction-start-a-transaction-block"><a class="anchor" href="#start-transaction-start-a-transaction-block"></a>5.12. START TRANSACTION — start a transaction block</h3>
<div class="sect3">
<h4 id="synopsis-12"><a class="anchor" href="#synopsis-12"></a>5.12.1. Synopsis</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">START TRANSACTION [ transaction_mode [, ...] ]

where transaction_mode is one of:

    ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED }
    READ WRITE | READ ONLY
    [ NOT ] DEFERRABLE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-12"><a class="anchor" href="#description-12"></a>5.12.2. Description</h4>
<div class="paragraph">
<p>This command begins a new transaction block. If the isolation level, read/write mode, or deferrable mode is specified, the new transaction has those characteristics, as if <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html"><code>SET TRANSACTION</code></a> was executed. This is the same as the <a href="https://www.postgresql.org/docs/current/sql-begin.html"><code>BEGIN</code></a> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-10"><a class="anchor" href="#parameters-10"></a>5.12.3. Parameters</h4>
<div class="paragraph">
<p>Refer to <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a> for information on the meaning of the parameters to this statement.</p>
</div>
</div>
<div class="sect3">
<h4 id="compatibility-12"><a class="anchor" href="#compatibility-12"></a>5.12.4. Compatibility</h4>
<div class="paragraph">
<p>In the standard, it is not necessary to issue <code>START TRANSACTION</code> to start a transaction block: any SQL command implicitly begins a block. IvorySQL&#8217;s behavior can be seen as implicitly issuing a <code>COMMIT</code> after each command that does not follow <code>START TRANSACTION</code> (or <code>BEGIN</code>), and it is therefore often called “autocommit”. Other relational database systems might offer an autocommit feature as a convenience.</p>
</div>
<div class="paragraph">
<p>The <code>DEFERRABLE</code> <strong><code>transaction_mode</code></strong> is a IvorySQL language extension.</p>
</div>
<div class="paragraph">
<p>The SQL standard requires commas between successive <strong><code>transaction_modes</code></strong>, but for historical reasons IvorySQL allows the commas to be omitted.</p>
</div>
<div class="paragraph">
<p>See also the compatibility section of <a href="https://www.postgresql.org/docs/current/sql-set-transaction.html">SET TRANSACTION</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sql-reference"><a class="anchor" href="#sql-reference"></a>6. Sql Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="lexical-structure"><a class="anchor" href="#lexical-structure"></a>6.1. Lexical Structure</h3>
<div class="paragraph">
<p>SQL input consists of a sequence of <strong>commands</strong>. A command is composed of a sequence of <strong>tokens</strong>, terminated by a semicolon (“;”). The end of the input stream also terminates a command. Which tokens are valid depends on the syntax of the particular command.</p>
</div>
<div class="paragraph">
<p>A token can be a <strong>key word</strong>, an <strong>identifier</strong>, a <strong>quoted identifier</strong>, a <strong>literal</strong> (or constant), or a special character symbol. Tokens are normally separated by whitespace (space, tab, newline), but need not be if there is no ambiguity (which is generally only the case if a special character is adjacent to some other token type).</p>
</div>
<div class="paragraph">
<p>For example, the following is (syntactically) valid SQL input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT * FROM MY_TABLE;
UPDATE MY_TABLE SET A = 5;
INSERT INTO MY_TABLE VALUES (3, 'hi there');</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a sequence of three commands, one per line (although this is not required; more than one command can be on a line, and commands can usefully be split across lines).</p>
</div>
<div class="paragraph">
<p>Additionally, <strong>comments</strong> can occur in SQL input. They are not tokens, they are effectively equivalent to whitespace.</p>
</div>
<div class="paragraph">
<p>The SQL syntax is not very consistent regarding what tokens identify commands and which are operands or parameters. The first few tokens are generally the command name, so in the above example we would usually speak of a “SELECT”, an “UPDATE”, and an “INSERT” command. But for instance the <code>UPDATE</code> command always requires a <code>SET</code> token to appear in a certain position, and this particular variation of <code>INSERT</code> also requires a <code>VALUES</code> in order to be complete.</p>
</div>
<div class="sect3">
<h4 id="identifiers-and-key-words"><a class="anchor" href="#identifiers-and-key-words"></a>6.1.1. Identifiers and Key Words</h4>
<div class="paragraph">
<p>Tokens such as <code>SELECT</code>, <code>UPDATE</code>, or <code>VALUES</code> in the example above are examples of <strong>key words</strong>, that is, words that have a fixed meaning in the SQL language. The tokens <code>MY_TABLE</code> and <code>A</code> are examples of <strong>identifiers</strong>. They identify names of tables, columns, or other database objects, depending on the command they are used in. Therefore they are sometimes simply called “names”. Key words and identifiers have the same lexical structure, meaning that one cannot know whether a token is an identifier or a key word without knowing the language. A complete list of key words can be found in <a href="https://www.postgresql.org/docs/current/sql-keywords-appendix.html">Appendix C</a>.</p>
</div>
<div class="paragraph">
<p>SQL identifiers and key words must begin with a letter (<code>a</code>-<code>z</code>, but also letters with diacritical marks and non-Latin letters) or an underscore (<code>_</code>). Subsequent characters in an identifier or key word can be letters, underscores, digits (<code>0</code>-<code>9</code>), or dollar signs (<code>$</code>). Note that dollar signs are not allowed in identifiers according to the letter of the SQL standard, so their use might render applications less portable. The SQL standard will not define a key word that contains digits or starts or ends with an underscore, so identifiers of this form are safe against possible conflict with future extensions of the standard.</p>
</div>
<div class="paragraph">
<p>The system uses no more than <code>NAMEDATALEN</code>-1 bytes of an identifier; longer names can be written in commands, but they will be truncated. By default, <code>NAMEDATALEN</code> is 64 so the maximum identifier length is 63 bytes. If this limit is problematic, it can be raised by changing the <code>NAMEDATALEN</code> constant in <code>src/include/pg_config_manual.h</code>.</p>
</div>
<div class="paragraph">
<p>Key words and unquoted identifiers are case insensitive. Therefore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">UPDATE MY_TABLE SET A = 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>can equivalently be written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">uPDaTE my_TabLE SeT a = 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A convention often used is to write key words in upper case and names in lower case, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">UPDATE my_table SET a = 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a second kind of identifier: the <strong>delimited identifier</strong> or <strong>quoted identifier</strong>. It is formed by enclosing an arbitrary sequence of characters in double-quotes (<code>"</code>). A delimited identifier is always an identifier, never a key word. So <code>"select"</code> could be used to refer to a column or table named “select”, whereas an unquoted <code>select</code> would be taken as a key word and would therefore provoke a parse error when used where a table or column name is expected. The example can be written with quoted identifiers like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">UPDATE "my_table" SET "a" = 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quoted identifiers can contain any character, except the character with code zero. (To include a double quote, write two double quotes.) This allows constructing table or column names that would otherwise not be possible, such as ones containing spaces or ampersands. The length limitation still applies.</p>
</div>
<div class="paragraph">
<p>Quoting an identifier also makes it case-sensitive, whereas unquoted names are always folded to lower case. For example, the identifiers <code>FOO</code>, <code>foo</code>, and <code>"foo"</code> are considered the same by IvorySQL, but <code>"Foo"</code> and <code>"FOO"</code> are different from these three and each other. (The folding of unquoted names to lower case in IvorySQL is incompatible with the SQL standard, which says that unquoted names should be folded to upper case. Thus, <code>foo</code> should be equivalent to <code>"FOO"</code> not <code>"foo"</code> according to the standard. If you want to write portable applications you are advised to always quote a particular name or never quote it.)</p>
</div>
<div class="paragraph">
<p>A variant of quoted identifiers allows including escaped Unicode characters identified by their code points. This variant starts with <code>U&amp;</code> (upper or lower case U followed by ampersand) immediately before the opening double quote, without any spaces in between, for example <code>U&amp;"foo"</code>. (Note that this creates an ambiguity with the operator <code>&amp;</code>. Use spaces around the operator to avoid this problem.) Inside the quotes, Unicode characters can be specified in escaped form by writing a backslash followed by the four-digit hexadecimal code point number or alternatively a backslash followed by a plus sign followed by a six-digit hexadecimal code point number. For example, the identifier <code>"data"</code> could be written as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;"d\0061t\+000061"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following less trivial example writes the Russian word “slon” (elephant) in Cyrillic letters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;"\0441\043B\043E\043D"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a different escape character than backslash is desired, it can be specified using the <code>UESCAPE</code> clause after the string, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;"d!0061t!+000061" UESCAPE '!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The escape character can be any single character other than a hexadecimal digit, the plus sign, a single quote, a double quote, or a whitespace character. Note that the escape character is written in single quotes, not double quotes, after <code>UESCAPE</code>.</p>
</div>
<div class="paragraph">
<p>To include the escape character in the identifier literally, write it twice.</p>
</div>
<div class="paragraph">
<p>Either the 4-digit or the 6-digit escape form can be used to specify UTF-16 surrogate pairs to compose characters with code points larger than U+FFFF, although the availability of the 6-digit form technically makes this unnecessary. (Surrogate pairs are not stored directly, but are combined into a single code point.)</p>
</div>
<div class="paragraph">
<p>If the server encoding is not UTF-8, the Unicode code point identified by one of these escape sequences is converted to the actual server encoding; an error is reported if that&#8217;s not possible.</p>
</div>
</div>
<div class="sect3">
<h4 id="constants"><a class="anchor" href="#constants"></a>6.1.2. Constants</h4>
<div class="paragraph">
<p>There are three kinds of <strong>implicitly-typed constants</strong> in IvorySQL: strings, bit strings, and numbers. Constants can also be specified with explicit types, which can enable more accurate representation and more efficient handling by the system. These alternatives are discussed in the following subsections.</p>
</div>
<div class="sect4">
<h5 id="string-constants"><a class="anchor" href="#string-constants"></a>6.1.2.1. String Constants</h5>
<div class="paragraph">
<p>A string constant in SQL is an arbitrary sequence of characters bounded by single quotes (<code>'</code>), for example <code>'This is a string'</code>. To include a single-quote character within a string constant, write two adjacent single quotes, e.g., <code>'Dianne''s horse'</code>. Note that this is <strong>not</strong> the same as a double-quote character (<code>"</code>).</p>
</div>
<div class="paragraph">
<p>Two string constants that are only separated by whitespace <strong>with at least one newline</strong> are concatenated and effectively treated as if the string had been written as one constant. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT 'foo'
'bar';</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT 'foobar';</code></pre>
</div>
</div>
<div class="paragraph">
<p>but:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT 'foo'      'bar';</code></pre>
</div>
</div>
<div class="paragraph">
<p>is not valid syntax. (This slightly bizarre behavior is specified by SQL; IvorySQL is following the standard.)</p>
</div>
</div>
<div class="sect4">
<h5 id="string-constants-with-c-style-escapes"><a class="anchor" href="#string-constants-with-c-style-escapes"></a>6.1.2.2. String Constants With C-Style Escapes</h5>
<div class="paragraph">
<p>IvorySQL also accepts “escape” string constants, which are an extension to the SQL standard. An escape string constant is specified by writing the letter <code>E</code> (upper or lower case) just before the opening single quote, e.g., <code>E&#8217;foo'</code>. (When continuing an escape string constant across lines, write <code>E</code> only before the first opening quote.) Within an escape string, a backslash character (<code>\</code>) begins a C-like <strong>backslash escape</strong> sequence, in which the combination of backslash and following character(s) represent a special byte value.</p>
</div>
<div class="paragraph">
<p><strong>Table 5.1. Backslash Escape Sequences</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backslash Escape Sequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpretation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carriage return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*`o</code>*<code>, `*`oo</code>*<code>, `*`ooo</code>*` (<strong><code>o</code></strong> = 0–7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">octal byte value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\x*`h</code><strong><code>, `\x</strong>`hh</code><strong>` (</strong><code>h</code>* = 0–9, A–F)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hexadecimal byte value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\u*`xxxx</code><strong><code>, `\U</strong>`xxxxxxxx</code><strong>` (</strong><code>x</code>* = 0–9, A–F)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 or 32-bit hexadecimal Unicode character value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any other character following a backslash is taken literally. Thus, to include a backslash character, write two backslashes (<code>\\</code>). Also, a single quote can be included in an escape string by writing <code>\'</code>, in addition to the normal way of <code>''</code>.</p>
</div>
<div class="paragraph">
<p>It is your responsibility that the byte sequences you create, especially when using the octal or hexadecimal escapes, compose valid characters in the server character set encoding. A useful alternative is to use Unicode escapes or the alternative Unicode escape syntax, ; then the server will check that the character conversion is possible.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caution</div>
<div class="paragraph">
<p>If the configuration parameter <a href="https://www.postgresql.org/docs/current/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS">standard_conforming_strings</a> is <code>off</code>, then IvorySQL recognizes backslash escapes in both regular and escape string constants. However, as of IvorySQL 9.1, the default is <code>on</code>, meaning that backslash escapes are recognized only in escape string constants. This behavior is more standards-compliant, but might break applications which rely on the historical behavior, where backslash escapes were always recognized. As a workaround, you can set this parameter to <code>off</code>, but it is better to migrate away from using backslash escapes. If you need to use a backslash escape to represent a special character, write the string constant with an <code>E</code>.In addition to <code>standard_conforming_strings</code>, the configuration parameters <a href="https://www.postgresql.org/docs/current/runtime-config-compatible.html#GUC-ESCAPE-STRING-WARNING">escape_string_warning</a> and <a href="https://www.postgresql.org/docs/current/runtime-config-compatible.html#GUC-BACKSLASH-QUOTE">backslash_quote</a> govern treatment of backslashes in string constants.The character with the code zero cannot be in a string constant.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="string-constants-with-unicode-escapes"><a class="anchor" href="#string-constants-with-unicode-escapes"></a>6.1.2.3. String Constants With Unicode Escapes</h5>
<div class="paragraph">
<p>IvorySQL also supports another type of escape syntax for strings that allows specifying arbitrary Unicode characters by code point. A Unicode escape string constant starts with <code>U&amp;</code> (upper or lower case letter U followed by ampersand) immediately before the opening quote, without any spaces in between, for example <code>U&amp;'foo'</code>. (Note that this creates an ambiguity with the operator <code>&amp;</code>. Use spaces around the operator to avoid this problem.) Inside the quotes, Unicode characters can be specified in escaped form by writing a backslash followed by the four-digit hexadecimal code point number or alternatively a backslash followed by a plus sign followed by a six-digit hexadecimal code point number. For example, the string <code>'data'</code> could be written as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;'d\0061t\+000061'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following less trivial example writes the Russian word “slon” (elephant) in Cyrillic letters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;'\0441\043B\043E\043D'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a different escape character than backslash is desired, it can be specified using the <code>UESCAPE</code> clause after the string, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">U&amp;'d!0061t!+000061' UESCAPE '!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The escape character can be any single character other than a hexadecimal digit, the plus sign, a single quote, a double quote, or a whitespace character.</p>
</div>
<div class="paragraph">
<p>To include the escape character in the string literally, write it twice.</p>
</div>
<div class="paragraph">
<p>Either the 4-digit or the 6-digit escape form can be used to specify UTF-16 surrogate pairs to compose characters with code points larger than U+FFFF, although the availability of the 6-digit form technically makes this unnecessary. (Surrogate pairs are not stored directly, but are combined into a single code point.)</p>
</div>
<div class="paragraph">
<p>If the server encoding is not UTF-8, the Unicode code point identified by one of these escape sequences is converted to the actual server encoding; an error is reported if that&#8217;s not possible.</p>
</div>
<div class="paragraph">
<p>Also, the Unicode escape syntax for string constants only works when the configuration parameter <a href="https://www.postgresql.org/docs/current/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS">standard_conforming_strings</a> is turned on. This is because otherwise this syntax could confuse clients that parse the SQL statements to the point that it could lead to SQL injections and similar security issues. If the parameter is set to off, this syntax will be rejected with an error message.</p>
</div>
</div>
<div class="sect4">
<h5 id="dollar-quoted-string-constants"><a class="anchor" href="#dollar-quoted-string-constants"></a>6.1.2.4. Dollar-Quoted String Constants</h5>
<div class="paragraph">
<p>While the standard syntax for specifying string constants is usually convenient, it can be difficult to understand when the desired string contains many single quotes or backslashes, since each of those must be doubled. To allow more readable queries in such situations, IvorySQL provides another way, called “dollar quoting”, to write string constants. A dollar-quoted string constant consists of a dollar sign (<code>$</code>), an optional “tag” of zero or more characters, another dollar sign, an arbitrary sequence of characters that makes up the string content, a dollar sign, the same tag that began this dollar quote, and a dollar sign. For example, here are two different ways to specify the string “Dianne&#8217;s horse” using dollar quoting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$$Dianne's horse$$
$SomeTag$Dianne's horse$SomeTag$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that inside the dollar-quoted string, single quotes can be used without needing to be escaped. Indeed, no characters inside a dollar-quoted string are ever escaped: the string content is always written literally. Backslashes are not special, and neither are dollar signs, unless they are part of a sequence matching the opening tag.</p>
</div>
<div class="paragraph">
<p>It is possible to nest dollar-quoted string constants by choosing different tags at each nesting level. This is most commonly used in writing function definitions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$function$
BEGIN
    RETURN ($1 ~ $q$[\t\r\n\v\\]$q$);
END;
$function$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the sequence <code>$q$[\t\r\n\v\\]$q$</code> represents a dollar-quoted literal string <code>[\t\r\n\v\\]</code>, which will be recognized when the function body is executed by IvorySQL. But since the sequence does not match the outer dollar quoting delimiter <code>$function$</code>, it is just some more characters within the constant so far as the outer string is concerned.</p>
</div>
<div class="paragraph">
<p>The tag, if any, of a dollar-quoted string follows the same rules as an unquoted identifier, except that it cannot contain a dollar sign. Tags are case sensitive, so <code>$tag$String content$tag$</code> is correct, but <code>$TAG$String content$tag$</code> is not.</p>
</div>
<div class="paragraph">
<p>A dollar-quoted string that follows a keyword or identifier must be separated from it by whitespace; otherwise the dollar quoting delimiter would be taken as part of the preceding identifier.</p>
</div>
<div class="paragraph">
<p>Dollar quoting is not part of the SQL standard, but it is often a more convenient way to write complicated string literals than the standard-compliant single quote syntax. It is particularly useful when representing string constants inside other constants, as is often needed in procedural function definitions. With single-quote syntax, each backslash in the above example would have to be written as four backslashes, which would be reduced to two backslashes in parsing the original string constant, and then to one when the inner string constant is re-parsed during function execution.</p>
</div>
</div>
<div class="sect4">
<h5 id="bit-string-constants"><a class="anchor" href="#bit-string-constants"></a>6.1.2.5. Bit-String Constants</h5>
<div class="paragraph">
<p>Bit-string constants look like regular string constants with a <code>B</code> (upper or lower case) immediately before the opening quote (no intervening whitespace), e.g., <code>B'1001'</code>. The only characters allowed within bit-string constants are <code>0</code> and <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, bit-string constants can be specified in hexadecimal notation, using a leading <code>X</code> (upper or lower case), e.g., <code>X'1FF'</code>. This notation is equivalent to a bit-string constant with four binary digits for each hexadecimal digit.</p>
</div>
<div class="paragraph">
<p>Both forms of bit-string constant can be continued across lines in the same way as regular string constants. Dollar quoting cannot be used in a bit-string constant.</p>
</div>
</div>
<div class="sect4">
<h5 id="numeric-constants"><a class="anchor" href="#numeric-constants"></a>6.1.2.6. Numeric Constants</h5>
<div class="paragraph">
<p>Numeric constants are accepted in these general forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">digits
digits.[digits][e[+-]digits]
[digits].digits[e[+-]digits]
digitse[+-]digits</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>digits</code></strong> is one or more decimal digits (0 through 9). At least one digit must be before or after the decimal point, if one is used. At least one digit must follow the exponent marker (<code>e</code>), if one is present. There cannot be any spaces or other characters embedded in the constant. Note that any leading plus or minus sign is not actually considered part of the constant; it is an operator applied to the constant.</p>
</div>
<div class="paragraph">
<p>These are some examples of valid numeric constants:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>42
3.5
4.
.001
5e2
1.925e-3</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A numeric constant that contains neither a decimal point nor an exponent is initially presumed to be type <code>integer</code> if its value fits in type <code>integer</code> (32 bits); otherwise it is presumed to be type <code>bigint</code> if its value fits in type <code>bigint</code> (64 bits); otherwise it is taken to be type <code>numeric</code>. Constants that contain decimal points and/or exponents are always initially presumed to be type <code>numeric</code>.</p>
</div>
<div class="paragraph">
<p>The initially assigned data type of a numeric constant is just a starting point for the type resolution algorithms. In most cases the constant will be automatically coerced to the most appropriate type depending on context. When necessary, you can force a numeric value to be interpreted as a specific data type by casting it. For example, you can force a numeric value to be treated as type <code>real</code> (<code>float4</code>) by writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">REAL '1.23'  -- string style
1.23::REAL   -- IvorySQL (historical) style</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are actually just special cases of the general casting notations discussed next.</p>
</div>
</div>
<div class="sect4">
<h5 id="constants-of-other-types"><a class="anchor" href="#constants-of-other-types"></a>6.1.2.7. Constants Of Other Types</h5>
<div class="paragraph">
<p>A constant of an <strong>arbitrary</strong> type can be entered using any one of the following notations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">type 'string'
'string'::type
CAST ( 'string' AS type )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The string constant&#8217;s text is passed to the input conversion routine for the type called <strong><code>type</code></strong>. The result is a constant of the indicated type. The explicit type cast can be omitted if there is no ambiguity as to the type the constant must be (for example, when it is assigned directly to a table column), in which case it is automatically coerced.</p>
</div>
<div class="paragraph">
<p>The string constant can be written using either regular SQL notation or dollar-quoting.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify a type coercion using a function-like syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">typename ( 'string' )</code></pre>
</div>
</div>
<div class="paragraph">
<p>but not all type names can be used in this way.</p>
</div>
<div class="paragraph">
<p>The <code>::</code>, <code>CAST()</code>, and function-call syntaxes can also be used to specify run-time type conversions of arbitrary expressions. To avoid syntactic ambiguity, the <code><strong>`type</code></strong> '<strong><code>string</code></strong>'` syntax can only be used to specify the type of a simple literal constant. Another restriction on the <code><strong>`type</code></strong> '<strong><code>string</code></strong>'` syntax is that it does not work for array types; use <code>::</code> or <code>CAST()</code> to specify the type of an array constant.</p>
</div>
<div class="paragraph">
<p>The <code>CAST()</code> syntax conforms to SQL. The <code><strong>`type</code></strong> '<strong><code>string</code></strong>'` syntax is a generalization of the standard: SQL specifies this syntax only for a few data types, but IvorySQL allows it for all types. The syntax with <code>::</code> is historical IvorySQL usage, as is the function-call syntax.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="operators"><a class="anchor" href="#operators"></a>6.1.3. Operators</h4>
<div class="paragraph">
<p>An operator name is a sequence of up to <code>NAMEDATALEN</code>-1 (63 by default) characters from the following list:</p>
</div>
<div class="paragraph">
<p>\+ - * / &lt; &gt; = ~ ! @ # % ^ &amp; | ` ?</p>
</div>
<div class="paragraph">
<p>There are a few restrictions on operator names, however:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--</code> and <code>/*</code> cannot appear anywhere in an operator name, since they will be taken as the start of a comment.</p>
</li>
<li>
<p>A multiple-character operator name cannot end in <code>+</code> or <code>-</code>, unless the name also contains at least one of these characters:</p>
<div class="literalblock">
<div class="content">
<pre>~ ! @ # % ^ &amp; | ` ?</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>@-</code> is an allowed operator name, but <code>*-</code> is not. This restriction allows IvorySQL to parse SQL-compliant queries without requiring spaces between tokens.</p>
</div>
<div class="paragraph">
<p>When working with non-SQL-standard operator names, you will usually need to separate adjacent operators with spaces to avoid ambiguity. For example, if you have defined a prefix operator named <code>@</code>, you cannot write <code>X*@Y</code>; you must write <code>X* @Y</code> to ensure that IvorySQL reads it as two operator names not one.</p>
</div>
</div>
<div class="sect3">
<h4 id="special-characters"><a class="anchor" href="#special-characters"></a>6.1.4. Special Characters</h4>
<div class="paragraph">
<p>Some characters that are not alphanumeric have a special meaning that is different from being an operator. Details on the usage can be found at the location where the respective syntax element is described. This section only exists to advise the existence and summarize the purposes of these characters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dollar sign (<code>$</code>) followed by digits is used to represent a positional parameter in the body of a function definition or a prepared statement. In other contexts the dollar sign can be part of an identifier or a dollar-quoted string constant.</p>
</li>
<li>
<p>Parentheses (<code>()</code>) have their usual meaning to group expressions and enforce precedence. In some cases parentheses are required as part of the fixed syntax of a particular SQL command.</p>
</li>
<li>
<p>Brackets (<code>[]</code>) are used to select the elements of an array.</p>
</li>
<li>
<p>Commas (<code>,</code>) are used in some syntactical constructs to separate the elements of a list.</p>
</li>
<li>
<p>The semicolon (<code>;</code>) terminates an SQL command. It cannot appear anywhere within a command, except within a string constant or quoted identifier.</p>
</li>
<li>
<p>The colon (<code>:</code>) is used to select “slices” from arrays.  In certain SQL dialects (such as Embedded SQL), the colon is used to prefix variable names.</p>
</li>
<li>
<p>The asterisk (<code>*</code>) is used in some contexts to denote all the fields of a table row or composite value. It also has a special meaning when used as the argument of an aggregate function, namely that the aggregate does not require any explicit parameter.</p>
</li>
<li>
<p>The period (<code>.</code>) is used in numeric constants, and to separate schema, table, and column names.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="comments"><a class="anchor" href="#comments"></a>6.1.5. Comments</h4>
<div class="paragraph">
<p>A comment is a sequence of characters beginning with double dashes and extending to the end of the line, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">-- This is a standard SQL comment</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, C-style block comments can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">/* multiline comment
 * with nesting: /* nested block comment */
 */</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the comment begins with <code>/<strong></code> and extends to the matching occurrence of <code></strong>/</code>. These block comments nest, as specified in the SQL standard but unlike C, so that one can comment out larger blocks of code that might contain existing block comments.</p>
</div>
<div class="paragraph">
<p>A comment is removed from the input stream before further syntax analysis and is effectively replaced by whitespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="operator-precedence"><a class="anchor" href="#operator-precedence"></a>6.1.6. Operator Precedence</h4>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-PRECEDENCE-TABLE">Table 5.2</a> shows the precedence and associativity of the operators in IvorySQL. Most operators have the same precedence and are left-associative. The precedence and associativity of the operators is hard-wired into the parser. Add parentheses if you want an expression with multiple operators to be parsed in some other way than what the precedence rules imply.</p>
</div>
<div class="paragraph">
<p><strong>Table 5.2. Operator Precedence (highest to lowest)</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator/Element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associativity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">table/column name separator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>::</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IvorySQL-style typecast</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[</code> <code>]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array element selection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code> <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unary plus, unary minus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exponentiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code> <code>/</code> <code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiplication, division, modulo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code> <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition, subtraction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(any other operator)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all other native and user-defined operators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code> <code>IN</code> <code>LIKE</code> <code>ILIKE</code> <code>SIMILAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">range containment, set membership, string matching</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code> <code>&gt;</code> <code>=</code> <code>&#8656;</code> <code>&gt;=</code> <code>&lt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">comparison operators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code> <code>ISNULL</code> <code>NOTNULL</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS TRUE</code>, <code>IS FALSE</code>, <code>IS NULL</code>, <code>IS DISTINCT FROM</code>, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical negation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical conjunction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical disjunction</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the operator precedence rules also apply to user-defined operators that have the same names as the built-in operators mentioned above. For example, if you define a “” operator for some custom data type it will have the same precedence as the built-in “” operator, no matter what yours does.</p>
</div>
<div class="paragraph">
<p>When a schema-qualified operator name is used in the <code>OPERATOR</code> syntax, as for example in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT 3 OPERATOR(pg_catalog.+) 4;</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>OPERATOR</code> construct is taken to have the default precedence shown in <a href="https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-PRECEDENCE-TABLE">Table 5.2</a> for “any other operator”. This is true no matter which specific operator appears inside <code>OPERATOR()</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>In particular, <code>&#8656;</code> <code>&gt;=</code> and <code>&lt;&gt;</code> used to be treated as generic operators; <code>IS</code> tests used to have higher priority; and <code>NOT BETWEEN</code> and related constructs acted inconsistently, being taken in some cases as having the precedence of <code>NOT</code> rather than <code>BETWEEN</code>. These rules were changed for better compliance with the SQL standard and to reduce confusion from inconsistent treatment of logically equivalent constructs. In most cases, these changes will result in no behavioral change, or perhaps in “no such operator” failures which can be resolved by adding parentheses. However there are corner cases in which a query might change behavior without any parsing error being reported.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="value-expressions"><a class="anchor" href="#value-expressions"></a>6.2. Value Expressions</h3>
<div class="paragraph">
<p>Value expressions are used in a variety of contexts, such as in the target list of the <code>SELECT</code> command, as new column values in <code>INSERT</code> or <code>UPDATE</code>, or in search conditions in a number of commands. The result of a value expression is sometimes called a <strong>scalar</strong>, to distinguish it from the result of a table expression (which is a table). Value expressions are therefore also called <strong>scalar expressions</strong> (or even simply <strong>expressions</strong>). The expression syntax allows the calculation of values from primitive parts using arithmetic, logical, set, and other operations.</p>
</div>
<div class="paragraph">
<p>A value expression is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A constant or literal value</p>
</li>
<li>
<p>A column reference</p>
</li>
<li>
<p>A positional parameter reference, in the body of a function definition or prepared statement</p>
</li>
<li>
<p>A subscripted expression</p>
</li>
<li>
<p>A field selection expression</p>
</li>
<li>
<p>An operator invocation</p>
</li>
<li>
<p>A function call</p>
</li>
<li>
<p>An aggregate expression</p>
</li>
<li>
<p>A window function call</p>
</li>
<li>
<p>A type cast</p>
</li>
<li>
<p>A collation expression</p>
</li>
<li>
<p>A scalar subquery</p>
</li>
<li>
<p>An array constructor</p>
</li>
<li>
<p>A row constructor</p>
</li>
<li>
<p>Another value expression in parentheses (used to group subexpressions and override precedence)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to this list, there are a number of constructs that can be classified as an expression but do not follow any general syntax rules. These generally have the semantics of a function or operator . An example is the <code>IS NULL</code> clause.</p>
</div>
<div class="sect3">
<h4 id="column-references"><a class="anchor" href="#column-references"></a>6.2.1. Column References</h4>
<div class="paragraph">
<p>A column can be referenced in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">correlation.columnname</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>correlation</code></strong> is the name of a table (possibly qualified with a schema name), or an alias for a table defined by means of a <code>FROM</code> clause. The correlation name and separating dot can be omitted if the column name is unique across all the tables being used in the current query.</p>
</div>
</div>
<div class="sect3">
<h4 id="positional-parameters"><a class="anchor" href="#positional-parameters"></a>6.2.2. Positional Parameters</h4>
<div class="paragraph">
<p>A positional parameter reference is used to indicate a value that is supplied externally to an SQL statement. Parameters are used in SQL function definitions and in prepared queries. Some client libraries also support specifying data values separately from the SQL command string, in which case parameters are used to refer to the out-of-line data values. The form of a parameter reference is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">$number</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, consider the definition of a function, <code>dept</code>, as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE FUNCTION dept(text) RETURNS dept
    AS $$ SELECT * FROM dept WHERE name = $1 $$
    LANGUAGE SQL;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the <code>$1</code> references the value of the first function argument whenever the function is invoked.</p>
</div>
</div>
<div class="sect3">
<h4 id="subscripts"><a class="anchor" href="#subscripts"></a>6.2.3. Subscripts</h4>
<div class="paragraph">
<p>If an expression yields a value of an array type, then a specific element of the array value can be extracted by writing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expression[subscript]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or multiple adjacent elements (an “array slice”) can be extracted by writing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expression[lower_subscript:upper_subscript]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Here, the brackets <code>[ ]</code> are meant to appear literally.) Each <strong><code>subscript</code></strong> is itself an expression, which will be rounded to the nearest integer value.</p>
</div>
<div class="paragraph">
<p>In general the array <strong><code>expression</code></strong> must be parenthesized, but the parentheses can be omitted when the expression to be subscripted is just a column reference or positional parameter. Also, multiple subscripts can be concatenated when the original array is multidimensional. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">mytable.arraycolumn[4]
mytable.two_d_column[17][34]
$1[10:42]
(arrayfunction(a,b))[42]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parentheses in the last example are required.</p>
</div>
</div>
<div class="sect3">
<h4 id="field-selection"><a class="anchor" href="#field-selection"></a>6.2.4. Field Selection</h4>
<div class="paragraph">
<p>If an expression yields a value of a composite type (row type), then a specific field of the row can be extracted by writing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expression.fieldname</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general the row <strong><code>expression</code></strong> must be parenthesized, but the parentheses can be omitted when the expression to be selected from is just a table reference or positional parameter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">mytable.mycolumn
$1.somecolumn
(rowfunction(a,b)).col3</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Thus, a qualified column reference is actually just a special case of the field selection syntax.) An important special case is extracting a field from a table column that is of a composite type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">(compositecol).somefield
(mytable.compositecol).somefield</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parentheses are required here to show that <code>compositecol</code> is a column name not a table name, or that <code>mytable</code> is a table name not a schema name in the second case.</p>
</div>
<div class="paragraph">
<p>You can ask for all fields of a composite value by writing <code>.*</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">(compositecol).*</code></pre>
</div>
</div>
<div class="paragraph">
<p>This notation behaves differently depending on context.</p>
</div>
</div>
<div class="sect3">
<h4 id="operator-invocations"><a class="anchor" href="#operator-invocations"></a>6.2.5. Operator Invocations</h4>
<div class="paragraph">
<p>There are two possible syntaxes for an operator invocation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>expression</code></strong> <strong><code>operator</code></strong> <strong><code>expression</code></strong> (binary infix operator)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>operator</code></strong> <strong><code>expression</code></strong> (unary prefix operator)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>where the <strong><code>operator</code></strong> token follows the syntax rules , or is one of the key words <code>AND</code>, <code>OR</code>, and <code>NOT</code>, or is a qualified operator name in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">OPERATOR(schema.operatorname)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which particular operators exist and whether they are unary or binary depends on what operators have been defined by the system or the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="function-calls"><a class="anchor" href="#function-calls"></a>6.2.6. Function Calls</h4>
<div class="paragraph">
<p>The syntax for a function call is the name of a function (possibly qualified with a schema name), followed by its argument list enclosed in parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">function_name ([expression [, expression ... ]] )</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following computes the square root of 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">sqrt(2)</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Other functions can be added by the user.</pre>
</div>
</div>
<div class="paragraph">
<p>When issuing queries in a database where some users mistrust other users,</p>
</div>
<div class="paragraph">
<p>The arguments can optionally have names attached.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>A function that takes a single argument of composite type can optionally be called using field-selection syntax, and conversely field selection can be written in functional style. That is, the notations <code>col(table)</code> and <code>table.col</code> are interchangeable. This behavior is not SQL-standard but is provided in IvorySQL because it allows use of functions to emulate “computed fields”.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aggregate-expressions"><a class="anchor" href="#aggregate-expressions"></a>6.2.7. Aggregate Expressions</h4>
<div class="paragraph">
<p>An <strong>aggregate expression</strong> represents the application of an aggregate function across the rows selected by a query. An aggregate function reduces multiple inputs to a single output value, such as the sum or average of the inputs. The syntax of an aggregate expression is one of the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">aggregate_name (expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name (ALL expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name (DISTINCT expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name ( * ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name ( [ expression [ , ... ] ] ) WITHIN GROUP ( order_by_clause ) [ FILTER ( WHERE filter_clause ) ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>aggregate_name</code></strong> is a previously defined aggregate (possibly qualified with a schema name) and <strong><code>expression</code></strong> is any value expression that does not itself contain an aggregate expression or a window function call. The optional <strong><code>order_by_clause</code></strong> and <strong><code>filter_clause</code></strong> are described below.</p>
</div>
<div class="paragraph">
<p>The first form of aggregate expression invokes the aggregate once for each input row. The second form is the same as the first, since <code>ALL</code> is the default. The third form invokes the aggregate once for each distinct value of the expression (or distinct set of values, for multiple expressions) found in the input rows. The fourth form invokes the aggregate once for each input row; since no particular input value is specified, it is generally only useful for the <code>count(<strong>)</code> aggregate function. The last form is used with *ordered-set</strong> aggregate functions, which are described below.</p>
</div>
<div class="paragraph">
<p>Most aggregate functions ignore null inputs, so that rows in which one or more of the expression(s) yield null are discarded. This can be assumed to be true, unless otherwise specified, for all built-in aggregates.</p>
</div>
<div class="paragraph">
<p>For example, <code>count(*)</code> yields the total number of input rows; <code>count(f1)</code> yields the number of input rows in which <code>f1</code> is non-null, since <code>count</code> ignores nulls; and <code>count(distinct f1)</code> yields the number of distinct non-null values of <code>f1</code>.</p>
</div>
<div class="paragraph">
<p>Ordinarily, the input rows are fed to the aggregate function in an unspecified order. In many cases this does not matter; for example, <code>min</code> produces the same result no matter what order it receives the inputs in. However, some aggregate functions (such as <code>array_agg</code> and <code>string_agg</code>) produce results that depend on the ordering of the input rows. When using such an aggregate, the optional <strong><code>order_by_clause</code></strong> can be used to specify the desired ordering. The <strong><code>order_by_clause</code></strong> has the same syntax as for a query-level <code>ORDER BY</code> clause,  except that its expressions are always just expressions and cannot be output-column names or numbers. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT array_agg(a ORDER BY b DESC) FROM table;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When dealing with multiple-argument aggregate functions, note that the <code>ORDER BY</code> clause goes after all the aggregate arguments. For example, write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT string_agg(a, ',' ORDER BY a) FROM table;</code></pre>
</div>
</div>
<div class="paragraph">
<p>not this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT string_agg(a ORDER BY a, ',') FROM table;  -- incorrect</code></pre>
</div>
</div>
<div class="paragraph">
<p>The latter is syntactically valid, but it represents a call of a single-argument aggregate function with two <code>ORDER BY</code> keys (the second one being rather useless since it&#8217;s a constant).</p>
</div>
<div class="paragraph">
<p>If <code>DISTINCT</code> is specified in addition to an <strong><code>order_by_clause</code></strong>, then all the <code>ORDER BY</code> expressions must match regular arguments of the aggregate; that is, you cannot sort on an expression that is not included in the <code>DISTINCT</code> list.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The ability to specify both <code>DISTINCT</code> and <code>ORDER BY</code> in an aggregate function is a IvorySQL extension.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Placing <code>ORDER BY</code> within the aggregate&#8217;s regular argument list, as described so far, is used when ordering the input rows for general-purpose and statistical aggregates, for which ordering is optional. There is a subclass of aggregate functions called <strong>ordered-set aggregates</strong> for which an <strong><code>order_by_clause</code></strong> is <strong>required</strong>, usually because the aggregate&#8217;s computation is only sensible in terms of a specific ordering of its input rows. Typical examples of ordered-set aggregates include rank and percentile calculations. For an ordered-set aggregate, the <strong><code>order_by_clause</code></strong> is written inside <code>WITHIN GROUP (&#8230;&#8203;)</code>, as shown in the final syntax alternative above. The expressions in the <strong><code>order_by_clause</code></strong> are evaluated once per input row just like regular aggregate arguments, sorted as per the <strong><code>order_by_clause</code></strong>'s requirements, and fed to the aggregate function as input arguments. (This is unlike the case for a non-<code>WITHIN GROUP</code> <strong><code>order_by_clause</code></strong>, which is not treated as argument(s) to the aggregate function.) The argument expressions preceding <code>WITHIN GROUP</code>, if any, are called <strong>direct arguments</strong> to distinguish them from the <strong>aggregated arguments</strong> listed in the <strong><code>order_by_clause</code></strong>. Unlike regular aggregate arguments, direct arguments are evaluated only once per aggregate call, not once per input row. This means that they can contain variables only if those variables are grouped by <code>GROUP BY</code>; this restriction is the same as if the direct arguments were not inside an aggregate expression at all. Direct arguments are typically used for things like percentile fractions, which only make sense as a single value per aggregation calculation. The direct argument list can be empty; in this case, write just <code>()</code> not <code>(*)</code>. (IvorySQL will actually accept either spelling, but only the first way conforms to the SQL standard.)</p>
</div>
<div class="paragraph">
<p>An example of an ordered-set aggregate call is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT percentile_cont(0.5) WITHIN GROUP (ORDER BY income) FROM households;
 percentile_cont
-----------------
           50489</code></pre>
</div>
</div>
<div class="paragraph">
<p>which obtains the 50th percentile, or median, value of the <code>income</code> column from table <code>households</code>. Here, <code>0.5</code> is a direct argument; it would make no sense for the percentile fraction to be a value varying across rows.</p>
</div>
<div class="paragraph">
<p>If <code>FILTER</code> is specified, then only the input rows for which the <strong><code>filter_clause</code></strong> evaluates to true are fed to the aggregate function; other rows are discarded. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT
    count(*) AS unfiltered,
    count(*) FILTER (WHERE i &lt; 5) AS filtered
FROM generate_series(1,10) AS s(i);
 unfiltered | filtered
------------+----------
         10 |        4
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other aggregate functions can be added by the user.</p>
</div>
<div class="paragraph">
<p>An aggregate expression can only appear in the result list or <code>HAVING</code> clause of a <code>SELECT</code> command. It is forbidden in other clauses, such as <code>WHERE</code>, because those clauses are logically evaluated before the results of aggregates are formed.</p>
</div>
<div class="paragraph">
<p>When an aggregate expression appears in a subquery,the aggregate is normally evaluated over the rows of the subquery. But an exception occurs if the aggregate&#8217;s arguments (and <strong><code>filter_clause</code></strong> if any) contain only outer-level variables: the aggregate then belongs to the nearest such outer level, and is evaluated over the rows of that query. The aggregate expression as a whole is then an outer reference for the subquery it appears in, and acts as a constant over any one evaluation of that subquery. The restriction about appearing only in the result list or <code>HAVING</code> clause applies with respect to the query level that the aggregate belongs to.</p>
</div>
</div>
<div class="sect3">
<h4 id="window-function-calls"><a class="anchor" href="#window-function-calls"></a>6.2.8. Window Function Calls</h4>
<div class="paragraph">
<p>A <strong>window function call</strong> represents the application of an aggregate-like function over some portion of the rows selected by a query. Unlike non-window aggregate calls, this is not tied to grouping of the selected rows into a single output row — each row remains separate in the query output. However the window function has access to all the rows that would be part of the current row&#8217;s group according to the grouping specification (<code>PARTITION BY</code> list) of the window function call. The syntax of a window function call is one of the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">function_name ([expression [, expression ... ]]) [ FILTER ( WHERE filter_clause ) ] OVER window_name
function_name ([expression [, expression ... ]]) [ FILTER ( WHERE filter_clause ) ] OVER ( window_definition )
function_name ( * ) [ FILTER ( WHERE filter_clause ) ] OVER window_name
function_name ( * ) [ FILTER ( WHERE filter_clause ) ] OVER ( window_definition )</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>window_definition</code></strong> has the syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">[ existing_window_name ]
[ PARTITION BY expression [, ...] ]
[ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]
[ frame_clause ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional <strong><code>frame_clause</code></strong> can be one of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">{ RANGE | ROWS | GROUPS } frame_start [ frame_exclusion ]
{ RANGE | ROWS | GROUPS } BETWEEN frame_start AND frame_end [ frame_exclusion ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>frame_start</code></strong> and <strong><code>frame_end</code></strong> can be one of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">UNBOUNDED PRECEDING
offset PRECEDING
CURRENT ROW
offset FOLLOWING
UNBOUNDED FOLLOWING</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <strong><code>frame_exclusion</code></strong> can be one of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">EXCLUDE CURRENT ROW
EXCLUDE GROUP
EXCLUDE TIES
EXCLUDE NO OTHERS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <strong><code>expression</code></strong> represents any value expression that does not itself contain window function calls.</p>
</div>
<div class="paragraph">
<p><strong><code>window_name</code></strong> is a reference to a named window specification defined in the query&#8217;s <code>WINDOW</code> clause. Alternatively, a full <strong><code>window_definition</code></strong> can be given within parentheses, using the same syntax as for defining a named window in the <code>WINDOW</code> clause; see the <a href="https://www.postgresql.org/docs/current/sql-select.html">SELECT</a> reference page for details. It&#8217;s worth pointing out that <code>OVER wname</code> is not exactly equivalent to <code>OVER (wname &#8230;&#8203;)</code>; the latter implies copying and modifying the window definition, and will be rejected if the referenced window specification includes a frame clause.</p>
</div>
<div class="paragraph">
<p>The <code>PARTITION BY</code> clause groups the rows of the query into <strong>partitions</strong>, which are processed separately by the window function. <code>PARTITION BY</code> works similarly to a query-level <code>GROUP BY</code> clause, except that its expressions are always just expressions and cannot be output-column names or numbers. Without <code>PARTITION BY</code>, all rows produced by the query are treated as a single partition. The <code>ORDER BY</code> clause determines the order in which the rows of a partition are processed by the window function. It works similarly to a query-level <code>ORDER BY</code> clause, but likewise cannot use output-column names or numbers. Without <code>ORDER BY</code>, rows are processed in an unspecified order.</p>
</div>
<div class="paragraph">
<p>The <strong><code>frame_clause</code></strong> specifies the set of rows constituting the <strong>window frame</strong>, which is a subset of the current partition, for those window functions that act on the frame instead of the whole partition. The set of rows in the frame can vary depending on which row is the current row. The frame can be specified in <code>RANGE</code>, <code>ROWS</code> or <code>GROUPS</code> mode; in each case, it runs from the <strong><code>frame_start</code></strong> to the <strong><code>frame_end</code></strong>. If <strong><code>frame_end</code></strong> is omitted, the end defaults to <code>CURRENT ROW</code>.</p>
</div>
<div class="paragraph">
<p>A <strong><code>frame_start</code></strong> of <code>UNBOUNDED PRECEDING</code> means that the frame starts with the first row of the partition, and similarly a <strong><code>frame_end</code></strong> of <code>UNBOUNDED FOLLOWING</code> means that the frame ends with the last row of the partition.</p>
</div>
<div class="paragraph">
<p>In <code>RANGE</code> or <code>GROUPS</code> mode, a <strong><code>frame_start</code></strong> of <code>CURRENT ROW</code> means the frame starts with the current row&#8217;s first <strong>peer</strong> row (a row that the window&#8217;s <code>ORDER BY</code> clause sorts as equivalent to the current row), while a <strong><code>frame_end</code></strong> of <code>CURRENT ROW</code> means the frame ends with the current row&#8217;s last peer row. In <code>ROWS</code> mode, <code>CURRENT ROW</code> simply means the current row.</p>
</div>
<div class="paragraph">
<p>In the <strong><code>offset</code></strong> <code>PRECEDING</code> and <strong><code>offset</code></strong> <code>FOLLOWING</code> frame options, the <strong><code>offset</code></strong> must be an expression not containing any variables, aggregate functions, or window functions. The meaning of the <strong><code>offset</code></strong> depends on the frame mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <code>ROWS</code> mode, the <strong><code>offset</code></strong> must yield a non-null, non-negative integer, and the option means that the frame starts or ends the specified number of rows before or after the current row.</p>
</li>
<li>
<p>In <code>GROUPS</code> mode, the <strong><code>offset</code></strong> again must yield a non-null, non-negative integer, and the option means that the frame starts or ends the specified number of <strong>peer groups</strong> before or after the current row&#8217;s peer group, where a peer group is a set of rows that are equivalent in the <code>ORDER BY</code> ordering. (There must be an <code>ORDER BY</code> clause in the window definition to use <code>GROUPS</code> mode.)</p>
</li>
<li>
<p>In <code>RANGE</code> mode, these options require that the <code>ORDER BY</code> clause specify exactly one column. The <strong><code>offset</code></strong> specifies the maximum difference between the value of that column in the current row and its value in preceding or following rows of the frame. The data type of the <strong><code>offset</code></strong> expression varies depending on the data type of the ordering column. For numeric ordering columns it is typically of the same type as the ordering column, but for datetime ordering columns it is an <code>interval</code>. For example, if the ordering column is of type <code>date</code> or <code>timestamp</code>, one could write <code>RANGE BETWEEN '1 day' PRECEDING AND '10 days' FOLLOWING</code>. The <strong><code>offset</code></strong> is still required to be non-null and non-negative, though the meaning of “non-negative” depends on its data type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In any case, the distance to the end of the frame is limited by the distance to the end of the partition, so that for rows near the partition ends the frame might contain fewer rows than elsewhere.</p>
</div>
<div class="paragraph">
<p>Notice that in both <code>ROWS</code> and <code>GROUPS</code> mode, <code>0 PRECEDING</code> and <code>0 FOLLOWING</code> are equivalent to <code>CURRENT ROW</code>. This normally holds in <code>RANGE</code> mode as well, for an appropriate data-type-specific meaning of “zero”.</p>
</div>
<div class="paragraph">
<p>The <strong><code>frame_exclusion</code></strong> option allows rows around the current row to be excluded from the frame, even if they would be included according to the frame start and frame end options. <code>EXCLUDE CURRENT ROW</code> excludes the current row from the frame. <code>EXCLUDE GROUP</code> excludes the current row and its ordering peers from the frame. <code>EXCLUDE TIES</code> excludes any peers of the current row from the frame, but not the current row itself. <code>EXCLUDE NO OTHERS</code> simply specifies explicitly the default behavior of not excluding the current row or its peers.</p>
</div>
<div class="paragraph">
<p>The default framing option is <code>RANGE UNBOUNDED PRECEDING</code>, which is the same as <code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>. With <code>ORDER BY</code>, this sets the frame to be all rows from the partition start up through the current row&#8217;s last <code>ORDER BY</code> peer. Without <code>ORDER BY</code>, this means all rows of the partition are included in the window frame, since all rows become peers of the current row.</p>
</div>
<div class="paragraph">
<p>Restrictions are that <strong><code>frame_start</code></strong> cannot be <code>UNBOUNDED FOLLOWING</code>, <strong><code>frame_end</code></strong> cannot be <code>UNBOUNDED PRECEDING</code>, and the <strong><code>frame_end</code></strong> choice cannot appear earlier in the above list of <strong><code>frame_start</code></strong> and <strong><code>frame_end</code></strong> options than the <strong><code>frame_start</code></strong> choice does — for example <code>RANGE BETWEEN CURRENT ROW AND <strong>`offset</code></strong> PRECEDING` is not allowed. But, for example, <code>ROWS BETWEEN 7 PRECEDING AND 8 PRECEDING</code> is allowed, even though it would never select any rows.</p>
</div>
<div class="paragraph">
<p>If <code>FILTER</code> is specified, then only the input rows for which the <strong><code>filter_clause</code></strong> evaluates to true are fed to the window function; other rows are discarded. Only window functions that are aggregates accept a <code>FILTER</code> clause.</p>
</div>
<div class="paragraph">
<p>Other window functions can be added by the user. Also, any built-in or user-defined general-purpose or statistical aggregate can be used as a window function. (Ordered-set and hypothetical-set aggregates cannot presently be used as window functions.)</p>
</div>
<div class="paragraph">
<p>The syntaxes using <code><strong></code> are used for calling parameter-less aggregate functions as window functions, for example <code>count(</strong>) OVER (PARTITION BY x ORDER BY y)</code>. The asterisk (<code>*</code>) is customarily not used for window-specific functions. Window-specific functions do not allow <code>DISTINCT</code> or <code>ORDER BY</code> to be used within the function argument list.</p>
</div>
<div class="paragraph">
<p>Window function calls are permitted only in the <code>SELECT</code> list and the <code>ORDER BY</code> clause of the query.</p>
</div>
</div>
<div class="sect3">
<h4 id="type-casts"><a class="anchor" href="#type-casts"></a>6.2.9. Type Casts</h4>
<div class="paragraph">
<p>A type cast specifies a conversion from one data type to another. IvorySQL accepts two equivalent syntaxes for type casts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CAST ( expression AS type )
expression::type</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CAST</code> syntax conforms to SQL; the syntax with <code>::</code> is historical IvorySQL usage.</p>
</div>
<div class="paragraph">
<p>When a cast is applied to a value expression of a known type, it represents a run-time type conversion. The cast will succeed only if a suitable type conversion operation has been defined. Notice that this is subtly different from the use of casts with constants. A cast applied to an unadorned string literal represents the initial assignment of a type to a literal constant value, and so it will succeed for any type (if the contents of the string literal are acceptable input syntax for the data type).</p>
</div>
<div class="paragraph">
<p>An explicit type cast can usually be omitted if there is no ambiguity as to the type that a value expression must produce (for example, when it is assigned to a table column); the system will automatically apply a type cast in such cases. However, automatic casting is only done for casts that are marked “OK to apply implicitly” in the system catalogs. Other casts must be invoked with explicit casting syntax. This restriction is intended to prevent surprising conversions from being applied silently.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify a type cast using a function-like syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">typename ( expression )</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this only works for types whose names are also valid as function names. For example, <code>double precision</code> cannot be used this way, but the equivalent <code>float8</code> can. Also, the names <code>interval</code>, <code>time</code>, and <code>timestamp</code> can only be used in this fashion if they are double-quoted, because of syntactic conflicts. Therefore, the use of the function-like cast syntax leads to inconsistencies and should probably be avoided.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The function-like syntax is in fact just a function call. When one of the two standard cast syntaxes is used to do a run-time conversion, it will internally invoke a registered function to perform the conversion. By convention, these conversion functions have the same name as their output type, and thus the “function-like syntax” is nothing more than a direct invocation of the underlying conversion function. Obviously, this is not something that a portable application should rely on. For further details see <a href="https://www.postgresql.org/docs/current/sql-createcast.html">CREATE CAST</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collation-expressions"><a class="anchor" href="#collation-expressions"></a>6.2.10. Collation Expressions</h4>
<div class="paragraph">
<p>The <code>COLLATE</code> clause overrides the collation of an expression. It is appended to the expression it applies to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expr COLLATE collation</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <strong><code>collation</code></strong> is a possibly schema-qualified identifier. The <code>COLLATE</code> clause binds tighter than operators; parentheses can be used when necessary.</p>
</div>
<div class="paragraph">
<p>If no collation is explicitly specified, the database system either derives a collation from the columns involved in the expression, or it defaults to the default collation of the database if no column is involved in the expression.</p>
</div>
<div class="paragraph">
<p>The two common uses of the <code>COLLATE</code> clause are overriding the sort order in an <code>ORDER BY</code> clause, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT a, b, c FROM tbl WHERE ... ORDER BY a COLLATE "C";</code></pre>
</div>
</div>
<div class="paragraph">
<p>and overriding the collation of a function or operator call that has locale-sensitive results, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT * FROM tbl WHERE a &gt; 'foo' COLLATE "C";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the latter case the <code>COLLATE</code> clause is attached to an input argument of the operator we wish to affect. It doesn&#8217;t matter which argument of the operator or function call the <code>COLLATE</code> clause is attached to, because the collation that is applied by the operator or function is derived by considering all arguments, and an explicit <code>COLLATE</code> clause will override the collations of all other arguments. (Attaching non-matching <code>COLLATE</code> clauses to more than one argument, however, is an error.) Thus, this gives the same result as the previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT * FROM tbl WHERE a COLLATE "C" &gt; 'foo';</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this is an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT * FROM tbl WHERE (a &gt; 'foo') COLLATE "C";</code></pre>
</div>
</div>
<div class="paragraph">
<p>because it attempts to apply a collation to the result of the <code>&gt;</code> operator, which is of the non-collatable data type <code>boolean</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="scalar-subqueries"><a class="anchor" href="#scalar-subqueries"></a>6.2.11. Scalar Subqueries</h4>
<div class="paragraph">
<p>A scalar subquery is an ordinary <code>SELECT</code> query in parentheses that returns exactly one row with one column. The <code>SELECT</code> query is executed and the single returned value is used in the surrounding value expression. It is an error to use a query that returns more than one row or more than one column as a scalar subquery. (But if, during a particular execution, the subquery returns no rows, there is no error; the scalar result is taken to be null.) The subquery can refer to variables from the surrounding query, which will act as constants during any one evaluation of the subquery.</p>
</div>
<div class="paragraph">
<p>For example, the following finds the largest city population in each state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT name, (SELECT max(pop) FROM cities WHERE cities.state = states.name)
    FROM states;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="array-constructors"><a class="anchor" href="#array-constructors"></a>6.2.12. Array Constructors</h4>
<div class="paragraph">
<p>An array constructor is an expression that builds an array value using values for its member elements. A simple array constructor consists of the key word <code>ARRAY</code>, a left square bracket <code>[</code>, a list of expressions (separated by commas) for the array element values, and finally a right square bracket <code>]</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ARRAY[1,2,3+4];
  array
---------
 {1,2,7}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the array element type is the common type of the member expressions, determined using the same rules as for <code>UNION</code> or <code>CASE</code> constructs. You can override this by explicitly casting the array constructor to the desired type, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ARRAY[1,2,22.7]::integer[];
  array
----------
 {1,2,23}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This has the same effect as casting each expression to the array element type individually.</p>
</div>
<div class="paragraph">
<p>Multidimensional array values can be built by nesting array constructors. In the inner constructors, the key word <code>ARRAY</code> can be omitted. For example, these produce the same result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ARRAY[ARRAY[1,2], ARRAY[3,4]];
     array
---------------
 {{1,2},{3,4}}
(1 row)

SELECT ARRAY[[1,2],[3,4]];
     array
---------------
 {{1,2},{3,4}}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since multidimensional arrays must be rectangular, inner constructors at the same level must produce sub-arrays of identical dimensions. Any cast applied to the outer <code>ARRAY</code> constructor propagates automatically to all the inner constructors.</p>
</div>
<div class="paragraph">
<p>Multidimensional array constructor elements can be anything yielding an array of the proper kind, not only a sub-<code>ARRAY</code> construct. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE TABLE arr(f1 int[], f2 int[]);

INSERT INTO arr VALUES (ARRAY[[1,2],[3,4]], ARRAY[[5,6],[7,8]]);

SELECT ARRAY[f1, f2, '{{9,10},{11,12}}'::int[]] FROM arr;
                     array
------------------------------------------------
 {{{1,2},{3,4}},{{5,6},{7,8}},{{9,10},{11,12}}}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can construct an empty array, but since it&#8217;s impossible to have an array with no type, you must explicitly cast your empty array to the desired type. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ARRAY[]::integer[];
 array
-------
 {}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to construct an array from the results of a subquery. In this form, the array constructor is written with the key word <code>ARRAY</code> followed by a parenthesized (not bracketed) subquery. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ARRAY(SELECT oid FROM pg_proc WHERE proname LIKE 'bytea%');
                              array
------------------------------------------------------------------
 {2011,1954,1948,1952,1951,1244,1950,2005,1949,1953,2006,31,2412}
(1 row)

SELECT ARRAY(SELECT ARRAY[i, i*2] FROM generate_series(1,5) AS a(i));
              array
----------------------------------
 {{1,2},{2,4},{3,6},{4,8},{5,10}}
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subquery must return a single column. If the subquery&#8217;s output column is of a non-array type, the resulting one-dimensional array will have an element for each row in the subquery result, with an element type matching that of the subquery&#8217;s output column. If the subquery&#8217;s output column is of an array type, the result will be an array of the same type but one higher dimension; in this case all the subquery rows must yield arrays of identical dimensionality, else the result would not be rectangular.</p>
</div>
<div class="paragraph">
<p>The subscripts of an array value built with <code>ARRAY</code> always begin with one.</p>
</div>
</div>
<div class="sect3">
<h4 id="row-constructors"><a class="anchor" href="#row-constructors"></a>6.2.13. Row Constructors</h4>
<div class="paragraph">
<p>A row constructor is an expression that builds a row value (also called a composite value) using values for its member fields. A row constructor consists of the key word <code>ROW</code>, a left parenthesis, zero or more expressions (separated by commas) for the row field values, and finally a right parenthesis. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ROW(1,2.5,'this is a test');</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key word <code>ROW</code> is optional when there is more than one expression in the list.</p>
</div>
<div class="paragraph">
<p>A row constructor can include the syntax <strong><code>rowvalue</code></strong><code>.<strong></code>, which will be expanded to a list of the elements of the row value, just as occurs when the <code>.</strong></code> syntax is used at the top level of a <code>SELECT</code> list .For example, if table <code>t</code> has columns <code>f1</code> and <code>f2</code>, these are the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ROW(t.*, 42) FROM t;
SELECT ROW(t.f1, t.f2, 42) FROM t;</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Before IvorySQL 8.2, the <code>.<strong></code> syntax was not expanded in row constructors, so that writing <code>ROW(t.</strong>, 42)</code> created a two-field row whose first field was another row value. The new behavior is usually more useful. If you need the old behavior of nested row values, write the inner row value without <code>.*</code>, for instance <code>ROW(t, 42)</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, the value created by a <code>ROW</code> expression is of an anonymous record type. If necessary, it can be cast to a named composite type — either the row type of a table, or a composite type created with <code>CREATE TYPE AS</code>. An explicit cast might be needed to avoid ambiguity. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE TABLE mytable(f1 int, f2 float, f3 text);

CREATE FUNCTION getf1(mytable) RETURNS int AS 'SELECT $1.f1' LANGUAGE SQL;

-- No cast needed since only one getf1() exists
SELECT getf1(ROW(1,2.5,'this is a test'));
 getf1
-------
     1
(1 row)

CREATE TYPE myrowtype AS (f1 int, f2 text, f3 numeric);

CREATE FUNCTION getf1(myrowtype) RETURNS int AS 'SELECT $1.f1' LANGUAGE SQL;

-- Now we need a cast to indicate which function to call:
SELECT getf1(ROW(1,2.5,'this is a test'));
ERROR:  function getf1(record) is not unique

SELECT getf1(ROW(1,2.5,'this is a test')::mytable);
 getf1
-------
     1
(1 row)

SELECT getf1(CAST(ROW(11,'this is a test',2.5) AS myrowtype));
 getf1
-------
    11
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row constructors can be used to build composite values to be stored in a composite-type table column, or to be passed to a function that accepts a composite parameter. Also, it is possible to compare two row values or test a row with <code>IS NULL</code> or <code>IS NOT NULL</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ROW(1,2.5,'this is a test') = ROW(1, 3, 'not the same');

SELECT ROW(table.*) IS NULL FROM table;  -- detect all-null rows</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expression-evaluation-rules"><a class="anchor" href="#expression-evaluation-rules"></a>6.2.14. Expression Evaluation Rules</h4>
<div class="paragraph">
<p>The order of evaluation of subexpressions is not defined. In particular, the inputs of an operator or function are not necessarily evaluated left-to-right or in any other fixed order.</p>
</div>
<div class="paragraph">
<p>Furthermore, if the result of an expression can be determined by evaluating only some parts of it, then other subexpressions might not be evaluated at all. For instance, if one wrote:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT true OR somefunc();</code></pre>
</div>
</div>
<div class="paragraph">
<p>then <code>somefunc()</code> would (probably) not be called at all. The same would be the case if one wrote:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT somefunc() OR true;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is not the same as the left-to-right “short-circuiting” of Boolean operators that is found in some programming languages.</p>
</div>
<div class="paragraph">
<p>As a consequence, it is unwise to use functions with side effects as part of complex expressions. It is particularly dangerous to rely on side effects or evaluation order in <code>WHERE</code> and <code>HAVING</code> clauses, since those clauses are extensively reprocessed as part of developing an execution plan. Boolean expressions (<code>AND</code>/<code>OR</code>/<code>NOT</code> combinations) in those clauses can be reorganized in any manner allowed by the laws of Boolean algebra.</p>
</div>
<div class="paragraph">
<p>When it is essential to force evaluation order, a <code>CASE</code> construct can be used. For example, this is an untrustworthy way of trying to avoid division by zero in a <code>WHERE</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ... WHERE x &gt; 0 AND y/x &gt; 1.5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this is safe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT ... WHERE CASE WHEN x &gt; 0 THEN y/x &gt; 1.5 ELSE false END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>CASE</code> construct used in this fashion will defeat optimization attempts, so it should only be done when necessary. (In this particular example, it would be better to sidestep the problem by writing <code>y &gt; 1.5*x</code> instead.)</p>
</div>
<div class="paragraph">
<p><code>CASE</code> is not a cure-all for such issues, however. One limitation of the technique illustrated above is that it does not prevent early evaluation of constant subexpressions. As described in <a href="https://www.postgresql.org/docs/current/xfunc-volatility.html">Section 38.7</a>, functions and operators marked <code>IMMUTABLE</code> can be evaluated when the query is planned rather than when it is executed. Thus for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT CASE WHEN x &gt; 0 THEN x ELSE 1/0 END FROM tab;</code></pre>
</div>
</div>
<div class="paragraph">
<p>is likely to result in a division-by-zero failure due to the planner trying to simplify the constant subexpression, even if every row in the table has <code>x &gt; 0</code> so that the <code>ELSE</code> arm would never be entered at run time.</p>
</div>
<div class="paragraph">
<p>While that particular example might seem silly, related cases that don&#8217;t obviously involve constants can occur in queries executed within functions, since the values of function arguments and local variables can be inserted into queries as constants for planning purposes. Within PL/pgSQL functions, for example, using an <code>IF</code>-<code>THEN</code>-<code>ELSE</code> statement to protect a risky computation is much safer than just nesting it in a <code>CASE</code> expression.</p>
</div>
<div class="paragraph">
<p>Another limitation of the same kind is that a <code>CASE</code> cannot prevent evaluation of an aggregate expression contained within it, because aggregate expressions are computed before other expressions in a <code>SELECT</code> list or <code>HAVING</code> clause are considered. For example, the following query can cause a division-by-zero error despite seemingly having protected against it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT CASE WHEN min(employees) &gt; 0
            THEN avg(expenses / employees)
       END
    FROM departments;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>min()</code> and <code>avg()</code> aggregates are computed concurrently over all the input rows, so if any row has <code>employees</code> equal to zero, the division-by-zero error will occur before there is any opportunity to test the result of <code>min()</code>. Instead, use a <code>WHERE</code> or <code>FILTER</code> clause to prevent problematic input rows from reaching an aggregate function in the first place.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="calling-functions"><a class="anchor" href="#calling-functions"></a>6.3. Calling Functions</h3>
<div class="paragraph">
<p>IvorySQL allows functions that have named parameters to be called using either <strong>positional</strong> or <strong>named</strong> notation. Named notation is especially useful for functions that have a large number of parameters, since it makes the associations between parameters and actual arguments more explicit and reliable. In positional notation, a function call is written with its argument values in the same order as they are defined in the function declaration. In named notation, the arguments are matched to the function parameters by name and can be written in any order.</p>
</div>
<div class="paragraph">
<p>In either notation, parameters that have default values given in the function declaration need not be written in the call at all. But this is particularly useful in named notation, since any combination of parameters can be omitted; while in positional notation parameters can only be omitted from right to left.</p>
</div>
<div class="paragraph">
<p>IvorySQL also supports <strong>mixed</strong> notation, which combines positional and named notation. In this case, positional parameters are written first and named parameters appear after them.</p>
</div>
<div class="paragraph">
<p>The following examples will illustrate the usage of all three notations, using the following function definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">CREATE FUNCTION concat_lower_or_upper(a text, b text, uppercase boolean DEFAULT false)
RETURNS text
AS
$$
 SELECT CASE
        WHEN $3 THEN UPPER($1 || ' ' || $2)
        ELSE LOWER($1 || ' ' || $2)
        END;
$$
LANGUAGE SQL IMMUTABLE STRICT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function <code>concat_lower_or_upper</code> has two mandatory parameters, <code>a</code> and <code>b</code>. Additionally there is one optional parameter <code>uppercase</code> which defaults to <code>false</code>. The <code>a</code> and <code>b</code> inputs will be concatenated, and forced to either upper or lower case depending on the <code>uppercase</code> parameter. The remaining details of this function definition are not important here .</p>
</div>
<div class="sect3">
<h4 id="using-positional-notation"><a class="anchor" href="#using-positional-notation"></a>6.3.1. Using Positional Notation</h4>
<div class="paragraph">
<p>Positional notation is the traditional mechanism for passing arguments to functions in IvorySQL. An example is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper('Hello', 'World', true);
 concat_lower_or_upper
-----------------------
 HELLO WORLD
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>All arguments are specified in order. The result is upper case since <code>uppercase</code> is specified as <code>true</code>. Another example is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper('Hello', 'World');
 concat_lower_or_upper
-----------------------
 hello world
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>uppercase</code> parameter is omitted, so it receives its default value of <code>false</code>, resulting in lower case output. In positional notation, arguments can be omitted from right to left so long as they have defaults.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-named-notation"><a class="anchor" href="#using-named-notation"></a>6.3.2. Using Named Notation</h4>
<div class="paragraph">
<p>In named notation, each argument&#8217;s name is specified using <code>&#8658;</code> to separate it from the argument expression. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper(a =&gt; 'Hello', b =&gt; 'World');
 concat_lower_or_upper
-----------------------
 hello world
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the argument <code>uppercase</code> was omitted so it is set to <code>false</code> implicitly. One advantage of using named notation is that the arguments may be specified in any order, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper(a =&gt; 'Hello', b =&gt; 'World', uppercase =&gt; true);
 concat_lower_or_upper
-----------------------
 HELLO WORLD
(1 row)

SELECT concat_lower_or_upper(a =&gt; 'Hello', uppercase =&gt; true, b =&gt; 'World');
 concat_lower_or_upper
-----------------------
 HELLO WORLD
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An older syntax based on ":=" is supported for backward compatibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper(a := 'Hello', uppercase := true, b := 'World');
 concat_lower_or_upper
-----------------------
 HELLO WORLD
(1 row)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-mixed-notation"><a class="anchor" href="#using-mixed-notation"></a>6.3.3. Using Mixed Notation</h4>
<div class="paragraph">
<p>The mixed notation combines positional and named notation. However, as already mentioned, named arguments cannot precede positional arguments. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SELECT concat_lower_or_upper('Hello', 'World', uppercase =&gt; true);
 concat_lower_or_upper
-----------------------
 HELLO WORLD
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above query, the arguments <code>a</code> and <code>b</code> are specified positionally, while <code>uppercase</code> is specified by name. In this example, that adds little except documentation. With a more complex function having numerous parameters that have default values, named or mixed notation can save a great deal of writing and reduce chances for error.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Named and mixed call notations currently cannot be used when calling an aggregate function (but they do work when an aggregate function is used as a window function).</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="oracle-compatible-features"><a class="anchor" href="#oracle-compatible-features"></a>7. Oracle Compatible Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration-parameters"><a class="anchor" href="#configuration-parameters"></a>7.1. Configuration parameters</h3>
<div class="paragraph">
<p>Parameters are set in the same way as in native IvorySQL. All parameter names are case-insensitive. Each parameter takes a value of one of the following five types: boolean, string, integer, floating point, or enum.</p>
</div>
<div class="sect3">
<h4 id="compatible_mode-enum"><a class="anchor" href="#compatible_mode-enum"></a>7.1.1. <code>compatible_mode (enum)</code></h4>
<div class="paragraph">
<p>This parameter controls the behavior of the database server. The default value is <code>postgres</code>, which means it is a native installation and the server will be installed as a native PG. If it is set to <code>oracle</code>, then the query output and overall system behavior will change, as it will be more Oracle-like.</p>
</div>
<div class="paragraph">
<p>When set to <code>oracle</code>, this parameter will implicitly add a Schema with the same name to <code>search_path</code>. so that Oracle-compatible objects can be located.</p>
</div>
<div class="paragraph">
<p>This parameter can be set via the <code>postgresql.conf</code> configuration file to take effect for the entire database. Or it can be set on the session by the client using the <code>set</code> command.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packages"><a class="anchor" href="#packages"></a>7.2. Packages</h3>
<div class="paragraph">
<p>1.This section introduces IvorySQL&#8217;s "Oracle-style packages". By definition, a package is an object or group of objects packaged together. In the case of a database, this translates into a named schema object that packages within itself a collection of procedures, functions, variables, cursors, user-defined record types, and logical groupings of referenced records. It is expected that users are familiar with IvorySQL and have a good understanding of the SQL language in order to better understand these packages and use them more effectively.</p>
</div>
<div class="sect3">
<h4 id="requirements-for-packages"><a class="anchor" href="#requirements-for-packages"></a>7.2.1. Requirements for packages</h4>
<div class="paragraph">
<p>As with similar constructs in various other programming languages, there are many benefits to using packages with SQL. In this section, we are going to talk about a few.</p>
</div>
<div class="paragraph">
<p>1.Reliability and reusability of code packages</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Packages enable you to create modular objects that encapsulate code. This makes the overall design and implementation much easier. By encapsulating variables and related types, stored procedures/functions, and cursors, it allows you to create a stand-alone module that is simple, easy to understand, and easy to maintain and use. Encapsulation works by exposing the package interface rather than the implementation details of the package body. As a result, this is beneficial in many ways. It allows applications and users to reference a consistent interface without having to worry about the content of its body. In addition, it prevents users from making any decisions based on the code implementation, which is never exposed to them.</pre>
</div>
</div>
<div class="paragraph">
<p>2.Ease of use</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The ability to create consistent functional interfaces in IvorySQL helps simplify application development because it allows packages to be compiled without a body. After the development phase, packages allow users to manage access control for the entire package, rather than individual objects. This is very valuable, especially when the package contains many schema objects.</pre>
</div>
</div>
<div class="paragraph">
<p>3.Performance</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Packages are loaded into memory for maintenance, and therefore use minimal I/O resources. Recompilation is simple and limited to changed objects; no recompilation of slave objects.</pre>
</div>
</div>
<div class="paragraph">
<p>4.Additional Features</p>
</div>
<div class="literalblock">
<div class="content">
<pre>In addition to performance and ease of use, the package provides session-wide persistence for variables and cursors. This means that variables and cursors have the same lifetime as the database session and are destroyed when the session is destroyed.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="package-components"><a class="anchor" href="#package-components"></a>7.2.2. Package Components</h4>
<div class="paragraph">
<p>A package has an interface and a body, which are the main components that make up the package.</p>
</div>
<div class="paragraph">
<p>1.Package specification</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The package specification specifies any objects within the package that are used from the outside. This refers to interfaces that are publicly accessible. It does not contain their definitions or implementations, i.e., functions and procedures. It defines only the title, not the body definition. Variables can be initialized. The following is a list of objects that can be listed in the specification.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Functions</p>
</li>
<li>
<p>Procedures</p>
</li>
<li>
<p>Cursors</p>
</li>
<li>
<p>Types</p>
</li>
<li>
<p>Variables</p>
</li>
<li>
<p>Constants</p>
</li>
<li>
<p>Record types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>2.Package Bodies</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The package body contains all the implementation code of the package, including public interfaces and private objects. If the specification does not contain any subroutines or cursors, the package body is optional.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>It must contain the definitions of the subroutines declared in the specification, and the corresponding definitions must match.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>A package body may contain its own subroutines and type declarations for any internal objects not specified in the specification. These objects are considered private. It is not possible to access private objects outside the package.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>In addition to the subroutine definition, it may optionally contain an initialization block that initializes the variables declared in the specification and is executed only once when the package is first invoked in a session.</pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title"><strong>Note</strong></div>
<div class="paragraph">
<p>If the specification changes, the package body will be invalidated. Care must be taken when identifying public and private interfaces to avoid exposing critical functions and variables outside of the package.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="package-syntax"><a class="anchor" href="#package-syntax"></a>7.2.3. Package Syntax</h4>
<div class="sect4">
<h5 id="package-specification-syntax"><a class="anchor" href="#package-specification-syntax"></a>7.2.3.1. Package Specification Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [ OR REPLACE ] PACKAGE [schema.] *package_name* [invoker_rights_clause] [IS | AS]
   item_list[, item_list ...]
END [*package_name*];


invoker_rights_clause:
     AUTHID [CURRENT_USER | DEFINER]

item_list:
[
   function_declaration    |
   procedure_declaration   |
   type_definition         |
   cursor_declaration      |
   item_declaration
]


function_declaration:
     FUNCTION function_name [(parameter_declaration[, ...])] RETURN datatype;

procedure_declaration:
     PROCEDURE procedure_name [(parameter_declaration[, ...])]

type_definition:
     record_type_definition      |
     ref_cursor_type_definition

cursor_declaration:
   CURSOR name [(cur_param_decl[, ...])] RETURN rowtype;

item_declaration:
     cursor_declaration             |
     cursor_variable_declaration    |
     record_variable_declaration    |
     variable_declaration           |

record_type_definition:
   TYPE record_type IS RECORD  ( variable_declaration [, variable_declaration]... ) ;

ref_cursor_type_definition:
   TYPE type IS REF CURSOR [ RETURN type%ROWTYPE ];

cursor_variable_declaration:
   curvar curtype;

record_variable_declaration:
   recvar { record_type | rowtype_attribute | record_type%TYPE };

variable_declaration:
   varname datatype [ [ NOT NULL ] := expr ]

parameter_declaration:
   parameter_name [IN] datatype [[:= | DEFAULT] expr]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="package-body-syntax"><a class="anchor" href="#package-body-syntax"></a>7.2.3.2. Package Body Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [ OR REPLACE ] PACKAGE BODY [schema.] package_name [IS | AS]
   [item_list[, item_list ...]] |
   item_list_2 [, item_list_2 ...]
   [initialize_section]
END [package_name];


initialize_section:
   BEGIN statement[, ...]

item_list:
[
   function_declaration    |
   procedure_declaration   |
   type_definition         |
   cursor_declaration      |
   item_declaration
]

item_list_2:
[
   function_declaration
   function_definition
   procedure_declaration
   procedure_definition
   cursor_definition
]

function_definition:
   FUNCTION function_name [(parameter_declaration[, ...])] RETURN datatype  [IS | AS]
   [declare_section] body;

procedure_definition:
   PROCEDURE procedure_name [(parameter_declaration[, ...])] [IS | AS]
   [declare_section] body;

cursor_definition:
   CURSOR name [(cur_param_decl[, ...])] RETURN rowtype IS select_statement;

body:
   BEGIN statement[, ...] END [name];

statement:
   [&lt;&lt;LABEL&gt;&gt;] pl_statments[, ...];</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="description-13"><a class="anchor" href="#description-13"></a>7.2.3.3. <strong>Description</strong></h5>
<div class="paragraph">
<p>Create Package defines a new package. Creating or replacing a package will create a new package or replace an existing definition.</p>
</div>
<div class="paragraph">
<p>If the architecture name is included, the package is created in the specified architecture. Otherwise, it will be created in the current architecture. The name of the new package must be unique within the architecture.</p>
</div>
<div class="paragraph">
<p>When replacing an existing package with "Create or Replace Package", the ownership and permissions of the package are not changed. All other package properties are specified as specified or implied in the command. You must own the package in order to replace it (this includes being a member of the role to which it belongs).</p>
</div>
<div class="paragraph">
<p>The user who created the package becomes the owner of the package.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-11"><a class="anchor" href="#parameters-11"></a>7.2.3.4. <strong>parameters</strong></h5>
<div class="paragraph">
<p><code>package_name</code> The name of the package to be created (optionally architecture qualified).</p>
</div>
<div class="paragraph">
<p><code>invoker_rights_clause</code> Caller permissions define the package&#8217;s access to database objects. The available options are.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CURRENT_USER</strong> The access rights of the current user executing the package will be used.</p>
</li>
<li>
<p><strong>DEFINER</strong> will use the access rights of the package creator.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>item_list</code> This is the list of items that can be part of the package.</p>
</div>
<div class="paragraph">
<p><code>procedure_declaration</code> Specifies the procedure name and its argument list. This is just a declaration and does not define the procedure.</p>
</div>
<div class="paragraph">
<p>When this declaration is part of the package specification, it is a public procedure and its definition must be added to the package body.</p>
</div>
<div class="paragraph">
<p>When it is part of the package body, it acts as a forwarding declaration and is a private procedure accessible only to package elements.</p>
</div>
<div class="paragraph">
<p>The <code>procedure_definition</code> procedure is defined in the package body. This defines the previously declared procedure. It is also possible to define a procedure without any previous declarations, which would make it a private procedure.</p>
</div>
<div class="paragraph">
<p>` function_declaration` defines the function name, its arguments and its return type. It is just a declaration and will not define a function.</p>
</div>
<div class="paragraph">
<p>When this declaration is part of the package specification, it is a public function and its definition must be added to the package body.</p>
</div>
<div class="paragraph">
<p>When it is part of the package body, it acts as a forwarding declaration and is a private function accessible only to package elements.</p>
</div>
<div class="paragraph">
<p><code>function_definition</code> These functions are defined in the package body. This defines the function declared earlier. It can also define a function without any previous declarations, which would make it a private function.</p>
</div>
<div class="paragraph">
<p><code>type_definition</code> suggests that you can define record or cursor types.</p>
</div>
<div class="paragraph">
<p><code>cursor_declaration</code> defines that a cursor declaration must include its arguments and return type as the required line type.</p>
</div>
<div class="paragraph">
<p><code>item_declaration</code> allows declarations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cursors</p>
</li>
<li>
<p>Cursor variables</p>
</li>
<li>
<p>Record variables</p>
</li>
<li>
<p>Variables</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>parameter_declaration</code> defines the syntax for declaring parameters. If the keyword "IN" is specified, it means that this is an input parameter. The default keyword followed by an expression (or value) can only be specific to the input parameter.</p>
</div>
<div class="paragraph">
<p><code>declare_section</code> It contains all elements local to the function or procedure and can be referenced in its body.</p>
</div>
<div class="paragraph">
<p><code>body</code> The body consists of the SQL statements or PL control structures supported by the PL/iSQL language.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-and-accessing-packages"><a class="anchor" href="#creating-and-accessing-packages"></a>7.2.4. Creating and Accessing Packages</h4>
<div class="sect4">
<h5 id="creating-packages"><a class="anchor" href="#creating-packages"></a>7.2.4.1. Creating Packages</h5>
<div class="paragraph">
<p>In this section, we will learn more about the package construction process and how to access its public elements.</p>
</div>
<div class="paragraph">
<p>When a package is created, IvorySQL will compile it and report any issues it may find. Once the package is successfully compiled, it will be removed ready for use.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-package-elements"><a class="anchor" href="#accessing-package-elements"></a>7.2.4.2. Accessing Package Elements</h5>
<div class="paragraph">
<p>When a package is first referenced in a session, it will be instantiated and initialized. The following actions perform this process in the procedure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assigning initial values to public constants and variables</p>
</li>
<li>
<p>Execute the initial value setting item block for the package</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are several ways to access package elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Package functions can be used like any other function in a SELECT statement or other PL block</p>
</li>
<li>
<p>Package procedures can be called directly using CALL or from other PL blocks</p>
</li>
<li>
<p>Package variables can be read and written directly using the package name qualification in the PL block or from the SQL prompt.</p>
</li>
<li>
<p>Direct access using dot notation: In the dot representation, elements can be accessed by</p>
</li>
<li>
<p>package_name.func('foo');</p>
</li>
<li>
<p>package_name.proc('foo');</p>
</li>
<li>
<p>package_name.variable;</p>
</li>
<li>
<p>package_name.constant;</p>
</li>
<li>
<p>package_name.other_package.func('foo');</p>
<div class="literalblock">
<div class="content">
<pre>These statements can be used from inside a PL block, or in a SELECT statement if the elements are not type declarations or procedures.</pre>
</div>
</div>
</li>
<li>
<p>SQL call statements: Another way is to use the CALL statement. the CALL statement executes a standalone procedure, or a function defined in a type or package.</p>
</li>
<li>
<p>CALL package_name.func('foo');</p>
</li>
<li>
<p>CALL package_name.proc('foo');</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="understanding-the-scope-of-visibility"><a class="anchor" href="#understanding-the-scope-of-visibility"></a>7.2.5. Understanding the Scope of Visibility</h4>
<div class="paragraph">
<p>The scope of a variable declared in a PL/SQL block is limited to that block. If it has nested blocks, it will be a global variable of the nested block.</p>
</div>
<div class="paragraph">
<p>Similarly, if both blocks declare variables with the same name, then within the nested block, its own declared variable is visible and the parent variable is invisible. To access the parent variable, the variable must be fully qualified.</p>
</div>
<div class="paragraph">
<p>Consider the following code snippet.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-visibility-and-qualified-variable-names"><a class="anchor" href="#example-visibility-and-qualified-variable-names"></a>7.2.6. <strong>Example: Visibility and Qualified Variable Names</strong></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">&lt;&lt;blk_1&gt;&gt;
DECLARE
   x INT;
   y INT;
BEGIN
   -- both blk_1.x and blk_1.y are visible
   &lt;&lt;blk_2&gt;&gt;
   DECLARE
      x INT;
      z INT;
   BEGIN
      -- blk_2.x, y and z are visible
      -- to access blk_1.x it has to be a qualified name. blk_1.x := 0; NULL;
   END;
   -- both x and y are visible
END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example shows how variable names must be fully qualified when nested packages contain variables with the same name.</p>
</div>
<div class="paragraph">
<p>Variable name qualification helps to resolve possible confusion introduced by scope precedence in the following cases.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Package and nested package variables: if unqualified, nested takes precedence</p>
</li>
<li>
<p>Package variables and column names: if unqualified, column names take precedence</p>
</li>
<li>
<p>Function or program variables and package variables: if unqualified, package variables take precedence.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type qualification is required for fields or methods in the following types</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Record type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example: Record type visibility and access</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">DECLARE
     x INT;
     TYPE xRec IS RECORD (x char, y INT);
BEGIN
     x := 1; -- will always refer to x(INT) type.
     xRec.x := '2'; -- to refer the CHAR type, it will have to be
qualified name
END;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="package-example"><a class="anchor" href="#package-example"></a>7.2.7. Package Example</h4>
<div class="sect4">
<h5 id="package-specifications"><a class="anchor" href="#package-specifications"></a>7.2.7.1. Package Specifications</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE TABLE test(x INT, y VARCHAR2(100));
INSERT INTO test VALUES (1, 'One');
INSERT INTO test VALUES (2, 'Two');
INSERT INTO test VALUES (3, 'Three');

-- Package specification:
CREATE OR REPLACE PACKAGE example AUTHID DEFINER AS
   -- Declare public type, cursor, and exception:
   TYPE rectype IS RECORD (a INT, b VARCHAR2(100));
   CURSOR curtype RETURN rectype%rowtype;

   rec rectype;

   -- Declare public subprograms:
   FUNCTION somefunc (
         last_name VARCHAR2,
         first_name VARCHAR2,
         email VARCHAR2
   ) RETURN NUMBER;

   -- Overload preceding public subprogram:
   PROCEDURE xfunc (emp_id NUMBER);
   PROCEDURE xfunc (emp_email VARCHAR2);
END example;
/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="package-body"><a class="anchor" href="#package-body"></a>7.2.7.2. Package body</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">-- Package body:
CREATE OR REPLACE PACKAGE BODY example AS
   nelems NUMBER; -- private variable, visible only in this package

   -- Define cursor declared in package specification:
   CURSOR curtype RETURN rectype%rowtype IS SELECT x, y
           FROM test
           ORDER BY x;
   -- Define subprograms declared in package specification:
   FUNCTION somefunc (
           last_name VARCHAR2,
           first_name VARCHAR2,
           email VARCHAR2
     ) RETURN NUMBER IS
         id NUMBER := 0;
     BEGIN
         OPEN curtype;
         LOOP
            FETCH curtype INTO rec;
            EXIT WHEN NOT FOUND;
         END LOOP;
         RETURN rec.a;
     END;

   PROCEDURE xfunc (emp_id NUMBER) IS
   BEGIN
      NULL;
   END;

   PROCEDURE xfunc (emp_email VARCHAR2) IS
   BEGIN
      NULL;
   END;

BEGIN -- initialization part of package body
   nelems := 0;
END example;
/
SELECT example.somefunc('Joe', 'M.', 'email@example.com');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="limitations"><a class="anchor" href="#limitations"></a>7.2.8. Limitations</h4>
<div class="paragraph">
<p>Record types are supported as package variables, but they can only be used within package elements, i.e. package functions/procedures can use them. They cannot be accessed outside the package, a restriction that will be addressed in the next update of IvorySQL.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changing-tables"><a class="anchor" href="#changing-tables"></a>7.3. Changing tables</h3>
<div class="sect3">
<h4 id="syntax"><a class="anchor" href="#syntax"></a>7.3.1. syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">ALTER TABLE [ IF EXISTS ] [ ONLY ] name [ * ]
action;

action:
    ADD ( add_coldef [, ... ] )
    | MODIFY ( modify_coldef [, ... ] )
    | DROP [ COLUMN ] ( column_name [, ... ] )

add_coldef:
    cloumn_name data_type

modify_coldef:
    cloumn_name data_type alter_using

alter_using:
    USING expression</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-12"><a class="anchor" href="#parameters-12"></a>7.3.2. <strong>parameters</strong></h4>
<div class="paragraph">
<p><code>name</code> Table name.
<code>cloumn_name</code> Column name.
<code>data_type</code> Column type.
<code>expression</code> The value expression.
<code>ADD keyword</code> Adds a column to the table, either one or more columns.
<code>MODIFY keyword</code> Modify a column of the table, you can modify one or more columns.
<code>DROP keyword</code> Deletes a column of a table, you can delete one or more columns.
<code>USING keyword</code> Modifies the value of a column.</p>
</div>
</div>
<div class="sect3">
<h4 id="example"><a class="anchor" href="#example"></a>7.3.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">ADD:
create table tb_test1(id int, flg char(10));

alter table tb_test1 add (name varchar);

alter table tb_test1 add (adress varchar, num int, flg1 char);

\d tb_test1
                   Table "public.tb_test1"
 Column |       Type        | Collation | Nullable | Default
--------+-------------------+-----------+----------+---------
 id     | integer           |           |          |
 flg    | character(10)     |           |          |
 name   | character varying |           |          |
 adress | character varying |           |          |
 num    | integer           |           |          |
 flg1   | character(1)      |           |          |

MODIFY:
create table tb_test2(id int, flg char(10), num varchar);

insert into tb_test2 values('1', 2, '3');

alter table tb_test2 modify(id char);

\d tb_test2
                   Table "public.tb_test2"
 Column |       Type        | Collation | Nullable | Default
--------+-------------------+-----------+----------+---------
 id     | character(1)      |           |          |
 flg    | character(10)     |           |          |
 num    | character varying |           |          |

DROP:
create table tb_test3(id int, flg1 char(10), flg2 char(11), flg3 char(12), flg4 char(13),
                        flg5 char(14), flg6 char(15));

alter table tb_test3 drop column(id);

\d tb_test3
                 Table "public.tb_test3"
 Column |     Type      | Collation | Nullable | Default
--------+---------------+-----------+----------+---------
 flg1   | character(10) |           |          |
 flg2   | character(11) |           |          |
 flg3   | character(12) |           |          |
 flg4   | character(13) |           |          |
 flg5   | character(14) |           |          |
 flg6   | character(15) |           |          |</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delete-table"><a class="anchor" href="#delete-table"></a>7.4. Delete table</h3>
<div class="sect3">
<h4 id="syntax-2"><a class="anchor" href="#syntax-2"></a>7.4.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">[ WITH [ RECURSIVE ] with_query [, ...] ]
DELETE [ FROM ] [ ONLY ] table_name [ * ] [ [ AS ] alias ]
    [ USING using_list ]
    [ WHERE condition | WHERE CURRENT OF cursor_name ]
    [ RETURNING * | output_expression [ [ AS ] output_name ] [, ...] ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-13"><a class="anchor" href="#parameters-13"></a>7.4.2. Parameters</h4>
<div class="paragraph">
<p><code>table_name</code> The name of the table.
<code>alias</code> The table alias.
<code>using_list</code> A list of table expressions that allow columns from other tables to appear in the WHERE condition.
<code>condition</code> An expression that returns a boolean type value.
<code>cursor_name</code> The name of the cursor to be used in the WHERE CURRENT OF case.
<code>output_expression</code> An expression that is calculated by DELETE and returned after each row is deleted.
<code>output_name</code> The name of the returned column.</p>
</div>
</div>
<div class="sect3">
<h4 id="uses"><a class="anchor" href="#uses"></a>7.4.3. uses</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table tb_test4(id int, flg char(10));

insert into tb_test4 values(1, '2'), (3, '4'), (5, '6');

delete from tb_test4 where id = 1;

delete tb_test4 where id = 3;

table tb_test4;
 id |    flg
----+------------
 5  | 6
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-table"><a class="anchor" href="#update-table"></a>7.5. Update table</h3>
<div class="sect3">
<h4 id="syntax-3"><a class="anchor" href="#syntax-3"></a>7.5.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">[ WITH [ RECURSIVE ] with_query [, ...] ]
UPDATE [ ONLY ] table_name [ * ] [ [ AS ] alias ]
    SET { [ table_name | alias ] column_name = { expression | DEFAULT }
| ( [ table_name | alias ] column_name [, ...] ) = [ ROW ]    ( { expression | DEFAULT } [, ...] )
| ( [ table_name | alias ] column_name [, ...] ) = ( sub-SELECT )
        } [, ...]
    [ FROM from_list ]
    [ WHERE condition | WHERE CURRENT OF cursor_name ]
    [ RETURNING * | output_expression [ [ AS ] output_name ] [, ...] ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-14"><a class="anchor" href="#parameters-14"></a>7.5.2. <strong>parameters</strong></h4>
<div class="paragraph">
<p><code>table_name</code> Table name.
<code>alias</code> Table alias.
<code>column_name</code> Column name.
<code>expression</code> Value expression.
<code>sub-SELECT</code> select clause.
<code>from_list</code> Table expression.
<code>condition</code> An expression that returns a value of type boolean.
<code>cursor_name</code> The name of the cursor to be used in the WHERE CURRENT OF case.
<code>output_expression</code> An expression that is computed by DELETE and returned after each row is deleted.
<code>output_name</code> The name of the column being returned.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-2"><a class="anchor" href="#example-2"></a>7.5.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table tb_test5(id int, flg char(10));

insert into tb_test5 values(1, '2'), (3, '4'), (5, '6');

update tb_test5 a set a.id = 33 where a.id = 3;

table tb_test5;
Id  |    flg
----+------------
  1 | 2
  5 | 6
 33 | 4
(3 rows)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="group-by"><a class="anchor" href="#group-by"></a>7.6. GROUP BY</h3>
<div class="sect3">
<h4 id="example-3"><a class="anchor" href="#example-3"></a>7.6.1. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">set compatible_mode to oracle;

create table students(student_id varchar(20) primary key ,
student_name varchar(40),
student_pid int);

select student_id,student_name from students group by student_id;
ERROR:  column "students.student_name" must appear in the GROUP BY clause or be used in an aggregate function</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="union"><a class="anchor" href="#union"></a>7.7. UNION</h3>
<div class="sect3">
<h4 id="example-4"><a class="anchor" href="#example-4"></a>7.7.1. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select null union select null union select 1.2;
 ?column?
----------
      1.2

(2 rows)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="minus-operator"><a class="anchor" href="#minus-operator"></a>7.8. Minus Operator</h3>
<div class="sect3">
<h4 id="syntax-4"><a class="anchor" href="#syntax-4"></a>7.8.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select_statement MINUS [ ALL | DISTINCT ] select_statement;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-15"><a class="anchor" href="#parameters-15"></a>7.8.2. Parameters</h4>
<div class="paragraph">
<p><code>select_statement</code> Any SELECT statement without the ORDER BY, LIMIT, FOR NO KEY UPDATE, FOR UPDATE, FOR SHARE, and FOR KEY SHARE clauses.
<code>ALL keyword</code> contains duplicate row results.
<code>DISTINCT keyword</code> shows the elimination of duplicate rows.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-5"><a class="anchor" href="#example-5"></a>7.8.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select * from generate_series(1, 3) g(i) MINUS select * from generate_series(1, 3) g(i) where i = 1;
 i
---
 2
 3
(2 rows)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="escape-characters"><a class="anchor" href="#escape-characters"></a>7.9. Escape characters</h3>
<div class="sect3">
<h4 id="overview-2"><a class="anchor" href="#overview-2"></a>7.9.1. Overview</h4>
<div class="paragraph">
<p>Use q\' to escape special characters. q\' escaped characters are usually used after ! [] {} () \&lt;&gt; and other escaping characters, you can also use \, letters, numbers, \=, +, -, *, \&amp;, \$, \%, #, etc., no spaces are allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-of"><a class="anchor" href="#example-of"></a>7.9.2. Example of</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select q''' is goog '';
  ?column?
------------
 ' is goog
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sequence"><a class="anchor" href="#sequence"></a>7.10. Sequence</h3>
<div class="sect3">
<h4 id="syntax-5"><a class="anchor" href="#syntax-5"></a>7.10.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">SELECT [ database {schema} | schema ] sequence {nextval | currval};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-16"><a class="anchor" href="#parameters-16"></a>7.10.2. Parameters</h4>
<div class="paragraph">
<p>`sequence`Sequence Name.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-6"><a class="anchor" href="#example-6"></a>7.10.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create sequence sq;

select sq.nextval;
 nextval
-----------
      1
(1 row)

select sq.currval;
 nextval
-----------
      1
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compatible-with-time-and-date-functions"><a class="anchor" href="#compatible-with-time-and-date-functions"></a>7.11. Compatible with time and date functions</h3>
<div class="sect3">
<h4 id="from_tz"><a class="anchor" href="#from_tz"></a>7.11.1. from_tz</h4>
<div class="sect4">
<h5 id="purpose"><a class="anchor" href="#purpose"></a>7.11.1.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Convert the given timestamp without time zone to the specified timestamp with time zone, or return NULL if the specified time zone or timestamp is NULL.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameters-17"><a class="anchor" href="#parameters-17"></a>7.11.1.2. Parameters</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp without time zone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified time zone</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-7"><a class="anchor" href="#example-7"></a>7.11.1.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.from_tz('2021-11-08 09:12:39','Asia/Shanghai') from dual;
              from_tz
-----------------------------------
 2021-11-08 09:12:39 Asia/Shanghai
(1 row)

select oracle.from_tz('2021-11-08 09:12:39','SAST') from dual;
         from_tz
--------------------------
 2021-11-08 09:12:39 SAST

select oracle.from_tz(NULL,'SAST') from dual;
 from_tz
---------

(1 row)

select oracle.from_tz('2021-11-08 09:12:31',NULL) from dual;
 from_tz
---------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="numtodsinterval"><a class="anchor" href="#numtodsinterval"></a>7.11.2. numtodsinterval</h4>
<div class="sect4">
<h5 id="purpose-2"><a class="anchor" href="#purpose-2"></a>7.11.2.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Convert the given number to the specified format of time, the format Parameters are：'day','hour','minute','second'。</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameters-description"><a class="anchor" href="#parameters-description"></a>7.11.2.2. Parameters Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number to be converted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target date and time type, including 'day', 'hour', 'minute' 'second'</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-8"><a class="anchor" href="#example-8"></a>7.11.2.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.numtodsinterval(2147483646.1232131232,'day') from dual;
                 numtodsinterval
--------------------------------------------------
 @ 2147483646 days 2 hours 57 mins 25.607758 secs
(1 row)

select oracle.numtodsinterval(2147483647.1232131232,'hour') from dual;
             numtodsinterval
------------------------------------------
 @ 2147483647 hours 7 mins 23.567104 secs
(1 row)

select oracle.numtodsinterval(7730941132799.1232131232,'second') from dual;
              numtodsinterval
-------------------------------------------
 @ 2147483647 hours 59 mins 59.123456 secs
(1 row)

select oracle.numtodsinterval(NULL,'second') from dual;
 numtodsinterval
-----------------

(1 row)

select oracle.numtodsinterval(7730941132800.1232131232,NULL) from dual;
 numtodsinterval
-----------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="numtoyminterval"><a class="anchor" href="#numtoyminterval"></a>7.11.3. numtoyminterval</h4>
<div class="sect4">
<h5 id="purpose-3"><a class="anchor" href="#purpose-3"></a>7.11.3.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Converts the given number to a date in the specified format, the format Parameters has：'year','month'。</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription"><a class="anchor" href="#parametersdescription"></a>7.11.3.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number to be converted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target date ('year' or 'month')</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-9"><a class="anchor" href="#example-9"></a>7.11.3.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.numtoyminterval(178956970.1232131232,'year') from dual;
                       numtoyminterval
-------------------------------------------------------------
 @ 178956970 years 1 mon 14 days 8 hours 33 mins 40.608 secs
(1 row)

select oracle.numtoyminterval(2147483646.1232131232,'month') from dual;
                        numtoyminterval
---------------------------------------------------------------
 @ 178956970 years 6 mons 3 days 16 hours 42 mins 48.2688 secs
(1 row)

select oracle.numtoyminterval(NULL,'month') from dual;
 numtoyminterval
-----------------

(1 row)

select oracle.numtoyminterval(2147483647.1232131232,NULL) from dual;
 numtoyminterval
-----------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="systimestamp"><a class="anchor" href="#systimestamp"></a>7.11.4. systimestamp</h4>
<div class="sect4">
<h5 id="purpose-4"><a class="anchor" href="#purpose-4"></a>7.11.4.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Get the timestamp of the current database system.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-10"><a class="anchor" href="#example-10"></a>7.11.4.2. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.systimestamp();
         systimestamp
-------------------------------
 2021-12-02 14:38:59.879642+08
(1 row)

select systimestamp;
      statement_timestamp
-------------------------------
 2021-12-02 14:39:33.262828+08</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sys_extract_utc"><a class="anchor" href="#sys_extract_utc"></a>7.11.5. sys_extract_utc</h4>
<div class="sect4">
<h5 id="purpose-5"><a class="anchor" href="#purpose-5"></a>7.11.5.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Converts the given timestamp with time zone to UTC time without time zone.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameters-description-2"><a class="anchor" href="#parameters-description-2"></a>7.11.5.2. Parameters Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Need to convert time stamp with time zone</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-11"><a class="anchor" href="#example-11"></a>7.11.5.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.sys_extract_utc('2018-03-28 11:30:00.00 +09:00'::timestamptz) from dual;
   sys_extract_utc
---------------------
 2018-03-28 02:30:00
(1 row)

select oracle.sys_extract_utc(NULL) from dual;
 sys_extract_utc
-----------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sessiontimezone"><a class="anchor" href="#sessiontimezone"></a>7.11.6. sessiontimezone</h4>
<div class="sect4">
<h5 id="purpose-6"><a class="anchor" href="#purpose-6"></a>7.11.6.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Gets the time zone of the current session.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-12"><a class="anchor" href="#example-12"></a>7.11.6.2. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.sessiontimezone() from dual;
 sessiontimezone
-----------------
 PRC
(1 row)

set timezone to UTC;

 select oracle.sessiontimezone();
 sessiontimezone
-----------------
 UTC
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dbtimezone"><a class="anchor" href="#dbtimezone"></a>7.11.7. dbtimezone</h4>
<div class="sect4">
<h5 id="purpose-7"><a class="anchor" href="#purpose-7"></a>7.11.7.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Gets the time zone of the database server.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-13"><a class="anchor" href="#example-13"></a>7.11.7.2. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.dbtimezone();
 dbtimezone
------------
 PRC
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="days_between"><a class="anchor" href="#days_between"></a>7.11.8. days_between</h4>
<div class="sect4">
<h5 id="purpose-8"><a class="anchor" href="#purpose-8"></a>7.11.8.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Get the difference in the number of days between the two times.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-2"><a class="anchor" href="#parametersdescription-2"></a>7.11.8.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second timestamp</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-14"><a class="anchor" href="#example-14"></a>7.11.8.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.days_between('2021-11-25 15:33:16'::timestamp,'2019-01-01 00:00:00'::timestamp) from dual;
   days_between
------------------
 1059.64810185185
(1 row)

select oracle.days_between('2019-09-08 09:09:09'::timestamp,'2019-01-01 00:00:00'::timestamp) from dual;
   days_between
------------------
 250.381354166667
(1 row)

select oracle.days_between('2021-11-25 09:09:09'::oracle.date,'2019-01-01 00:00:00'::oracle.date) from dual;
   days_between
------------------
 1059.38135416667
(1 row)

select oracle.days_between(NULL,NULL) from dual;
 days_between
--------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="days_between_tmtz"><a class="anchor" href="#days_between_tmtz"></a>7.11.9. days_between_tmtz</h4>
<div class="sect4">
<h5 id="purpose-9"><a class="anchor" href="#purpose-9"></a>7.11.9.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Get the number of days difference between two timestamps with time zones, or return NULL if the timestamp is NULL.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-3"><a class="anchor" href="#parametersdescription-3"></a>7.11.9.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First timestamp</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-15"><a class="anchor" href="#example-15"></a>7.11.9.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.days_between_tmtz('2019-09-08 09:09:09+08'::timestamptz,'2019-05-08 12:34:09+08'::timestamptz) from dual;
 days_between_tmtz
-------------------
  122.857638888889
(1 row)

select oracle.days_between_tmtz('2019-09-08 09:09:09+08'::timestamptz,'2019-05-08 12:34:09+09'::timestamptz) from dual;
 days_between_tmtz
-------------------
  122.899305555556
(1 row)

select oracle.days_between_tmtz(NULL,NULL) from dual;
 days_between_tmtz
-------------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add_days_to_timestamp"><a class="anchor" href="#add_days_to_timestamp"></a>7.11.10. add_days_to_timestamp</h4>
<div class="sect4">
<h5 id="purpose-10"><a class="anchor" href="#purpose-10"></a>7.11.10.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Add the required number of days to a timestamp, and the number of days to be added can be floating-point.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-4"><a class="anchor" href="#parametersdescription-4"></a>7.11.10.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamps that need to be changed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of days added</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-16"><a class="anchor" href="#example-16"></a>7.11.10.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.add_days_to_timestamp('1009-09-15 09:00:00'::timestamp, '3267.123'::numeric) from dual;
 add_days_to_timestamp
-----------------------
 1018-08-26 11:57:07.2
(1 row)

select oracle.add_days_to_timestamp(NULL, '3267.123'::numeric) from dual;
 add_days_to_timestamp
-----------------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subtract"><a class="anchor" href="#subtract"></a>7.11.11. subtract</h4>
<div class="sect4">
<h5 id="purpose-11"><a class="anchor" href="#purpose-11"></a>7.11.11.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">The subtraction of timestamp indicates the number of days subtracted from two timestamps, or the timestamp minus a number, the result is the timestamp, the number is the number of days, the timestamp can be with or without time zone.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-5"><a class="anchor" href="#parametersdescription-5"></a>7.11.11.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamps that need to be changed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp or a number representing the number of days</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-17"><a class="anchor" href="#example-17"></a>7.11.11.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.subtract('2019-11-25 16:51:20'::timestamptz,'3267.123'::numeric) from dual;
         subtract
--------------------------
 2010-12-15 13:54:12.8+08
(1 row)

select oracle.subtract('2019-11-25 16:51:20'::timestamptz, '2018-11-25 16:51:12'::timestamp) from dual;
  subtract
------------
 365.000093
(1 row)

select oracle.subtract('2019-11-25 16:51:20'::oracle.date,'3267.123'::numeric) from dual;
       subtract
-----------------------
 2010-12-15 13:54:12.8
(1 row)

 select oracle.subtract('2019-11-25 16:51:20'::oracle.date,'2017-02-21 13:51:20'::oracle.date) from dual;
 subtract
----------
 1007.125
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="next_day"><a class="anchor" href="#next_day"></a>7.11.12. next_day</h4>
<div class="sect4">
<h5 id="purpose-12"><a class="anchor" href="#purpose-12"></a>7.11.12.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">next_day returns the date of the first weekday with the same format name, which is later than the current date. The return type is always DATE, regardless of the date's data type. The return value has the same hour, minute, and second parts as the Parameters date.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-6"><a class="anchor" href="#parametersdescription-6"></a>7.11.12.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start Timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">weekday</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The day of the week, can be "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" or 0,1,2,3,4,5,6,0 for Sunday</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-18"><a class="anchor" href="#example-18"></a>7.11.12.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.next_day(to_timestamp('2020-02-29 14:40:50', 'YYYY-MM-DD HH24:MI:SS'), 'Tuesday') from dual;
      next_day
---------------------
 2020-03-03 14:40:50
(1 row)

select oracle.next_day('2020-07-01 19:43:51 +8'::timestamptz, 1) from dual;
      next_day
---------------------
 2020-07-05 19:43:51
(1 row)

select oracle.next_day(oracle.date '2020-09-15 12:13:29', 6) from dual;
      next_day
---------------------
 2020-09-18 12:13:29
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="last_day"><a class="anchor" href="#last_day"></a>7.11.13. last_day</h4>
<div class="sect4">
<h5 id="purpose-13"><a class="anchor" href="#purpose-13"></a>7.11.13.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">last_day returns the last day of the month in which the slot date falls.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-7"><a class="anchor" href="#parametersdescription-7"></a>7.11.13.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified timestamp</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-19"><a class="anchor" href="#example-19"></a>7.11.13.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.last_day(timestamp '2020-05-17 13:27:19') from dual;
      last_day
---------------------
 2020-05-31 13:27:19
(1 row)

select oracle.last_day('2020-11-29 19:20:40 +08'::timestamptz) from dual;
      last_day
---------------------
 2020-11-30 19:20:40
(1 row)

select oracle.last_day('-0004-2-1 13:27:19'::oracle.date) from dual;
       last_day
----------------------
 -0004-02-29 13:27:19
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add_months"><a class="anchor" href="#add_months"></a>7.11.14. add_months</h4>
<div class="sect4">
<h5 id="purpose-14"><a class="anchor" href="#purpose-14"></a>7.11.14.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">add_months returns the date plus an integer month. date Parameters can be date-time values or any value that can be implicitly converted to DATE. integer Parameters can be an integer or any value that can be implicitly converted to an integer.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-8"><a class="anchor" href="#parametersdescription-8"></a>7.11.14.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle.date type, the timestamp that needs to be changed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A shaping data, the number of months to be added</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-20"><a class="anchor" href="#example-20"></a>7.11.14.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.add_months(oracle.date '2020-02-15',7) from dual;
     add_months
---------------------
 2020-09-15 00:00:00
(1 row)

select oracle.add_months(timestamp '2018-12-15 19:12:09',12) from dual;
     add_months
---------------------
 2019-12-15 19:12:09
(1 row)

select oracle.add_months(timestamptz'2018-12-15 12:12:09 +08',120) from dual;
     add_months
---------------------
 2028-12-15 12:12:09
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="months_between"><a class="anchor" href="#months_between"></a>7.11.15. months_between</h4>
<div class="sect4">
<h5 id="purpose-15"><a class="anchor" href="#purpose-15"></a>7.11.15.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">months_between returns the value of the month between the first date and the second date, or a positive number if the first date is later than the second date, or a negative number if the first date is earlier than the second date.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-9"><a class="anchor" href="#parametersdescription-9"></a>7.11.15.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second timestamp</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-21"><a class="anchor" href="#example-21"></a>7.11.15.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.months_between(oracle.date '2021-11-10 12:11:10', oracle.date '2020-05-20 19:40:21') from dual;
  months_between
------------------
 17.6673570041816
(1 row)

select oracle.months_between(timestamp '2022-05-15 20:20:20', timestamp '2020-01-20 19:20:20') from dual;
  months_between
------------------
 27.8400537634409
(1 row)

select oracle.months_between(timestamptz '2020-01-10 01:00:00 +08', timestamptz '2028-05-19 16:25:20 +08') from dual;
  months_between
-------------------
 -100.311051373955
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sysdate"><a class="anchor" href="#sysdate"></a>7.11.16. sysdate</h4>
<div class="sect4">
<h5 id="purpose-16"><a class="anchor" href="#purpose-16"></a>7.11.16.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">sysdate returns the operating system time of the database server.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-22"><a class="anchor" href="#example-22"></a>7.11.16.2. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select sysdate;
  statement_sysdate
---------------------
 2021-12-09 16:20:34
(1 row)

select oracle.sysdate();
       sysdate
---------------------
 2021-12-09 16:21:39
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="new_time"><a class="anchor" href="#new_time"></a>7.11.17. new_time</h4>
<div class="sect4">
<h5 id="purpose-17"><a class="anchor" href="#purpose-17"></a>7.11.17.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">Convert the time of the first time zone to the time of the second time zone. The time zones include "ast", "adt", "bst", "bdt", "cst", "cdt", "est", "edt", "gmt", "hst", "hdt", "mst", "mdt", "nst", "pst", "pdt", "yst", "ydt".</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-10"><a class="anchor" href="#parametersdescription-10"></a>7.11.17.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp to be converted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamped time zones</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tz2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target time zone</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-23"><a class="anchor" href="#example-23"></a>7.11.17.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.new_time(timestamp '2020-12-12 17:45:18', 'AST', 'ADT') from dual;
      new_time
---------------------
 2020-12-12 18:45:18
(1 row)

select oracle.new_time(timestamp '2020-12-12 17:45:18', 'BST', 'BDT') from dual;
      new_time
---------------------
 2020-12-12 18:45:18
(1 row)

select oracle.new_time(timestamp '2020-12-12 17:45:18', 'CST', 'CDT') from dual;
      new_time
---------------------
 2020-12-12 18:45:18
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trunc"><a class="anchor" href="#trunc"></a>7.11.18. trunc</h4>
<div class="sect4">
<h5 id="purpose-18"><a class="anchor" href="#purpose-18"></a>7.11.18.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">The trunc function returns a date, truncated in the specified format. fmt includes "Y", "YY", "YYYY", "YYYY", "YEAR", "SYYYY", "SYEAR", "I", "IY", "IYY", "IYYY", "Q", "WW", "Iw", "W", "DAY", "DY", "D", " MONTH", "MONn", "MM", "RM", "CC", "SCC", "DDD", "DD", "J", "HH", "HH12", "HH24", "MI".</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-11"><a class="anchor" href="#parametersdescription-11"></a>7.11.18.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified date (oracle.date, timestamp, timestamptz)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified format, if omitted, defaults to "DDD"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-24"><a class="anchor" href="#example-24"></a>7.11.18.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.trunc(cast('2050-12-12 12:12:13' as oracle.date), 'SCC');
        trunc
---------------------
 2001-01-01 00:00:00
(1 row)

select oracle.trunc(timestamp '2020-07-28 19:16:12', 'Q');
        trunc
---------------------
 2020-07-01 00:00:00
(1 row)

select oracle.trunc(timestamptz '2020-09-27 18:30:21 + 08', 'MONTH');
         trunc
------------------------
 2020-09-01 00:00:00+08
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="round"><a class="anchor" href="#round"></a>7.11.19. round</h4>
<div class="sect4">
<h5 id="purpose-19"><a class="anchor" href="#purpose-19"></a>7.11.19.1. Purpose</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">The round function returns a date, rounded to the specified format. fmt includes "Y", "YY", "YYYY", "YYYY", "YEAR", "SYYYY", "SYEAR", "I", "IY", "IYY", "IYYY", "Q", "WW", "Iw", "W", "DAY", "DY", "D ", "MONTH", "MONn", "MM", "RM", "CC", "SCC", "DDD", "DD", "J", "HH", "HH12", "HH24", "MI".</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parametersdescription-12"><a class="anchor" href="#parametersdescription-12"></a>7.11.19.2. ParametersDescription</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date being converted (oracle.date, timestamp, timestamptz)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specified format, if omitted, defaults to "DDD"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-25"><a class="anchor" href="#example-25"></a>7.11.19.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">select oracle.round(cast('2051-12-12 19:00:00' as oracle.date), 'SCC');
        round
---------------------
 2101-01-01 00:00:00
(1 row)

select oracle.round(timestamp '2050-06-12 16:40:55', 'IYYY');
        round
---------------------
 2050-01-03 00:00:00
(1 row)

select oracle.round(timestamptz '2020-02-16 19:16:12 + 08', 'Q');
         round
------------------------
 2020-04-01 00:00:00+08
(1 row)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compatible-conversion-and-comparison-and-null-related-functions"><a class="anchor" href="#compatible-conversion-and-comparison-and-null-related-functions"></a>7.12. Compatible conversion and comparison and NULL-related functions</h3>
<div class="sect3">
<h4 id="to_char"><a class="anchor" href="#to_char"></a>7.12.1. TO_CHAR</h4>
<div class="sect4">
<h5 id="purpose-20"><a class="anchor" href="#purpose-20"></a>7.12.1.1. Purpose</h5>
<div class="paragraph">
<p>TO_CHAR (str,[fmt]) Converts the input Parameters to a TEXT data type value according to the given format. If fmt is omitted, the data will be converted to a TEXT value in the system default format. If str is null, the function returns null.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-18"><a class="anchor" href="#parameters-18"></a>7.12.1.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (any type).
<code>fmt</code> Input format Parameters, see format fmt for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-26"><a class="anchor" href="#example-26"></a>7.12.1.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_char(interval '3 2:20:05' );
     to_char
 -----------------
  3 days 02:20:05
 (1 row)

select to_char('4.00'::numeric);
  to_char
 ---------
  4
 (1 row)

select to_char(NULL);
  to_char
 ---------

 (1 row)

select to_char(123,'xx');
  to_char
 ---------
  7b
 (1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_number"><a class="anchor" href="#to_number"></a>7.12.2. TO_NUMBER</h4>
<div class="sect4">
<h5 id="purpose-21"><a class="anchor" href="#purpose-21"></a>7.12.2.1. Purpose</h5>
<div class="paragraph">
<p>TO_NUMBER(str,[fmt1]) Converts the input Parameters str to a value of the NUMREIC data type according to the given format. If fmt1 is omitted, the data will be converted to a NUMERIC value in the system default format. If str is NUMERIC, the function returns str. If str calculates to null, the function returns null. If it cannot be converted to the NUMERIC data type, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-19"><a class="anchor" href="#parameters-19"></a>7.12.2.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters include the following data types (double precision, numeric, text, integer, etc., but must be implicitly converted to numeric).
<code>fmt1</code> Input format Parameters, see format fmt1 for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-27"><a class="anchor" href="#example-27"></a>7.12.2.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_number('19f','xxx');
 to_number
-----------
   415
(1 row)

select to_number(1210.73::numeric, 9999.99::numeric);
 to_number
-----------
   1210.73
(1 row)

select to_number(NULL);
 to_number
-----------

(1 row)

select to_number('123'::text);
 to_number
-----------
   123
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hex_to_decimal"><a class="anchor" href="#hex_to_decimal"></a>7.12.3. HEX_TO_DECIMAL</h4>
<div class="sect4">
<h5 id="purpose-22"><a class="anchor" href="#purpose-22"></a>7.12.3.1. Purpose</h5>
<div class="paragraph">
<p>HEX_TO_DECIMAL(str) Hexadecimal to decimal, if the converted value is outside the range of the return type bigint, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-20"><a class="anchor" href="#parameters-20"></a>7.12.3.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (hexadecimal).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-28"><a class="anchor" href="#example-28"></a>7.12.3.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select hex_to_decimal('ffff');
 hex_to_decimal
----------------
          65535
(1 row)

select hex_to_decimal('0x7fffffffffffffff');
   hex_to_decimal
---------------------
 9223372036854775807
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_binary_double"><a class="anchor" href="#to_binary_double"></a>7.12.4. TO_BINARY_DOUBLE</h4>
<div class="sect4">
<h5 id="purpose-23"><a class="anchor" href="#purpose-23"></a>7.12.4.1. Purpose</h5>
<div class="paragraph">
<p>TO_BINARY_DOUBLE(str) converts the input Parameters str to a double-precision floating-point value. If str evaluates to null, the function returns null. If it cannot be converted to a double-precision floating-point data type or is outside the range of double-precision floating-point numbers, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-21"><a class="anchor" href="#parameters-21"></a>7.12.4.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (any type, but needs to be implicitly converted to double-precision floating-point).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-29"><a class="anchor" href="#example-29"></a>7.12.4.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_binary_double('1.2');
 to_binary_double
------------------
              1.2
(1 row)

select to_binary_double('1.2'::text);
 to_binary_double
------------------
              1.2
(1 row)

select to_binary_double(1.2::numeric);
 to_binary_double
------------------
              1.2
(1 row)

select to_binary_double(123456789123456789.45566::numeric);
    to_binary_double
------------------------
 1.2345678912345678e+17
(1 row)

select to_binary_double(NULL);
 to_binary_double
------------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_binray_float"><a class="anchor" href="#to_binray_float"></a>7.12.5. TO_BINRAY_FLOAT</h4>
<div class="sect4">
<h5 id="purpose-24"><a class="anchor" href="#purpose-24"></a>7.12.5.1. Purpose</h5>
<div class="paragraph">
<p>TO_BINARY_FLOAT(str) converts the input Parameters str to a single-precision floating-point number. If str is calculated to be null, the function returns null. If it cannot be converted to a single-precision floating-point data type or is outside the range of single-precision floating-point numbers, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-22"><a class="anchor" href="#parameters-22"></a>7.12.5.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (any type, but needs to be implicitly converted to single-precision floating-point type).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-30"><a class="anchor" href="#example-30"></a>7.12.5.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_binary_float(2.5555::float8);
 to_binary_float
-----------------
          2.5555
(1 row)

select to_binary_float('123'::text);
 to_binary_float
-----------------
             123
(1 row)

select to_binary_float(1.2::numeric);
 to_binary_float
-----------------
             1.2
(1 row)

select to_binary_float(NULL);
 to_binary_float
-----------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bin_to_num"><a class="anchor" href="#bin_to_num"></a>7.12.6. BIN_TO_NUM</h4>
<div class="sect4">
<h5 id="purpose-25"><a class="anchor" href="#purpose-25"></a>7.12.6.1. Purpose</h5>
<div class="paragraph">
<p>BIN_TO_NUM(str) converts a binary number to a decimal number. If str cannot be calculated as a binary number, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-23"><a class="anchor" href="#parameters-23"></a>7.12.6.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Enter Parameters (of any type, but must be convertible or computable as a binary number).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-31"><a class="anchor" href="#example-31"></a>7.12.6.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select bin_to_num('1.3'::text, '1.2'::name);
 bin_to_num
------------
          3
(1 row)

select bin_to_num(1.2::float8, 1::int4);
 bin_to_num
------------
          3
(1 row)

select bin_to_num(NULL);
 bin_to_num
------------

(1 row)

select bin_to_num(NULL, NULL, NULL);
 bin_to_num
------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_multi_byte"><a class="anchor" href="#to_multi_byte"></a>7.12.7. TO_MULTI_BYTE</h4>
<div class="sect4">
<h5 id="purpose-26"><a class="anchor" href="#purpose-26"></a>7.12.7.1. Purpose</h5>
<div class="paragraph">
<p>TO_MULTI_BYTE(str) converts the single-byte characters in the input Parameters str to the corresponding multi-byte characters. If str cannot be converted to text type, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-24"><a class="anchor" href="#parameters-24"></a>7.12.7.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (text, or can be implicitly converted to a text type).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_single_byte"><a class="anchor" href="#to_single_byte"></a>7.12.8. TO_SINGLE_BYTE</h4>
<div class="sect4">
<h5 id="purpose-27"><a class="anchor" href="#purpose-27"></a>7.12.8.1. Purpose</h5>
<div class="paragraph">
<p>TO_SINGLE_BYTE(str) converts the multi-byte characters in the input Parameters str to the corresponding single-byte characters. If str cannot be converted to a text type, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-25"><a class="anchor" href="#parameters-25"></a>7.12.8.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (text, or can be implicitly converted to text type).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-32"><a class="anchor" href="#example-32"></a>7.12.8.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_single_byte('ａｂｃ');
 to_single_byte
----------------
 abc
(1 row)

select to_single_byte('１．２');
 to_single_byte
----------------
 1.2
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_date"><a class="anchor" href="#to_date"></a>7.12.9. TO_DATE</h4>
<div class="sect4">
<h5 id="purpose-28"><a class="anchor" href="#purpose-28"></a>7.12.9.1. Purpose</h5>
<div class="paragraph">
<p>TO_DATE(str,[fmt]) Converts the input Parameters str to a date data type value according to the given format. If fmt is omitted, the data will be converted to a date value in the system default format. If str is null, the function returns null. If fmt is J, for Julian, then char must be an integer. The function returns an error if it cannot be converted to DATE.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-26"><a class="anchor" href="#parameters-26"></a>7.12.9.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (integer, text, can be implicitly converted to the above type, string that matches the date format).
<code>fmt</code> input format Parameters, see format fmt for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-33"><a class="anchor" href="#example-33"></a>7.12.9.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_date('50-11-28 ','RR-MM-dd ');
       to_date
---------------------
 1950-11-28 00:00:00
(1 row)

select to_date(2454336, 'J');
       to_date
---------------------
 2007-08-23 00:00:00
(1 row)

select to_date('2019/11/22', 'yyyy-mm-dd');
       to_date
---------------------
 2019-11-22 00:00:00
(1 row)

select to_date('20-11-28 10:14:22','YY-MM-dd hh24:mi:ss');
       to_date
---------------------
 2020-11-28 10:14:22
(1 row)

select to_date('2019/11/22');
       to_date
---------------------
 2019-11-22 00:00:00
(1 row)

select to_date('2019/11/27 10:14:22');
       to_date
---------------------
 2019-11-27 10:14:22
(1 row)

select to_date('2020','RR');
       to_date
---------------------
 2020-01-01 00:00:00
(1 row)

select to_date(NULL);
 to_date
---------

(1 row)

select to_date('-4712-07-23 14:31:23', 'syyyy-mm-dd hh24:mi:ss');
       to_date
----------------------
 -4712-07-23 14:31:23
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_timestamp"><a class="anchor" href="#to_timestamp"></a>7.12.10. TO_TIMESTAMP</h4>
<div class="sect4">
<h5 id="purpose-29"><a class="anchor" href="#purpose-29"></a>7.12.10.1. Purpose</h5>
<div class="paragraph">
<p>TO_TIMESTAMP(str,[fmt]) Converts the input Parameters str to a timestamp without a time zone according to the given format. If fmt is omitted, the data is converted to a timestamp with no time zone value in the system default format. If str is null, the function returns null. If it cannot be converted to a timestamp without a time zone, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-27"><a class="anchor" href="#parameters-27"></a>7.12.10.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (double precision,text, which can be implicitly converted to the above type).
<code>fmt</code> Input format Parameters, see format fmt for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-34"><a class="anchor" href="#example-34"></a>7.12.10.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_timestamp(1212121212.55::numeric);
       to_timestamp
---------------------------
 2008-05-30 12:20:12.55
(1 row)

select to_timestamp('2020/03/03 10:13:18 +5:00', 'YYYY/MM/DD HH:MI:SS TZH:TZM');
      to_timestamp
------------------------
 2020-03-03 13:13:18
(1 row)

select to_timestamp(NULL,NULL);
 to_timestamp
--------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interval_to_seconds"><a class="anchor" href="#interval_to_seconds"></a>7.12.11. INTERVAL_TO_SECONDS</h4>
<div class="sect4">
<h5 id="purpose-30"><a class="anchor" href="#purpose-30"></a>7.12.11.1. Purpose</h5>
<div class="paragraph">
<p>INTERVAL_TO_SECONDS(str) converts the input Parametersstr time interval to seconds. Input Parameters include: day, hour, minute, second and microsecond. If it is year and month, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-28"><a class="anchor" href="#parameters-28"></a>7.12.11.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (interval, but includes: day, hour, minute, second, and microsecond).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-35"><a class="anchor" href="#example-35"></a>7.12.11.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select interval_to_seconds('3day 3 hours 3second ');
 interval_to_seconds
---------------------
              270003
(1 row)

select interval_to_seconds('3day 3 hour 3.3555555555second ');
 interval_to_seconds
---------------------
       270003.355556
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_yminterval"><a class="anchor" href="#to_yminterval"></a>7.12.12. TO_YMINTERVAL</h4>
<div class="sect4">
<h5 id="purpose-31"><a class="anchor" href="#purpose-31"></a>7.12.12.1. Purpose</h5>
<div class="paragraph">
<p>TO_YMINTERVAL(str) Converts the input Parameters str time interval to a time interval in the year-to-month range. Only the year and month are processed, other parts are omitted. If the input Parameters is NULL, the function returns NULL, and if the input Parameters is in the wrong format, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-29"><a class="anchor" href="#parameters-29"></a>7.12.12.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (text, can be implicitly converted to text type, must be in time interval format. (SQL interval format compatible with SQL standard, ISO duration format compatible with ISO 8601:2004 standard).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-36"><a class="anchor" href="#example-36"></a>7.12.12.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_yminterval('P1Y-2M2D');
 to_yminterval
---------------
 10 mons
(1 row)

select to_yminterval('P1Y2M2D');
 to_yminterval
---------------
 1 year 2 mons
(1 row)

select to_yminterval('-P1Y2M2D');
  to_yminterval
------------------
 -1 years -2 mons
(1 row)

select to_yminterval('-P1Y2M2D');
  to_yminterval
------------------
 -1 years -2 mons
(1 row)

select to_yminterval('-01-02');
  to_yminterval
------------------
 -1 years -2 mons
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_dsinterval"><a class="anchor" href="#to_dsinterval"></a>7.12.13. TO_DSINTERVAL</h4>
<div class="sect4">
<h5 id="purpose-32"><a class="anchor" href="#purpose-32"></a>7.12.13.1. Purpose</h5>
<div class="paragraph">
<p>TO_DSINTERVAL(str) converts the time interval of the input Parameters str to a time interval in the range of days to seconds. Input Parameters include: day, hour, minute, second and microsecond. If the input Parameters is NULL, the function returns NULL, and if the input Parameters contains the year and month or is in the wrong format, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-30"><a class="anchor" href="#parameters-30"></a>7.12.13.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> Input Parameters (text, can be implicitly converted to text type, must be in time interval format. (SQL interval format compatible with SQL standard, ISO duration format compatible with ISO 8601:2004 standard).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-37"><a class="anchor" href="#example-37"></a>7.12.13.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_dsinterval('100 00 :02 :00');
   to_dsinterval
-------------------
 100 days 00:02:00
(1 row)

select to_dsinterval('-100 00:02:00');
    to_dsinterval
---------------------
 -100 days -00:02:00
(1 row)

select to_dsinterval(NULL);
 to_dsinterval
---------------

(1 row)

select to_dsinterval('-P100D');
 to_dsinterval
---------------
 -100 days
(1 row)

select to_dsinterval('-P100DT20H');
    to_dsinterval
---------------------
 -100 days -20:00:00
(1 row)

select to_dsinterval('-P100DT20S');
    to_dsinterval
---------------------
 -100 days -00:00:20
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to_timestamp_tz"><a class="anchor" href="#to_timestamp_tz"></a>7.12.14. TO_TIMESTAMP_TZ</h4>
<div class="sect4">
<h5 id="purpose-33"><a class="anchor" href="#purpose-33"></a>7.12.14.1. Purpose</h5>
<div class="paragraph">
<p>TO_TIMESTAMP_TZ(str,[fmt]) Converts the input Parameters str to a timestamp with a time zone according to the given format. If fmt is omitted, the data will be converted to a timestamp with a time zone value in the system default format. If str is null, the function returns null. If it cannot be converted to a timestamp with a time zone, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-31"><a class="anchor" href="#parameters-31"></a>7.12.14.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str</code> input Parameters (text, which can be implicitly converted to a text type).
<code>fmt</code> Enter format Parameters, see format fmt for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-38"><a class="anchor" href="#example-38"></a>7.12.14.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select to_timestamp_tz('2019','yyyy');
    to_timestamp_tz
------------------------
 2019-01-01 00:00:00+08
(1 row)

select to_timestamp_tz('2019-11','yyyy-mm');
    to_timestamp_tz
------------------------
 2019-11-01 00:00:00+08
(1 row)

select to_timestamp_tz('2003/12/13 10:13:18 +7:00');
    to_timestamp_tz
------------------------
 2003-12-13 11:13:18+08
(1 row)

select to_timestamp_tz('2019/12/13 10:13:18 +5:00', 'YYYY/MM/DD HH:MI:SS TZH:TZM');
    to_timestamp_tz
------------------------
 2019-12-13 13:13:18+08
(1 row)

select to_timestamp_tz(NULL);
 to_timestamp_tz
-----------------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="greatest"><a class="anchor" href="#greatest"></a>7.12.15. GREATEST</h4>
<div class="sect4">
<h5 id="purpose-34"><a class="anchor" href="#purpose-34"></a>7.12.15.1. Purpose</h5>
<div class="paragraph">
<p>GREATEST(expr1,expr2,&#8230;&#8203;) Gets the maximum value in the input list of one or more expressions. If the result of any expr calculation is NULL, the function returns NULL.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-32"><a class="anchor" href="#parameters-32"></a>7.12.15.2. <strong>Parameters</strong></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expr1` Enter Parameters (of any type).
`expr2` Enter Parameters (of any type).
`...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-39"><a class="anchor" href="#example-39"></a>7.12.15.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">select greatest('a','b','A','B');
 greatest
----------
 b
(1 row)

select greatest(',','.','/',';','!','@','?');
 greatest
----------
 @
(1 row)

select greatest('瀚','高','数','据','库');
 greatest
----------
 高
(1 row)

SELECT greatest('HARRY', 'HARRIOT', 'HARRA');
 greatest
----------
 HARRY
(1 row)

SELECT greatest('HARRY', 'HARRIOT', NULL);
 greatest
----------

(1 row)

SELECT greatest(1.1, 2.22, 3.33);
 greatest
----------
     3.33
(1 row)

SELECT greatest('A', 6, 7, 5000, 'E', 'F','G') A;
 a
---
 G
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="least"><a class="anchor" href="#least"></a>7.12.16. LEAST</h4>
<div class="sect4">
<h5 id="purpose-35"><a class="anchor" href="#purpose-35"></a>7.12.16.1. Purpose</h5>
<div class="paragraph">
<p>LEAST(expr1,expr2,&#8230;&#8203;) Gets the smallest value in the input list of one or more expressions. If the result of any expr calculation is NULL, the function returns NULL.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-33"><a class="anchor" href="#parameters-33"></a>7.12.16.2. <strong>Parameters</strong></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">expr1` Enter Parameters (of any type).
`expr2` Enter Parameters (of any type).
`...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-40"><a class="anchor" href="#example-40"></a>7.12.16.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">SELECT least(1,' 2', '3' );
 least
-------
     1
(1 row)

SELECT least(NULL, NULL, NULL);
 least
-------

(1 row)

SELECT least('A', 6, 7, 5000, 'E', 'F','G') A;
  a
------
 5000
(1 row)

select least(1,3,5,10);
 least
-------
     1
(1 row)

select least('a','A','b','B');
 least
-------
 A
(1 row)

select least(',','.','/',';','!','@');
 least
-------
 !
(1 row)

select least('瀚','高','据','库');
 least
-------
 库
(1 row)

SELECT least('HARRY', 'HARRIOT', NULL);
 least
-------

(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nanvl"><a class="anchor" href="#nanvl"></a>7.12.17. NANVL</h4>
<div class="sect4">
<h5 id="purpose-36"><a class="anchor" href="#purpose-36"></a>7.12.17.1. Purpose</h5>
<div class="paragraph">
<p>NANVl(str1, str2) returns an alternative value str1 when str2 is NaN (NaN when both str2 and str1 are NaN; null when either str2 or str1 is null). If the input Parameters cannot be converted to real or float8 type, the function returns an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameters-34"><a class="anchor" href="#parameters-34"></a>7.12.17.2. <strong>Parameters</strong></h5>
<div class="paragraph">
<p><code>str1</code> input Parameters (real, float8, can be implicitly converted to the above types).
<code>str2</code> Enter Parameters (float8, real, which can be implicitly converted to the above type).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-41"><a class="anchor" href="#example-41"></a>7.12.17.3. Example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">SELECT nanvl('NaN', 'NaN');
 nanvl
-------
   NaN
(1 row)

SELECT nanvl(12345::float4, 1), nanvl('NaN'::float4, 1);
 nanvl | nanvl
-------+-------
 12345 |     1
(1 row)

SELECT nanvl(12345::float4, '1'::varchar), nanvl('NaN'::float4, '1'::varchar);
 nanvl | nanvl
-------+-------
 12345 |     1
(1 row)

SELECT nanvl('12345', 'asdf');
 nanvl
-------
 12345
(1 row)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nls_length_semanticsparameters"><a class="anchor" href="#nls_length_semanticsparameters"></a>7.13. NLS_LENGTH_SEMANTICSParameters</h3>
<div class="sect3">
<h4 id="overview-3"><a class="anchor" href="#overview-3"></a>7.13.1. Overview</h4>
<div class="paragraph">
<p>NLS_LENGTH_SEMANTICS enables you to create CHAR and VARCHAR2 columns using byte or character length semantics. Existing columns are not affected. In this case, the default semantics is BYTE.</p>
</div>
</div>
<div class="sect3">
<h4 id="syntax-6"><a class="anchor" href="#syntax-6"></a>7.13.2. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">SET NLS_LENGTH_SEMANTICS TO [NONE | BYTE | CHAR];</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="note-on-the-range-of-values"><a class="anchor" href="#note-on-the-range-of-values"></a>7.13.2.1. <strong>Note on the range of values</strong></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">BYTE: The data is stored in byte length.
CHAR:Data is stored in character length.
NONE:Data is stored using native IvorySQL storage.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-42"><a class="anchor" href="#example-42"></a>7.13.3. Example</h4>
<div class="sect4">
<h5 id="test-char"><a class="anchor" href="#test-char"></a>7.13.3.1. --Test “CHAR”</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table test(a varchar2(5));
CREATE TABLE

SET NLS_LENGTH_SEMANTICS TO CHAR;
SET

SHOW NLS_LENGTH_SEMANTICS;
 nls_length_semantics
----------------------
 char
(1 row)

insert into test values ('Hello,Mr.li');
INSERT 0 1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="test-byte"><a class="anchor" href="#test-byte"></a>7.13.3.2. --Test “BYTE”</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">SET NLS_LENGTH_SEMANTICS TO BYTE;
SET

SHOW NLS_LENGTH_SEMANTICS;
 nls_length_semantics
----------------------
 byte
(1 row)

insert into test values ('Hello,Mr.li');
2021-12-14 15:28:11.906 HKT [6774] ERROR:  value too long for type varchar2(5 byte)
2021-12-14 15:28:11.906 HKT [6774] STATEMENT:  insert into test values ('Hello,Mr.li');
ERROR:  value too long for type varchar2(5 byte)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nvarchar2size"><a class="anchor" href="#nvarchar2size"></a>7.14. NVARCHAR2(size)</h3>
<div class="sect3">
<h4 id="overview-4"><a class="anchor" href="#overview-4"></a>7.14.1. Overview</h4>
<div class="paragraph">
<p>Variable-length Unicode strings with maximum-length size characters. You must specify the size for NVARCHAR2. The maximum number of bytes for AL16UTF16 encoding is 2 times, and the maximum number of bytes for UTF8 encoding is 3 times.</p>
</div>
</div>
<div class="sect3">
<h4 id="syntax-7"><a class="anchor" href="#syntax-7"></a>7.14.2. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">NVARCHAR2(size)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-43"><a class="anchor" href="#example-43"></a>7.14.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table test(a nvarchar2(5));
CREATE TABLE

SET NLS_LENGTH_SEMANTICS TO CHAR;
SET

SHOW NLS_LENGTH_SEMANTICS;
 nls_length_semantics
----------------------
 char
(1 row)

insert into test values ('Hello,Mr.li');
INSERT 0 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="varchar2size"><a class="anchor" href="#varchar2size"></a>7.15. VARCHAR2(size)</h3>
<div class="sect3">
<h4 id="overview-5"><a class="anchor" href="#overview-5"></a>7.15.1. Overview</h4>
<div class="paragraph">
<p>Variable length strings with maximum length bytes or characters. You must specify the size for VARCHAR2. The minimum size is 1 byte or 1 character.</p>
</div>
</div>
<div class="sect3">
<h4 id="syntax-8"><a class="anchor" href="#syntax-8"></a>7.15.2. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">VARCHAR2(size)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-44"><a class="anchor" href="#example-44"></a>7.15.3. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table test(a varchar2(5));
CREATE TABLE

SET NLS_LENGTH_SEMANTICS TO CHAR;
SET

SHOW NLS_LENGTH_SEMANTICS;
 nls_length_semantics
----------------------
 char
(1 row)

insert into test values ('Hello,Mr.li');
INSERT 0 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plisql"><a class="anchor" href="#plisql"></a>7.16. PL/iSQL</h3>
<div class="paragraph">
<p>PL/iSQL is IvorySQL&#8217;s procedural language for writing custom functions, procedures and packages for IvorySQL. PL/iSQL is derived from IvorySQL&#8217;s PL/pgsql with some added features, but syntactically PL/iSQL is closer to Oracle&#8217;s PL/SQL. This document Describes the basic structure and construction of PL/iSQL programs.</p>
</div>
<div class="sect3">
<h4 id="structure-of-plisql-programs"><a class="anchor" href="#structure-of-plisql-programs"></a>7.16.1. Structure of PL/iSQL Programs</h4>
<div class="paragraph">
<p>iSQL is a procedural block structure language that supports four different program types, <strong>PACKAGES</strong>, <strong>PROCEDURES</strong>, <strong>FUNCTIONS</strong>, and <strong>TRIGGERS</strong>. iSQL supports four different program types, <strong>PACKAGES</strong>, <strong>PROCEDURES</strong>, <strong>FUNCTIONS</strong>, and <strong>TRIGGERS</strong>. iSQL uses the same block structure for each type of supported program. A block consists of up to three parts: a declaration part, an executable, and an exception part. The declaration and exception sections are optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">[DECLARE
      declarations]
    BEGIN
      statements
  [ EXCEPTION
      WHEN &lt;exception_condition&gt; THEN
        statements]
    END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A block can consist of at least one executable section Contains one or more iSQL statements in the <strong>BEGIN</strong> and <strong>END</strong> keywords.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE OR REPLACE FUNCTION null_func() RETURN VOID AS
BEGIN
    NULL;
END;
/</code></pre>
</div>
</div>
<div class="paragraph">
<p>All keywords are case-insensitive. Identifiers are implicitly converted to lowercase unless double-quoted, just as they are in normal SQL commands. The declaration section can be used to declare variables and cursors, and depending on the context in which the block is used, the declaration section can begin with the keyword <strong>DECLARE</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE OR REPLACE FUNCTION null_func() RETURN VOID AS
DECLARE
    quantity integer := 30;
    c_row pg_class%ROWTYPE;
    r_cursor refcursor;
    CURSOR c1 RETURN pg_proc%ROWTYPE;
BEGIN
    NULL;
end;
/</code></pre>
</div>
</div>
<div class="paragraph">
<p>An optional exception section can also be included in a <strong>BEGIN - END</strong> block. The exception section begins with the keyword <strong>EXCEPTION</strong> and continues until the end of the block in which it appears. If a statement within the block throws an exception, program control goes to the exception section, which may or may not handle the thrown exception, depending on the contents of the exception and exception sections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE OR REPLACE FUNCTION reraise_test() RETURN void AS
BEGIN

    BEGIN
        RAISE syntax_error;
        EXCEPTION
            WHEN syntax_error THEN

            BEGIN
                raise notice 'exception % thrown in inner block, reraising', sqlerrm;
                RAISE;
                EXCEPTION
                WHEN OTHERS THEN
                    raise notice 'RIGHT - exception % caught in inner block', sqlerrm;
                END;
            END;
    EXCEPTION
        WHEN OTHERS THEN
        raise notice 'WRONG - exception % caught in outer block', sqlerrm;
END;
/</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Like PL/pgSQL, PL/iSQL uses <strong>BEGIN/END</strong> to group statements, and do not confuse them with the SQL commands of the same name used for transaction control. PL/iSQL&#8217;s BEGIN/END are used only for grouping; they do not start or end transactions</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="psql-support-for-plisql-programs"><a class="anchor" href="#psql-support-for-plisql-programs"></a>7.16.2. <strong>psql</strong> support for PL/iSQL programs</h4>
<div class="paragraph">
<p>To create a PL/iSQL program from a psql client, you can use a syntax similar to PL/pgSQL&#8217;s <strong>$$</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE FUNCTION func() RETURNS void as
$$
..
end$$ language plisql;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the Oracle-compliant syntax of references and language specifications without <strong>$$</strong> and end the program definition with <strong>/ (forward slash)</strong>. The */ (forward slash) must be on the newline character</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE FUNCTION func() RETURN void AS
…
END;
/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="plisql-program-syntax"><a class="anchor" href="#plisql-program-syntax"></a>7.16.3. PL/iSQL Program Syntax</h4>
<div class="sect4">
<h5 id="procedures"><a class="anchor" href="#procedures"></a>7.16.3.1. PROCEDURES</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [OR REPLACE] PROCEDURE procedure_name [(parameter_list)]
is
[DECLARE]
    -- variable declaration
BEGIN
    -- stored procedure body
END;
/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="functions"><a class="anchor" href="#functions"></a>7.16.3.2. FUNCTIONS</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [OR REPLACE] FUNCTION function_name ([parameter_list])
RETURN return_type AS
[DECLARE]
    -- variable declaration
BEGIN
    -- function body
   return statement
END;
/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages-2"><a class="anchor" href="#packages-2"></a>7.16.3.3. PACKAGES</h5>
<div class="sect5">
<h6 id="package-header"><a class="anchor" href="#package-header"></a>7.16.3.3.1. PACKAGE HEADER</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [ OR REPLACE ] PACKAGE [schema.] *package_name* [invoker_rights_clause] [IS | AS]
   item_list[, item_list ...]
END [*package_name*];


invoker_rights_clause:
     AUTHID [CURRENT_USER | DEFINER]

item_list:
[
   function_declaration    |
   procedure_declaration   |
   type_definition         |
   cursor_declaration      |
   item_declaration
]


function_declaration:
     FUNCTION function_name [(parameter_declaration[, ...])] RETURN datatype;

procedure_declaration:
     PROCEDURE procedure_name [(parameter_declaration[, ...])]

type_definition:
     record_type_definition      |
     ref_cursor_type_definition

cursor_declaration:
   CURSOR name [(cur_param_decl[, ...])] RETURN rowtype;

item_declaration:
     cursor_declaration             |
     cursor_variable_declaration    |
     record_variable_declaration    |
     variable_declaration           |

record_type_definition:
   TYPE record_type IS RECORD  ( variable_declaration [, variable_declaration]... ) ;

ref_cursor_type_definition:
   TYPE type IS REF CURSOR [ RETURN type%ROWTYPE ];

cursor_variable_declaration:
   curvar curtype;

record_variable_declaration:
   recvar { record_type | rowtype_attribute | record_type%TYPE };

variable_declaration:
   varname datatype [ [ NOT NULL ] := expr ]

parameter_declaration:
   parameter_name [IN] datatype [[:= | DEFAULT] expr]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="package-body-2"><a class="anchor" href="#package-body-2"></a>7.16.3.3.2. PACKAGE BODY</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">CREATE [ OR REPLACE ] PACKAGE BODY [schema.] package_name [IS | AS]
   [item_list[, item_list ...]] |
   item_list_2 [, item_list_2 ...]
   [initialize_section]
END [package_name];


initialize_section:
   BEGIN statement[, ...]

item_list:
[
   function_declaration    |
   procedure_declaration   |
   type_definition         |
   cursor_declaration      |
   item_declaration
]

item_list_2:
[
   function_declaration
   function_definition
   procedure_declaration
   procedure_definition
   cursor_definition
]

function_definition:
   FUNCTION function_name [(parameter_declaration[, ...])] RETURN datatype  [IS | AS]
   [declare_section] body;

procedure_definition:
   PROCEDURE procedure_name [(parameter_declaration[, ...])] [IS | AS]
   [declare_section] body;

cursor_definition:
   CURSOR name [(cur_param_decl[, ...])] RETURN rowtype IS select_statement;

body:
   BEGIN statement[, ...] END [name];

statement:
   [&lt;&lt;LABEL&gt;&gt;] pl_statments[, ...];</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hierarchy-search"><a class="anchor" href="#hierarchy-search"></a>7.17. Hierarchy Search</h3>
<div class="sect3">
<h4 id="syntax-9"><a class="anchor" href="#syntax-9"></a>7.17.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined"> {
 CONNECT BY [ NOCYCLE ] [PRIOR] condition [AND [PRIOR] condition]... [ START WITH condition ]
 | START WITH condition CONNECT BY [ NOCYCLE ] [PRIOR] condition [AND [PRIOR] condition]...
 }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>CONNECT BY</strong> query syntax begins with the CONNECT BY keywords, which define hierarchical interdependencies between parent and child rows. The result must be further qualified by specifying the PRIOR keyword in the conditional part of the CONNECT BY clause.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>PRIOR</strong> PRIOR keyword is a unary operator that relates the previous row to the current row. This keyword can be used to the left or right of the equality condition.</p>
</div>
<div class="paragraph">
<p><strong>START WITH</strong> This clause specifies the line from which the hierarchy begins.</p>
</div>
<div class="paragraph">
<p><strong>NOCYCLE</strong> No operation statement. Currently only supported by the syntax. This clause indicates that data is returned even if a loop exists.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional-column"><a class="anchor" href="#additional-column"></a>7.17.2. <strong>ADDITIONAL COLUMN</strong></h4>
<div class="paragraph">
<p><strong>LEVEL</strong> Returns the level of the current row in the hierarchy, starting at 1 at the root node and incrementing by 1 at each level thereafter.</p>
</div>
<div class="paragraph">
<p><strong>CONNECT_BY_ROOT expr</strong> Returns the parent column of the current row in the hierarchy.</p>
</div>
<div class="paragraph">
<p><strong>SYS_CONNECT_BY_PATH(col, chr)</strong> It is a function that returns the value of the column from the root to the current node, separated by the character "chr".</p>
</div>
</div>
<div class="sect3">
<h4 id="limitations-2"><a class="anchor" href="#limitations-2"></a>7.17.3. <strong>Limitations</strong></h4>
<div class="paragraph">
<p>This function currently has the following limitations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Additional columns can be used for most expressions, such as function calls, CASE statements and general expressions, but there are some unsupported columns, such as ROW, TYPECAST, COLLATE, GROUPING clauses, etc.</p>
</li>
<li>
<p>In case two or more columns are the same, you may need to output the column name, Example such as</p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>SELECT CONNECT_BY_ROOT col AS "col1", CONNECT_BY_ROOT col AS "col2" &#8230;&#8203;.</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>Indirect operators or "*" are not supported</p>
</li>
<li>
<p>Loop detection is not supported</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="global-unique-index"><a class="anchor" href="#global-unique-index"></a>8. Global Unique Index</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="create-global-unique-index"><a class="anchor" href="#create-global-unique-index"></a>8.1. Create global unique index</h3>
<div class="sect3">
<h4 id="syntax-10"><a class="anchor" href="#syntax-10"></a>8.1.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">CREATE UNIQUE INDEX [IF NOT EXISTS] name ON table_name [USING method] (columns) GLOBAL</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-45"><a class="anchor" href="#example-45"></a>8.1.2. Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">CREATE UNIQUE INDEX myglobalindex on mytable(bid) GLOBAL;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="global-uniqueness-assurance"><a class="anchor" href="#global-uniqueness-assurance"></a>8.1.3. Global uniqueness assurance</h4>
<div class="paragraph">
<p>During the creation of a globally unique index, the system performs an index scan on all existing partitions and raises an error if it finds duplicate entries from other partitions than the current one. Example.</p>
</div>
<div class="paragraph">
<p><strong>Command</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table gidxpart (a int, b int, c text) partition by range (a);
create table gidxpart1 partition of gidxpart for values from (0) to (100000);
create table gidxpart2 partition of gidxpart for values from (100000) to (199999);
insert into gidxpart (a, b, c) values (42, 572814, 'inserted first on gidxpart1');
insert into gidxpart (a, b, c) values (150000, 572814, 'inserted second on gidxpart2');
create unique index on gidxpart (b) global;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">ERROR:  could not create unique index "gidxpart1_b_idx"
DETAIL:  Key (b)=(572814) is duplicated.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="insertions-and-updates"><a class="anchor" href="#insertions-and-updates"></a>8.2. Insertions and updates</h3>
<div class="sect3">
<h4 id="global-uniqueness-guarantee-for-insertions-and-updates"><a class="anchor" href="#global-uniqueness-guarantee-for-insertions-and-updates"></a>8.2.1. Global uniqueness guarantee for insertions and updates</h4>
<div class="paragraph">
<p>During global unique index creation, the system performs an index scan on all existing partitions and raises an error if duplicate items are found in other partitions than the current one.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-46"><a class="anchor" href="#example-46"></a>8.2.2. Example</h4>
<div class="paragraph">
<p><strong>Command</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table gidx_part (a int, b int, c text) partition by range (a);
create table gidxpart (a int, b int, c text) partition by range (a);
create table gidxpart1 partition of gidxpart for values from (0) to (10);
create table gidxpart2 partition of gidxpart for values from (10) to (100);
create unique index gidx_u on gidxpart using btree(b) global;

insert into gidxpart values (1, 1, 'first');
insert into gidxpart values (11, 11, 'eleventh');
insert into gidxpart values (2, 11, 'duplicated (b)=(11) on other partition');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">ERROR:  duplicate key value violates unique constraint "gidxpart2_b_idx"
DETAIL:  Key (b)=(11) already exists.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="append-and-detach"><a class="anchor" href="#append-and-detach"></a>8.3. Append and detach</h3>
<div class="sect3">
<h4 id="global-uniqueness-guarantee-for-append-statements"><a class="anchor" href="#global-uniqueness-guarantee-for-append-statements"></a>8.3.1. Global uniqueness guarantee for append statements</h4>
<div class="paragraph">
<p>When appending a new table to a partitioned table with a globally unique index, the system performs a duplicate check on all existing partitions. If a duplicate item is found in an existing partition that matches a tuple in the appended table, an error is raised and the append fails.</p>
</div>
<div class="paragraph">
<p>Appending requires a sharedlock on all existing partitions. If one of the partitions is doing a concurrent INSERT, the append will wait for it to complete first. This can be improved in a future release</p>
</div>
</div>
<div class="sect3">
<h4 id="example-47"><a class="anchor" href="#example-47"></a>8.3.2. Example</h4>
<div class="paragraph">
<p><strong>Command</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-undefined hljs" data-lang="undefined">create table gidxpart (a int, b int, c text) partition by range (a);
create table gidxpart1 partition of gidxpart for values from (0) to (100000);
insert into gidxpart (a, b, c) values (42, 572814, 'inserted first on gidxpart1');
create unique index on gidxpart (b) global;
create table gidxpart2 (a int, b int, c text);
insert into gidxpart2 (a, b, c) values (150000, 572814, 'dup inserted on gidxpart2');

alter table gidxpart attach partition gidxpart2 for values from (100000) to (199999);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">ERROR:  could not create unique index "gidxpart1_b_idx"
DETAIL:  Key (b)=(572814) is duplicated.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="安装部署-英文版-0.1.html">Installation Deployment</a></span>
  <span class="next"><a href="运维管理指南-英文版-0.2.html">Operation Management</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">

</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
